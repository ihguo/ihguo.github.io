<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="KNOW-HOW">
<meta property="og:url" content="http://example.com/page/13/index.html">
<meta property="og:site_name" content="KNOW-HOW">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Guo">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>KNOW-HOW</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">KNOW-HOW</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">181</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">242</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/raytroop" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;raytroop" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:raytroop@gmail.com" title="E-Mail → mailto:raytroop@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/15/emx-peakview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/15/emx-peakview/" class="post-title-link" itemprop="url">EMX & PeakView</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-15 00:06:21" itemprop="dateCreated datePublished" datetime="2022-03-15T00:06:21+00:00">2022-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cad/" itemprop="url" rel="index"><span itemprop="name">cad</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="lvs-check">LVS check</h2>
<p>LVS issue for circuits with customized devices</p>
<ul>
<li><p>auCdl: Analog and Microwave CDL, is a netlister used for creating
CDL netlist for analog circuits</p></li>
<li><p>auLVS: Analog and Microwave LVS, is used for analog circuit
LVS</p></li>
</ul>
<h2 id="emx-ports">EMX ports</h2>
<h3 id="plain-labels">plain labels</h3>
<ul>
<li><strong>pin</strong> layer</li>
<li>uncheck <strong>Cadence pins</strong> in <strong>Advanced
options</strong></li>
</ul>
<h3 id="rectangle-pins">rectangle pins</h3>
<ul>
<li><strong>drawing</strong> layer rectangle pin and specify
<strong>Access Direction</strong> as intended</li>
<li>check <strong>Cadence pins</strong> in <strong>Advanced
options</strong></li>
</ul>
<blockquote>
<p><strong>Cadence pins</strong> do NOT matter when there are only
rectangle pin. rectangle pins are always selected as driven port.</p>
</blockquote>
<h3 id="check-ports-used-for-simulation">check ports used for
simulation</h3>
<p>use <strong>GDS view - EMX</strong></p>
<h3 id="emx-synthesis-kits">EMX Synthesis Kits</h3>
<p>Synthesis is a capability of the EMX <strong>Pcell</strong> library
and uses scalable model data pre-generated by Continuum for a specific
process and metal scheme combination.</p>
<p>Synthesis is supported by the Pcells that are suffixed
<strong>_scalable</strong>, and these Pcells have the additional fields
and buttons needed for synthesis.</p>
<h3 id="port-order-signals">port order (signals)</h3>
<blockquote>
<p>emxform.ils</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th>type</th>
<th><strong>Port order</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inductor</td>
<td>P1 P2</td>
</tr>
<tr class="even">
<td>shield inductor</td>
<td>P1 P2 SHIELD</td>
</tr>
<tr class="odd">
<td>tapped inductor</td>
<td>P1 P2 CT</td>
</tr>
<tr class="even">
<td>tapped shield inductor</td>
<td>P1 P2 CT SHIELD</td>
</tr>
<tr class="odd">
<td>mom/mim capacitor</td>
<td>P1 P2</td>
</tr>
<tr class="even">
<td>tcoil</td>
<td>P1 P2 TAP</td>
</tr>
<tr class="odd">
<td>shield tcoil</td>
<td>P1 P2 TAP SHIELD</td>
</tr>
<tr class="even">
<td>tline</td>
<td>P1 P2</td>
</tr>
<tr class="odd">
<td>differential tline</td>
<td>P1 P2 P3 P4</td>
</tr>
</tbody>
</table>
<h3 id="emx-device-info">EMX device info</h3>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 29%" />
<col style="width: 5%" />
<col style="width: 22%" />
<col style="width: 12%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th>name</th>
<th>menu_selection (split with _ )</th>
<th>num_ports</th>
<th>modelgen_type</th>
<th>generic_model_type</th>
<th>plot_fn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Single-ended inductor</td>
<td>inductor_no tap_no shield_single-ended</td>
<td>2</td>
<td>inductor</td>
<td>inductor</td>
<td>EMX_plot_se_ind</td>
</tr>
<tr class="even">
<td>Differential inductor</td>
<td>inductor_no tap_no shield_differential</td>
<td>2</td>
<td>inductor</td>
<td>inductor</td>
<td>EMX_plot_diff_ind</td>
</tr>
<tr class="odd">
<td>Single-ended shield inductor</td>
<td>inductor_no tap_with shield_single-ended</td>
<td>3</td>
<td>shield_inductor</td>
<td>shield_inductor</td>
<td>EMX_plot_se_ind</td>
</tr>
<tr class="even">
<td>Differential shield inductor</td>
<td>inductor_no tap_with shield_differential</td>
<td>3</td>
<td>shield_inductor</td>
<td>shield_inductor</td>
<td>EMX_plot_diff_ind</td>
</tr>
<tr class="odd">
<td>Tapped inductor (diff mode only)</td>
<td>inductor_with tap_no shield_differential mode only</td>
<td>3</td>
<td>center_tapped_inductor</td>
<td>tapped_inductor</td>
<td>EMX_plot_ct_ind</td>
</tr>
<tr class="even">
<td>Tapped inductor (common mode too)</td>
<td>inductor_with tap_no shield_also fit common mode</td>
<td>3</td>
<td>center_tapped_inductor_common_mode</td>
<td>tapped_inductor</td>
<td>EMX_plot_ct_ind</td>
</tr>
<tr class="odd">
<td>Tapped shield inductor (diff only)</td>
<td>inductor_with tap_with shield_differential mode only</td>
<td>4</td>
<td>center_tapped_well_inductor_common_mode</td>
<td>tapped_shield_inductor</td>
<td>EMX_plot_ct_ind</td>
</tr>
<tr class="even">
<td>Single-ended cap (symm)</td>
<td>capacitor_symmetric single-ended</td>
<td>2</td>
<td>complex_mom_capacitor</td>
<td>mom_capacitor</td>
<td>EMX_plot_se_cap</td>
</tr>
<tr class="odd">
<td>Differential cap (symm)</td>
<td>capacitor_symmetric differential</td>
<td>2</td>
<td>complex_mom_capacitor</td>
<td>mom_capacitor</td>
<td>EMX_plot_diff_cap</td>
</tr>
<tr class="even">
<td>Single-ended cap (asymm)</td>
<td>capacitor_asymmetric single-ended</td>
<td>2</td>
<td>complex_asymmetric_mom_capacitor</td>
<td>mom_capacitor</td>
<td>EMX_plot_se_cap</td>
</tr>
<tr class="odd">
<td>Differential cap (asymm)</td>
<td>capacitor_asymmetric differential</td>
<td>2</td>
<td>complex_asymmetric_mom_capacitor</td>
<td>mom_capacitor</td>
<td>EMX_plot_diff_cap</td>
</tr>
<tr class="even">
<td>MiM capacitor</td>
<td>capacitor_MiM</td>
<td>2</td>
<td>mim_capacitor</td>
<td>mim_capacitor</td>
<td>EMX_plot_se_cap</td>
</tr>
<tr class="odd">
<td>Tcoil (simple model)</td>
<td>tcoil_simple model</td>
<td>3</td>
<td>tcoil</td>
<td>tcoil</td>
<td>EMX_plot_tcoil</td>
</tr>
<tr class="even">
<td>Tcoil (complex model)</td>
<td>tcoil_complex model</td>
<td>3</td>
<td>complex_tcoil</td>
<td>complex_tcoil</td>
<td>EMX_plot_tcoil</td>
</tr>
<tr class="odd">
<td>Shield tcoil</td>
<td>tcoil_with shield</td>
<td>4</td>
<td>shield_complex_tcoil</td>
<td>shield_tcoil</td>
<td>EMX_plot_shield_tcoil</td>
</tr>
<tr class="even">
<td>Transmission line</td>
<td>transmission line_single</td>
<td>2</td>
<td>xline</td>
<td>xline</td>
<td>EMX_plot_xline</td>
</tr>
<tr class="odd">
<td>Diff transmission line</td>
<td>transmission line_coupled (differential)</td>
<td>4</td>
<td>coupled_xline</td>
<td>diff_xline</td>
<td>EMX_plot_diff_xline</td>
</tr>
</tbody>
</table>
<h3 id="plot-function">plot function</h3>
<blockquote>
<p>EMX's formulation is defined in</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/path/to/EMX/share/emx/virtuoso_ui/emxinterface/emxskill/emxform.ils</span><br></pre></td></tr></table></figure>
<p>EMX import this file at Virtuoso startup, you have to relaunch
Virtuoso if you change this file</p>
</blockquote>
<h4 id="single-ended-inductor">Single-ended inductor</h4>
<p>Both with and without shield apply</p>
<ul>
<li>port-1 impedance when port-2 short</li>
</ul>
<p><span class="math display">\[
Z_1 = \frac{1}{Y_{11}}
\]</span></p>
<ul>
<li>port-2 impedance when port-1 short</li>
</ul>
<p><span class="math display">\[
Z_2 = \frac{1}{Y_{22}}
\]</span> Then <span class="math display">\[\begin{align}
L1 &amp;= \frac{Im(Z_1)}{2\pi f} \\
Q1 &amp;= \frac{Im(Z_1)}{Re(Z_1)} \\
L2 &amp;= \frac{Im(Z_2)}{2\pi f} \\
Q2 &amp;= \frac{Im(Z_2)}{Re(Z_2)}
\end{align}\]</span></p>
<blockquote>
<p>EMX only plot L1 and Q1</p>
</blockquote>
<h4 id="differential-impedance">differential impedance</h4>
<p>Y parameters to Z parameters</p>
<p><span class="math display">\[\begin{align}
|Y| &amp;= Y_{11}*Y_{22} - Y_{12}*Y_{22} \\
\begin{bmatrix}
Z_{11} &amp; Z_{12}\\
Z_{21} &amp; Z_{22}
\end{bmatrix}
&amp;=
\begin{bmatrix}
\frac{Y_{22}}{|Y|} &amp; \frac{-Y_{12}}{|Y|}\\
\frac{-Y_{21}}{|Y|} &amp; \frac{Y_{11}}{|Y|}
\end{bmatrix}
\end{align}\]</span></p>
<p>Then <strong>differential impedance</strong> is <span
class="math display">\[
Z_{diff} = Z_{11} - Z_{12} - Z_{21} + Z_{22}
\]</span></p>
<p><img src="/2022/03/15/emx-peakview/image-20220330234833756.png"
alt="image-20220330234833756" /></p>
<blockquote>
<p>similarly, Z parameters to Y parameters <span class="math display">\[
\begin{bmatrix}
Y_{11} &amp; Y_{12}\\
Y_{21} &amp; Y_{22}
\end{bmatrix}
=
\begin{bmatrix}
\frac{Z_{22}}{|Z|} &amp; \frac{-Z_{12}}{|Z|}\\
\frac{-Z_{21}}{|Z|} &amp; \frac{Z_{11}}{|Z|}
\end{bmatrix}
\]</span> where <span class="math display">\[
|Z| = Z_{11}Z_{22} - Z_{12}Z_{21}
\]</span></p>
</blockquote>
<h4 id="differential-inductor">Differential inductor</h4>
<p>Both with and without shield apply</p>
<p><span class="math display">\[\begin{align}
L_{diff} &amp;= \frac{Im(Z_{diff})}{2\pi f} \\
Q_{diff} &amp;= \frac{Im(Z_{diff})}{Re(Z_{diff})}
\end{align}\]</span></p>
<h4 id="center-tapped-inductor">Center-tapped inductor</h4>
<p><span class="math display">\[
Y =
\begin{bmatrix}
Y_{11} &amp; Y_{12} &amp; Y_{13}\\
Y_{21} &amp; Y_{22} &amp; Y_{23}\\
Y_{31} &amp; Y_{32} &amp; Y_{33}
\end{bmatrix}
\]</span></p>
<p>where port order is <code>P1 P2 CT</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(define (EMX_plot_ct_ind bgui wid what)</span><br><span class="line">  (EMX_plot_aux bgui wid what 3</span><br><span class="line">		&#x27;(&quot;Differential inductance&quot; &quot;Differential Q&quot;)</span><br><span class="line">		&#x27;(&quot;Henry&quot; &quot;&quot;)</span><br><span class="line">		(lambda (ys)</span><br><span class="line">		  (letseq ((z (EMX_differential (nth 0 ys) (nth 1 ys) (nth 3 ys) (nth 4 ys)))</span><br><span class="line">			   (f (xval z))</span><br><span class="line">			   (L (imag z)/(2*3.14159265358979*f))</span><br><span class="line">			   (Q (imag z)/(real z)))</span><br><span class="line">		    `((,L) (,Q))))</span><br><span class="line">		&#x27;((&quot;L&quot;) (&quot;Q&quot;))))</span><br></pre></td></tr></table></figure>
<p>Assume <code>CT</code> i.e. port 3 in S-parameter is grounded,
<code>(z (EMX_differential (nth 0 ys) (nth 1 ys) (nth 3 ys) (nth 4 ys)))</code>
obtain differential impedance with <span
class="math inline">\(Y_{11}\)</span>, <span
class="math inline">\(Y_{12}\)</span>, <span
class="math inline">\(Y_{21}\)</span> and <span
class="math inline">\(Y_{22}\)</span>. <span class="math display">\[
Y =
\begin{bmatrix}
Y_{11} &amp; Y_{12}\\
Y_{21} &amp; Y_{22}
\end{bmatrix}
\]</span> Finally, differential inductance and Q are obtained, shown as
below</p>
<p><span class="math display">\[\begin{align}
L_{diff} &amp;= \frac{Im(Z_{diff})}{2\pi f} \\
Q_{diff} &amp;= \frac{Im(Z_{diff})}{Re(Z_{diff})}
\end{align}\]</span></p>
<p><img src="/2022/03/15/emx-peakview/image-20220331013735370.png"
alt="image-20220331013735370" /></p>
<h4 id="single-ended-cap">Single-ended cap</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(define (EMX_plot_se_cap bgui wid what)</span><br><span class="line">  (EMX_plot_aux bgui wid what 2</span><br><span class="line">		&#x27;(&quot;Capacitance&quot; &quot;Q&quot; &quot;Capacitance&quot; &quot;Q&quot;)</span><br><span class="line">		&#x27;(&quot;Farad&quot; &quot;&quot; &quot;Farad&quot; &quot;&quot;)</span><br><span class="line">		(lambda (ys)</span><br><span class="line">		  (letseq ((z1 1.0/(nth 0 ys))</span><br><span class="line">			   (y12 (nth 1 ys))</span><br><span class="line">			   (z2 1.0/(nth 3 ys))</span><br><span class="line">			   (f (xval z1))</span><br><span class="line">			   (C1 (-1.0/(imag z1))/(2*3.14159265358979*f))</span><br><span class="line">			   (C12 -(imag y12)/(2*3.14159265358979*f))</span><br><span class="line">			   (C2 (-1.0/(imag z2))/(2*3.14159265358979*f))</span><br><span class="line">			   (Q1 -(imag z1)/(real z1))</span><br><span class="line">			   (Q12 (imag y12)/(real y12))</span><br><span class="line">			   (Q2 -(imag z2)/(real z2)))</span><br><span class="line">		    `((,C1) (,Q1) (,C12))))</span><br><span class="line">		&#x27;((&quot;Cse&quot;) (&quot;Qse&quot;) (&quot;C12&quot;))))</span><br></pre></td></tr></table></figure>
<p>We define Port-1 impedance <span class="math inline">\(Z_1\)</span>,
Port-2 impedance <span class="math inline">\(Z_2\)</span></p>
<p><span class="math display">\[\begin{align}
Z_1 &amp;= \frac {1}{Y_{11}}\\
Z_2 &amp;= \frac {1}{Y_{22}}
\end{align}\]</span></p>
<p>Then single-ended cap and Q <span
class="math display">\[\begin{align}
C_1 &amp;= -\frac{1/Im(Z_1)}{2\pi f} \\
Q_1 &amp;= -\frac{Im(Z_1)}{Re(Z_1)} \\
C_2 &amp;=  -\frac{1/Im(Z_2)}{2\pi f} \\
Q_2 &amp;= -\frac{Im(Z_2)}{Re(Z_2)} \\
C_{12} &amp;= -\frac{Im(Y_{12})}{2\pi f}\\
Q_{12} &amp;= \frac{Im(Y_{12})}{Re(Y_{12})}
\end{align}\]</span></p>
<ul>
<li><strong>Series equivalent</strong> model is used in <span
class="math inline">\(C_1\)</span>, <span
class="math inline">\(Q_1\)</span>, <span
class="math inline">\(C_2\)</span> and <span
class="math inline">\(Q_2\)</span>
<ul>
<li><span class="math inline">\(Z_1 = R + \frac{1}{sC_1}\)</span> and
<span class="math inline">\(Z_2 = R + \frac{1}{sC_2}\)</span></li>
</ul></li>
<li>Parallel model is used in <span
class="math inline">\(C_{12}\)</span> and <span
class="math inline">\(Q_{12}\)</span>
<ul>
<li><span class="math inline">\(Y_{12} = \frac{1}{R} +
sC_{12}\)</span></li>
</ul></li>
</ul>
<blockquote>
<p>EMX plot <span class="math inline">\(C_{se}\)</span>, <span
class="math inline">\(Q_{se}\)</span> and <span
class="math inline">\(C_{12}\)</span>, i.e. <span
class="math inline">\(C_1\)</span>, <span
class="math inline">\(Q_1\)</span> and <span
class="math inline">\(C_{12}\)</span></p>
</blockquote>
<p><img src="/2022/03/15/emx-peakview/image-20220331020334023.png"
alt="image-20220331020334023" /></p>
<h4 id="differential-cap">Differential cap</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(define (EMX_plot_diff_cap bgui wid what)</span><br><span class="line">  (EMX_plot_aux bgui wid what 2</span><br><span class="line">		&#x27;(&quot;Differential capacitance&quot; &quot;Differential Q&quot;)</span><br><span class="line">		&#x27;(&quot;Farad&quot; &quot;&quot;)</span><br><span class="line">		(lambda (ys)</span><br><span class="line">		  (letseq ((z (apply EMX_differential ys))</span><br><span class="line">			   (f (xval z))</span><br><span class="line">			   (C (-1.0/(imag z))/(2*3.14159265358979*f))</span><br><span class="line">			   (Q -(imag z)/(real z)))</span><br><span class="line">		    `((,C) (,Q))))</span><br><span class="line">		&#x27;((&quot;C&quot;) (&quot;Q&quot;))))</span><br></pre></td></tr></table></figure>
<p>First obtain differential impedance, <span
class="math inline">\(Z_{diff}\)</span> then apply series equivalent
model <span class="math display">\[\begin{align}
C_{diff} &amp;= -\frac{1/Im(Z_{diff})}{2\pi f} \\
Q_{diff} &amp;= -\frac{Im(Z_{diff})}{Re(Z_{diff})}
\end{align}\]</span></p>
<p><img src="/2022/03/15/emx-peakview/image-20220331022224865.png"
alt="image-20220331022224865" /></p>
<h4 id="tline">Tline</h4>
<p>Open circuit impedance <span class="math inline">\(Z_o\)</span>,
short circuit impedance <span class="math inline">\(Z_s\)</span> and
characteristic impedance <span class="math inline">\(Z_0\)</span></p>
<p><span class="math display">\[\begin{align}
Z_o &amp;= Z_{11}\\
Z_s &amp;= \frac{1}{Y_{11}}\\
Z_0  &amp;= \sqrt{Z_o*Z_s}
\end{align}\]</span></p>
<p>propagation constant is given as <span
class="math display">\[\begin{align}
\gamma &amp;= \frac{1}{2}\log\left( \frac{Z_0+Z_s}{Z_0-Z_s} \right) \\
&amp;= \alpha + j\beta
\end{align}\]</span> where <span class="math inline">\(\alpha\)</span>
is <strong>attenuation constant</strong> and <span
class="math inline">\(\beta\)</span> is <strong>phase
constant</strong></p>
<p>The relationship between these parameter and geometry of the
transmission line <span class="math display">\[\begin{align}
Z_0 &amp;= \sqrt{\frac{R+j\omega L}{G+j\omega C}} \\
\gamma &amp;= \sqrt{(G+j\omega C)(R+j\omega L)}
\end{align}\]</span> EMX plot the real and imaginary part of <span
class="math inline">\(Z_0\)</span>, <span
class="math inline">\(\alpha\)</span> and <span
class="math inline">\(\beta\)</span> of <span
class="math inline">\(\gamma\)</span></p>
<blockquote>
<p><del>Note EMX plot the absolute value of <span
class="math inline">\(\alpha\)</span> and <span
class="math inline">\(\beta\)</span></del></p>
</blockquote>
<p><img src="/2022/03/15/emx-peakview/image-20220630215343377.png"
alt="image-20220630215343377" /><img
src="/2022/03/15/emx-peakview/image-20220630215418372.png"
alt="image-20220630215418372" /></p>
<p><img src="/2022/03/15/emx-peakview/image-20220630215630849.png"
alt="image-20220630215630849" /></p>
<h3 id="emx-autoplot">EMX autoplot</h3>
<blockquote>
<p>using AC simulation, and inductor's parallel model or series
model</p>
<p>That is to say: both <code>sp</code> (network parameter) and
<code>ac</code> (impedance) can be used to plot inductance, Q value.</p>
<p>usually EMX choose <code>ac</code> method</p>
</blockquote>
<p><img src="/2022/03/15/emx-peakview/image-20220501173856442.png"
alt="image-20220501173856442" /></p>
<p><img src="/2022/03/15/emx-peakview/image-20220501173930035.png"
alt="image-20220501173930035" /></p>
<blockquote>
<p>left 2 figures are used for AC simulation, <span
class="math inline">\(Y_{nn}\)</span> can be obtained conveniently</p>
</blockquote>
<h3 id="foundary-model">foundary model</h3>
<p><img src="/2022/03/15/emx-peakview/image-20221217141519947.png"
alt="image-20221217141519947" /></p>
<p>for single-end capicator <span class="math display">\[\begin{align}
Q_1 &amp;= -\frac{Im(Z_1)}{Re(Z_1)} \\
&amp;= -\frac{Im(1/Y_{11})}{Re(1/Y_{11})} \\
&amp;= -\frac{Im(Y_{11}^*)/|Y_{11}|^2}{Re(Y_{11}^*)/|Y_{11}|^2} \\
&amp;= \frac{Im(Y_{11})}{Re(Y_{11})}
\end{align}\]</span></p>
<p>So, the EMX model and foundary model is consistent.</p>
<h3 id="tips">Tips</h3>
<p>Process file encryption mostly for advanced nodes, like TSMC 16nm
Finfet, whose process file is encrypted.</p>
<ul>
<li>Use <code>--key=EMXkey</code> in the EMX <em>Advanced
options</em></li>
</ul>
<p>GDSviewer has two options</p>
<ul>
<li>EMX: shows the final gds sent to EMX for simulation after it has
been processed by EMX</li>
<li>Raw: shows the raw gds</li>
</ul>
<blockquote>
<p>If there are port name with the <code>#</code> sign, it means EMX
sees a port but it is not in the signal list.</p>
</blockquote>
<p>EMX Accuracy</p>
<ul>
<li><p>Edge mesh: controls layout discretization in the X-Y plane</p>
<ul>
<li>For MoM capacitors, use the edge mesh to be the same as the width of
the finger (for example, 0.1um).</li>
</ul></li>
<li><p>Thickness: controls layout discretization in the Z
dimension</p></li>
<li><p>3D metals: skips all 2D assumptions about conductors and their
currents and charges</p>
<ul>
<li>If you set <code>3D metals</code> to <code>*</code> then all metals
are treated as <strong>3D</strong>
<ul>
<li>For Inductor type structures, only thick metal needs 3D.</li>
<li>For MoM, all layers are needed.</li>
</ul></li>
</ul></li>
</ul>
<p>Ports entered in <code>Grounds</code> will cause these nets to be
grounded; these ports will not show up in the S-parameter result.</p>
<p>Setup Temperature</p>
<ul>
<li>EMX: <code>--temperature=100</code></li>
</ul>
<p>ParaView</p>
<ul>
<li>If check ParaView related options when ParaView is not setup
properly, EMX simulation stop at <em>Creating mesh...</em> without
waring or errors (version 6.2).</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/14/uvm-reg-ralf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/14/uvm-reg-ralf/" class="post-title-link" itemprop="url">UVM REG RALF & IP-XACT</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-14 17:20:29" itemprop="dateCreated datePublished" datetime="2022-03-14T17:20:29+00:00">2022-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="uvm_reg_field">uvm_reg_field</h2>
<p>There are no properties for <strong>unused</strong> or
<strong>reserved</strong> fields, and unlike register arrays</p>
<h3 id="ralf">ralf</h3>
<ul>
<li>bytes: the register size, default is <em>N*8 &gt; all
field</em></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">register CTRL &#123;</span><br><span class="line">   left_to_right;</span><br><span class="line">   field unused &#123;bits 6;&#125;</span><br><span class="line">    field HC1R &#123;</span><br><span class="line">    bits 1; access rw  ;</span><br><span class="line">    coverpoint &#123; bins x = &#123;0,1&#125;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    field HC1E &#123;bits 1 ; access rw &#125;</span><br><span class="line">    field unused &#123;bits 2; &#125;</span><br><span class="line">    field HC0R &#123;bits 1; access rw &#125;</span><br><span class="line">    field HCOE &#123;bits 1 ; access rw &#125;</span><br><span class="line">    field unused &#123;bits 2; &#125;</span><br><span class="line">    field BL &#123;bits 1; access rw &#125;</span><br><span class="line">    field CSL &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field VSL &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field HSL &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field PC &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field CD &#123;bits 2 ; access rw&#125;</span><br><span class="line">    field VBL &#123;bits 2 ; access rw&#125;</span><br><span class="line">    field CBSWE &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field VBSWE &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field CBSIE &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field VBSIE &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field HIE  &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field VIE  &#123;bits 1 ; access rw&#125;</span><br><span class="line">    field VEN  &#123;bits 1 ; access rw&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="generated-sv">generated sv</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> build();</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HC1R</span> = uvm_reg_field::type_id::create(<span class="string">&quot;HC1R&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HC1R</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">23</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HC1E</span> = uvm_reg_field::type_id::create(<span class="string">&quot;HC1E&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HC1E</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HC0R</span> = uvm_reg_field::type_id::create(<span class="string">&quot;HC0R&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HC0R</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">19</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HCOE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;HCOE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HCOE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">18</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.BL</span> = uvm_reg_field::type_id::create(<span class="string">&quot;BL&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.BL</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CSL</span> = uvm_reg_field::type_id::create(<span class="string">&quot;CSL&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CSL</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VSL</span> = uvm_reg_field::type_id::create(<span class="string">&quot;VSL&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VSL</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HSL</span> = uvm_reg_field::type_id::create(<span class="string">&quot;HSL&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HSL</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.PC</span> = uvm_reg_field::type_id::create(<span class="string">&quot;PC&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.PC</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CD</span> = uvm_reg_field::type_id::create(<span class="string">&quot;CD&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CD</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">2&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VBL</span> = uvm_reg_field::type_id::create(<span class="string">&quot;VBL&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VBL</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">2&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CBSWE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;CBSWE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CBSWE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VBSWE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;VBSWE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VBSWE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CBSIE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;CBSIE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.CBSIE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VBSIE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;VBSIE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VBSIE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HIE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;HIE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.HIE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VIE</span> = uvm_reg_field::type_id::create(<span class="string">&quot;VIE&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VIE</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VEN</span> = uvm_reg_field::type_id::create(<span class="string">&quot;VEN&quot;</span>,,get_full_name());</span><br><span class="line">     <span class="keyword">this</span><span class="variable">.VEN</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;h0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">endfunction</span>: build </span><br></pre></td></tr></table></figure>
<h2 id="uvm_reg_block">uvm_reg_block</h2>
<h3 id="ralf-1">ralf</h3>
<ul>
<li>bytes : bus width</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">block vga_lcd  &#123;</span><br><span class="line">    bytes 4;</span><br><span class="line">    endian little;</span><br><span class="line">    </span><br><span class="line">    register STAT (`RAL_HDL_PATH.wbs.stat[31:0]) @0004;</span><br><span class="line">    register HTIM (`RAL_HDL_PATH.htim[31:0]) @0008;</span><br><span class="line">    register CTRL (`RAL_HDL_PATH.wbs.ctrl[31:0]) @00010;</span><br><span class="line">    register VTIM (`RAL_HDL_PATH.vtim[31:0]) @0012;</span><br><span class="line">    register C1CR (`RAL_HDL_PATH.c1cr[31:0]) @0016;</span><br><span class="line">    memory CLUT1  @&#x27;h0C00;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="generated-sv-1">generated sv</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span> = create_map(<span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="number">4</span>, UVM_LITTLE_ENDIAN, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span><span class="variable">.STAT</span> = ral_reg_STAT::type_id::create(<span class="string">&quot;STAT&quot;</span>,,get_full_name());</span><br><span class="line"><span class="keyword">this</span><span class="variable">.STAT</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.STAT</span><span class="variable">.build</span>();</span><br><span class="line"><span class="keyword">this</span><span class="variable">.STAT</span><span class="variable">.add_hdl_path</span>(&#x27;&#123; &#x27;&#123;<span class="string">&quot;wbs.stat[31:0]&quot;</span>, -<span class="number">1</span>, -<span class="number">1</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span><span class="variable">.add_reg</span>(<span class="keyword">this</span><span class="variable">.STAT</span>, `UVM_REG_ADDR_WIDTH&#x27;h4, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span><span class="variable">.HTIM</span> = ral_reg_HTIM::type_id::create(<span class="string">&quot;HTIM&quot;</span>,,get_full_name()); </span><br><span class="line"><span class="keyword">this</span><span class="variable">.HTIM</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.HTIM</span><span class="variable">.build</span>();</span><br><span class="line"><span class="keyword">this</span><span class="variable">.HTIM</span><span class="variable">.add_hdl_path</span>(&#x27;&#123;&#x27;&#123;<span class="string">&quot;htim[31:0]&quot;</span>, -<span class="number">1</span>, -<span class="number">1</span>&#125; &#125;); </span><br><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span><span class="variable">.add_reg</span>(<span class="keyword">this</span><span class="variable">.HTIM</span>, `UVM_REG_ADDR_WIDTH&#x27;h8, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span><span class="variable">.CTRL</span> = ral_reg_CTRL::type_id::create(<span class="string">&quot;CTRL&quot;</span>,,get_full_name());</span><br><span class="line"><span class="keyword">this</span><span class="variable">.CTRL</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>); </span><br><span class="line"><span class="keyword">this</span><span class="variable">.CTRL</span><span class="variable">.build</span>(); </span><br><span class="line"><span class="keyword">this</span><span class="variable">.CTRL</span><span class="variable">.add_hdl_path</span>(&#x27;&#123;&#x27;&#123;<span class="string">&quot;wbs.ctrl[31:0]&quot;</span>, -<span class="number">1</span>, -<span class="number">1</span>&#125; &#125;);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span><span class="variable">.add_reg</span>(<span class="keyword">this</span><span class="variable">.CTRL</span>, `UVM_REG_ADDR_WIDTH&#x27;hA, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span><span class="variable">.VTIM</span> = ral_reg_VTIM::type_id::create(<span class="string">&quot;VTIM&quot;</span>,,get_full_name()); </span><br><span class="line"><span class="keyword">this</span><span class="variable">.VTIM</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.VTIM</span><span class="variable">.build</span>();</span><br><span class="line"><span class="keyword">this</span><span class="variable">.VTIM</span><span class="variable">.add_hdl_path</span>(&#x27;&#123; &#x27;&#123;<span class="string">&quot;vtim[31:0]&quot;</span>, -<span class="number">1</span>, -<span class="number">1</span>&#125; &#125;); </span><br><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span><span class="variable">.add_reg</span>(<span class="keyword">this</span><span class="variable">.VTIM</span>, `UVM_REG_ADDR_WIDTH&#x27;hC, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span><span class="variable">.C1CR</span> = ral_reg_C1CR::type_id::create(<span class="string">&quot;C1CR&quot;</span>,,get_full_name());</span><br><span class="line"><span class="keyword">this</span><span class="variable">.C1CR</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.C1CR</span><span class="variable">.build</span>();</span><br><span class="line"><span class="keyword">this</span><span class="variable">.C1CR</span><span class="variable">.add_hdl_path</span>(&#x27;&#123; &#x27;&#123;<span class="string">&quot;c1cr[31:0]&quot;</span>, -<span class="number">1</span>, -<span class="number">1</span>&#125; &#125;);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span><span class="variable">.add_reg</span>(<span class="keyword">this</span><span class="variable">.C1CR</span>, `UVM_REG_ADDR_WIDTH&#x27;h10, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span><span class="variable">.CLUT1</span> = ral_mem_CLUT1::type_id::create(<span class="string">&quot;CLUT1&quot;</span>,,get_full_name());</span><br><span class="line"><span class="keyword">this</span><span class="variable">.CLUT1</span><span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">this</span><span class="variable">.CLUT1</span><span class="variable">.build</span>();</span><br><span class="line"><span class="keyword">this</span><span class="variable">.default_map</span><span class="variable">.add_mem</span>(<span class="keyword">this</span><span class="variable">.CLUT1</span>, `UVM_REG_ADDR_WIDTH&#x27;hC00, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> ral_reg_CTRL <span class="keyword">extends</span> uvm_reg;</span><br><span class="line"><span class="keyword">class</span> ral_reg_STAT <span class="keyword">extends</span> uvm_reg;</span><br><span class="line"><span class="keyword">class</span> ral_reg_HTIM <span class="keyword">extends</span> uvm_reg;</span><br><span class="line"><span class="keyword">class</span> ral_reg_VTIM <span class="keyword">extends</span> uvm_reg;</span><br><span class="line"><span class="keyword">class</span> ral_reg_C1CR <span class="keyword">extends</span> uvm_reg;</span><br><span class="line"><span class="keyword">class</span> ral_mem_CLUT1 <span class="keyword">extends</span> uvm_mem;</span><br><span class="line"><span class="keyword">class</span> ral_block_vga_lcd <span class="keyword">extends</span> uvm_reg_block;</span><br></pre></td></tr></table></figure>
<h2 id="ralgen-command">ralgen command</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ralgen -uvm -t dut_regmodel0 vga_lcd_env.ralf</span><br></pre></td></tr></table></figure>
<h2 id="byte-or-halfword-access">BYTE or HALFWORD access</h2>
<p>User is verifying 32 bit registers and the design also allows the
BYTE (8 bits) and HALFWORD (16 bits) accesses.</p>
<blockquote>
<p>this is achieved by setting the <strong>bit_addressing=0</strong>
field in the <strong>uvm_reg_block::create_map</strong> function.</p>
<p>Using <code>create_map</code> in <code>uvm_reg_block</code>, you can
change the type of addressing scheme you want to use; namely BYTE or
HALFWORD.</p>
</blockquote>
<p><strong>create_map</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">virtual</span> <span class="keyword">function</span> uvm_reg_map create_map( <span class="keyword">string</span> name,</span><br><span class="line">                                       uvm_reg_addr_t base_addr,</span><br><span class="line">                                       <span class="keyword">int</span> <span class="keyword">unsigned</span> n_bytes,</span><br><span class="line">                                       uvm_endianness_e endian,</span><br><span class="line">                                       <span class="keyword">bit</span> byte_addressing)</span><br></pre></td></tr></table></figure>
<p>Creates an address map with the specified name, then configures it
with the following properties:</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>base_addr</td>
<td>It is the base address for the map. All registers, memories, and
sub-blocks within the map will be at offsets to this address.</td>
</tr>
<tr class="even">
<td>n_bytes</td>
<td>It is the byte-width of the bus on which this map is used</td>
</tr>
<tr class="odd">
<td>endian</td>
<td>It is the endian format. See uvm_endianness_e for possible
values.</td>
</tr>
<tr class="even">
<td>byte_addressing</td>
<td>It specifies whether consecutive addresses referred are <strong>1
byte apart (TRUE)</strong> or <strong>n_bytes apart (FALSE)</strong>.
Default is TRUE.</td>
</tr>
</tbody>
</table>
<ul>
<li>For HALFWORD addressing, you should call create_map the following
way:</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default_map = create_map(get_name(), <span class="number">0</span>, <span class="number">2</span>, UVM_LITTLE_ENDIAN, <span class="number">0</span>); <span class="comment">// 32 bit registers offset are 0x00, 0x02, 0x04</span></span><br></pre></td></tr></table></figure>
<ul>
<li>For WORD addressing</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default_map = create_map(get_name(), <span class="number">0</span>, <span class="number">4</span>, UVM_LITTLE_ENDIAN, <span class="number">0</span>); <span class="comment">// 32 bit registers offset are 0x00, 0x01, 0x02</span></span><br></pre></td></tr></table></figure>
<ul>
<li>For BYTE addressing (default) :</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default_map = create_map(get_name(), <span class="number">0</span>, <span class="number">4</span>, UVM_LITTLE_ENDIAN, <span class="number">1</span>); <span class="comment">// 32 bit registers offset are 0x00, 0x04, 0x08</span></span><br></pre></td></tr></table></figure>
<ul>
<li>BYTE width and byte addressing</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default_map = create_map(get_name(), <span class="number">0</span>, <span class="number">1</span>, UVM_LITTLE_ENDIAN, <span class="number">1</span>); <span class="comment">// 32 bit registers offset are 0x00, 0x04, 0x08 </span></span><br></pre></td></tr></table></figure>
<h2 id="uvm_reg_blockcreate_map">uvm_reg_block::create_map</h2>
<p>Create an address map in this block</p>
<blockquote>
<p>n_bytes - the byte-width of the bus on which this map is used</p>
<p>byte_addressing - specifies whether consecutive addresses refer are 1
byte apart (TRUE) or <code>n_bytes</code> apart (FALSE). Default is
TRUE.</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> uvm_reg_map uvm_reg_block::create_map(<span class="keyword">string</span> name,</span><br><span class="line">                                               uvm_reg_addr_t base_addr,</span><br><span class="line">                                               <span class="keyword">int</span> <span class="keyword">unsigned</span> n_bytes,</span><br><span class="line">                                               uvm_endianness_e endian,</span><br><span class="line">                                               <span class="keyword">bit</span> byte_addressing=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   uvm_reg_map  map; </span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span><span class="variable">.locked</span>) <span class="keyword">begin</span></span><br><span class="line">      `uvm_error(<span class="string">&quot;RegModel&quot;</span>, <span class="string">&quot;Cannot add map to locked model&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">end</span>  </span><br><span class="line"></span><br><span class="line">   map = uvm_reg_map::type_id::create(name,,<span class="keyword">this</span><span class="variable">.get_full_name</span>());</span><br><span class="line">   map<span class="variable">.configure</span>(<span class="keyword">this</span>,base_addr,n_bytes,endian,byte_addressing);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">this</span><span class="variable">.maps</span>[map] = <span class="number">1</span>; </span><br><span class="line">   <span class="keyword">if</span> (maps<span class="variable">.num</span>() == <span class="number">1</span>)</span><br><span class="line">     default_map = map; </span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> map; </span><br><span class="line"><span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<h2 id="uvm_reg_mapadd_reg">uvm_reg_map::add_reg</h2>
<p>The register is located at the specified address <em>offset</em> from
this maps configured base address.</p>
<p>The number of consecutive physical addresses occupied by the register
depends on the width of the register and the number of bytes in the
physical interface corresponding to this address map.</p>
<p>If <em>unmapped</em> is TRUE, the register does not occupy any
physical addresses and the base address is ignored. Unmapped registers
require a user-defined <em>frontdoor</em> to be specified.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_map::add_reg(uvm_reg rg,  </span><br><span class="line">                                   uvm_reg_addr_t offset,</span><br><span class="line">                                   <span class="keyword">string</span> rights = <span class="string">&quot;RW&quot;</span>,</span><br><span class="line">                                   <span class="keyword">bit</span> unmapped=<span class="number">0</span>,</span><br><span class="line">                                   uvm_reg_frontdoor frontdoor=<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (m_regs_info<span class="variable">.exists</span>(rg)) <span class="keyword">begin</span></span><br><span class="line">      `uvm_error(<span class="string">&quot;RegModel&quot;</span>, &#123;<span class="string">&quot;Register &#x27;&quot;</span>,rg<span class="variable">.get_name</span>(),</span><br><span class="line">                 <span class="string">&quot;&#x27; has already been added to map &#x27;&quot;</span>,get_name(),<span class="string">&quot;&#x27;&quot;</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">end</span>  </span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (rg<span class="variable">.get_parent</span>() != get_parent()) <span class="keyword">begin</span></span><br><span class="line">      `uvm_error(<span class="string">&quot;RegModel&quot;</span>,</span><br><span class="line">         &#123;<span class="string">&quot;Register &#x27;&quot;</span>,rg<span class="variable">.get_full_name</span>(),<span class="string">&quot;&#x27; may not be added to address map &#x27;&quot;</span>,</span><br><span class="line">          get_full_name(),<span class="string">&quot;&#x27; : they are not in the same block&quot;</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">end</span>  </span><br><span class="line">   </span><br><span class="line">   rg<span class="variable">.add_map</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">   uvm_reg_map_info info = <span class="keyword">new</span>; </span><br><span class="line">   info<span class="variable">.offset</span>   = offset;</span><br><span class="line">   info<span class="variable">.rights</span>   = rights;</span><br><span class="line">   info<span class="variable">.unmapped</span> = unmapped;</span><br><span class="line">   info<span class="variable">.frontdoor</span> = frontdoor;</span><br><span class="line">   m_regs_info[rg] = info;</span><br><span class="line">   <span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<h2 id="register-defines">Register Defines</h2>
<h3 id="uvm_reg_addr_width">`UVM_REG_ADDR_WIDTH</h3>
<p>Maximum address width in bits</p>
<blockquote>
<p>Default value is 64. Used to define the <uvm_reg_addr_t> type.</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">ifndef</span> UVM_REG_ADDR_WIDTH</span></span><br><span class="line"> <span class="meta">`<span class="keyword">define</span> UVM_REG_ADDR_WIDTH 64</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h3 id="uvm_reg_data_width">`UVM_REG_DATA_WIDTH</h3>
<p>Maximum data width in bits</p>
<blockquote>
<p>Default value is 64. Used to define the <uvm_reg_data_t> type.</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">ifndef</span> UVM_REG_DATA_WIDTH</span></span><br><span class="line"> <span class="meta">`<span class="keyword">define</span> UVM_REG_DATA_WIDTH 64</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="generic-ralf-features-and-ip-xact-mapping">Generic RALF Features
and IP-XACT Mapping</h2>
<h3 id="field">field</h3>
<p><img src="/2022/03/14/uvm-reg-ralf/image-20220314212141988.png"
alt="image-20220314212141988" /></p>
<h3 id="register">register</h3>
<h4 id="addressoffset">addressOffset</h4>
<p>a register has an <code>addressOffset</code> that describes the
location of the register expressed in <code>addressUnitBits</code> as
offset to the starting address of the containing
<code>addressBlock</code> or the containing
<code>registerFile</code></p>
<h4 id="addressunitbits">addressUnitBits</h4>
<p>The <code>addressUnitBits</code> element describes the number of bits
of an address increment between two <strong>consecutive addressable
units</strong> in the <code>addressSpace</code>. If
<code>addressUnitBits</code> is not described, then its value
<strong>defaults to 8</strong>, indicating a
<strong>byte-addressable</strong> <code>addressSpace</code></p>
<p><img src="/2022/03/14/uvm-reg-ralf/image-20220314212217722.png"
alt="image-20220314212217722" /></p>
<h3 id="block">block</h3>
<p><img src="/2022/03/14/uvm-reg-ralf/image-20220314212251012.png"
alt="image-20220314212251012" /></p>
<h3 id="memory">memory</h3>
<p><img src="/2022/03/14/uvm-reg-ralf/image-20220314212427347.png"
alt="image-20220314212427347" /></p>
<h2 id="reference">Reference</h2>
<p>UVM Register Abstraction Layer Generator User Guide, S-2021.09-SP1,
December 2021</p>
<p><a
target="_blank" rel="noopener" href="https://www.accellera.org/images/downloads/standards/ip-xact/IP-XACT_User_Guide_2018-02-16.pdf">User
guide for the IEEE 1685 Standard for IP-XACT</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/13/jitter-amplification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/13/jitter-amplification/" class="post-title-link" itemprop="url">jitter amplification</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-13 23:02:11" itemprop="dateCreated datePublished" datetime="2022-03-13T23:02:11+00:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/analog/" itemprop="url" rel="index"><span itemprop="name">analog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="transient-noise-and-rms_jitter-function">1. transient noise and
rms_jitter function</h2>
<p><img
src="/2022/03/13/jitter-amplification/image-20220608233610066.png"
alt="image-20220608233610066" /></p>
<p><img
src="/2022/03/13/jitter-amplification/image-20220313230930333.png"
alt="image-20220313230930333" /></p>
<blockquote>
<p><code>RJ(rms)</code>: single Edge or Both Edge?</p>
<p><code>RJ(seed)</code>: what is it?</p>
</blockquote>
<h2 id="phase-noise-method">2 phase noise method</h2>
<p>Directly compare the input phase noise and output phase noise, the
input waveform maybe is the PLL output or other clock distribution end
point</p>
<h2 id="jitter-impulse-responsejir-jitter-impulse-responsejir">3. Jitter
Impulse Response(JIR) &amp; Jitter Impulse Response(JIR)</h2>
<p><img
src="/2022/03/13/jitter-amplification/image-20220313231013645.png"
alt="image-20220313231013645" /></p>
<p><img
src="/2022/03/13/jitter-amplification/image-20220313231027512.png"
alt="image-20220313231027512" /></p>
<p><img
src="/2022/03/13/jitter-amplification/image-20220313231038542.png"
alt="image-20220313231038542" /></p>
<h3 id="example">Example</h3>
<h4 id="low-pass-filter">Low Pass Filter</h4>
<p><img
src="/2022/03/13/jitter-amplification/image-20220322124344158.png"
alt="image-20220322124344158" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">32</span>;</span><br><span class="line">x = <span class="built_in">zeros</span>(N,<span class="number">1</span>);</span><br><span class="line">x(<span class="number">1</span>) = <span class="number">6</span>;</span><br><span class="line">x(<span class="number">2</span>) = <span class="number">-2</span>;</span><br><span class="line">x(<span class="number">3</span>) = <span class="number">0.5</span>;</span><br><span class="line">x = x/<span class="number">5</span>;</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>)</span><br><span class="line">stem(x)</span><br><span class="line">Y = fft(x, N);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">plot</span>(<span class="built_in">abs</span>(Y(<span class="number">1</span>:N/<span class="number">2</span>)));</span><br></pre></td></tr></table></figure>
<p><img
src="/2022/03/13/jitter-amplification/image-20220322124902394.png"
alt="image-20220322124902394" /></p>
<p><img
src="/2022/03/13/jitter-amplification/image-20220322124932584.png"
alt="image-20220322124932584" /></p>
<h4 id="high-pass-filter">High Pass Filter</h4>
<p><img
src="/2022/03/13/jitter-amplification/image-20220327010223664.png"
alt="image-20220327010223664" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">128</span>;</span><br><span class="line">j_hp = <span class="built_in">zeros</span>(N, <span class="number">1</span>);</span><br><span class="line">j_hp(<span class="number">1</span>)= <span class="number">1</span>;</span><br><span class="line">j_hp(<span class="number">2</span>) = <span class="number">0.5</span>;</span><br><span class="line">j_hp(<span class="number">3</span>) = <span class="number">-0.3</span>;</span><br><span class="line">j_hp(<span class="number">4</span>) = <span class="number">0.3</span>;</span><br><span class="line">j_hp(<span class="number">5</span>) = <span class="number">-0.1</span>;</span><br><span class="line">jtf_hp = <span class="built_in">abs</span>(fft(j_hp));</span><br><span class="line">semilogx(jtf_hp(<span class="number">1</span>:N/<span class="number">2</span>+<span class="number">1</span>));</span><br><span class="line">xlabel(<span class="string">&#x27;Freq&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;Jitter Amplification Factor&#x27;</span>);</span><br><span class="line">grid on;</span><br></pre></td></tr></table></figure>
<p><img
src="/2022/03/13/jitter-amplification/image-20220327010421475.png"
alt="image-20220327010421475" /></p>
<h3 id="inverter-chain">inverter chain</h3>
<p><img
src="/2022/03/13/jitter-amplification/image-20220608232251056.png"
alt="image-20220608232251056" /></p>
<p><img
src="/2022/03/13/jitter-amplification/image-20220608232658054.png"
alt="image-20220608232658054" /></p>
<p><img
src="/2022/03/13/jitter-amplification/image-20220608232438188.png"
alt="image-20220608232438188" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ji = <span class="number">1e-12</span>; <span class="comment">% 1ps</span></span><br><span class="line">data = importdata(<span class="string">&#x27;/path/to/jir.csv&#x27;</span>);</span><br><span class="line">jo = data.data(:, <span class="number">2</span>);</span><br><span class="line">Ts = <span class="number">31.25e-12</span>;</span><br><span class="line">Fs = <span class="number">1</span>/Ts;</span><br><span class="line">jir = jo/ji;</span><br><span class="line">N = <span class="number">2</span>^(<span class="built_in">nextpow2</span>(<span class="built_in">length</span>(jir)<span class="number">-1</span>));</span><br><span class="line">Y = fft(jir, N);</span><br><span class="line">jif = <span class="built_in">abs</span>(Y(<span class="number">1</span>:N/<span class="number">2</span>+<span class="number">1</span>));</span><br><span class="line">freqs= Fs/N*(<span class="number">0</span>:N/<span class="number">2</span>);</span><br><span class="line"><span class="built_in">plot</span>(feqs/<span class="number">1e9</span>, jtf, <span class="string">&#x27;linewidth&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">grid on;</span><br><span class="line">xlabel(<span class="string">&#x27;Freq (GHz)&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;JTF&#x27;</span>);</span><br><span class="line">title(<span class="string">&#x27;JTF of inverter chain&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img
src="/2022/03/13/jitter-amplification/image-20220608233303576.png"
alt="image-20220608233303576" /></p>
<h2 id="reference">Reference</h2>
<p><a
target="_blank" rel="noopener" href="https://people.engr.tamu.edu/spalermo/ecen689/lecture13_ee720_fwd_clk_deskew.pdf">Sam
Palermo, ECEN 720, Lecture 13 - Forwarded Clock Deskew Circuits</a></p>
<p>B. Casper and F. O'Mahony, "Clocking Analysis, Implementation and
Measurement Techniques for High-Speed Data Links—A Tutorial," in IEEE
Transactions on Circuits and Systems I: Regular Papers, vol. 56, no. 1,
pp. 17-39, Jan. 2009, doi: 10.1109/TCSI.2008.931647.</p>
<p>Phase-Locked Frequency Generation and Clocking : Architectures and
Circuits for Modern Wireless and Wireline Systems by Woogeun Rhee (2020,
Hardcover)</p>
<p>Mathuranathan Viswanathan, Digital Modulations using Matlab : Build
Simulation Models from Scratch</p>
<p>Tony Chan Carusone, University of Toronto, Canada, 2022 CICC
Educational Sessions "Architectural Considerations in 100+ Gbps Wireline
Transceivers"</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/13/uvm-ral-src-reading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/13/uvm-ral-src-reading/" class="post-title-link" itemprop="url">UVM Register Abstraction Layer (RAL) - source code reading</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-13 17:15:22" itemprop="dateCreated datePublished" datetime="2022-03-13T17:15:22+00:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="field-access-policies">Field Access Policies</h2>
<p><img
src="/2022/03/13/uvm-ral-src-reading/image-20220526092125583.png"
alt="image-20220526092125583" /></p>
<p>whether a register field can be read or written depends on both the
field's configured access policy and the register's rights in the map
being used to access the field</p>
<p><a
target="_blank" rel="noopener" href="http://www.verilab.com/files/litterick_register_final.pdf">http://www.verilab.com/files/litterick_register_final.pdf</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.verilab.com/files/litterick_register_slides_sm.pdf">https://www.verilab.com/files/litterick_register_slides_sm.pdf</a></p>
<h2 id="uvm_regwrite">uvm_reg::write</h2>
<ul>
<li><p>If a back-door access path is used, the effect of writing the
register through a physical access is mimicked. For example,
<strong>read-only</strong> bits in the registers will
<strong>not</strong> be written.</p></li>
<li><p>The <strong>mirrored value</strong> will be updated using the
<code>uvm_reg::predict()</code> method.</p></li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> write(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                          <span class="keyword">input</span>  uvm_reg_data_t    value,</span><br><span class="line">                          <span class="keyword">input</span>  uvm_path_e        path = UVM_DEFAULT_PATH,</span><br><span class="line">                          <span class="keyword">input</span>  uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                          <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                          <span class="keyword">input</span>  <span class="keyword">int</span>               prior = -<span class="number">1</span>,</span><br><span class="line">                          <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                          <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                          <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> do_write(uvm_reg_item rw);</span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">task</span> uvm_reg::write(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                    <span class="keyword">input</span>  uvm_reg_data_t    value,</span><br><span class="line">                    <span class="keyword">input</span>  uvm_path_e        path = UVM_DEFAULT_PATH,</span><br><span class="line">                    <span class="keyword">input</span>  uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                    <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                    <span class="keyword">input</span>  <span class="keyword">int</span>               prior = -<span class="number">1</span>,</span><br><span class="line">                    <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                    <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// create an abstract transaction for this operation</span></span><br><span class="line">   uvm_reg_item rw;</span><br><span class="line"></span><br><span class="line">   XatomicX(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   set(value);</span><br><span class="line"></span><br><span class="line">   rw = uvm_reg_item::type_id::create(<span class="string">&quot;write_item&quot;</span>,,get_full_name());</span><br><span class="line">   rw<span class="variable">.element</span>      = <span class="keyword">this</span>;</span><br><span class="line">   rw<span class="variable">.element_kind</span> = UVM_REG;</span><br><span class="line">   rw<span class="variable">.kind</span>         = UVM_WRITE;</span><br><span class="line">   rw<span class="variable">.value</span>[<span class="number">0</span>]     = value;</span><br><span class="line">   rw<span class="variable">.path</span>         = path;</span><br><span class="line">   rw<span class="variable">.map</span>          = map;</span><br><span class="line">   rw<span class="variable">.parent</span>       = parent;</span><br><span class="line">   rw<span class="variable">.prior</span>        = prior;</span><br><span class="line">   rw<span class="variable">.extension</span>    = extension;</span><br><span class="line">   rw<span class="variable">.fname</span>        = fname;</span><br><span class="line">   rw<span class="variable">.lineno</span>       = lineno;</span><br><span class="line"></span><br><span class="line">   do_write(rw);</span><br><span class="line"></span><br><span class="line">   status = rw<span class="variable">.status</span>;</span><br><span class="line"></span><br><span class="line">   XatomicX(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endtask</span></span><br></pre></td></tr></table></figure>
<h2 id="uvm_regread">uvm_reg::read</h2>
<ul>
<li><p>If a back-door access path is used, the effect of reading the
register through a physical access is mimicked. For example,
<strong>clear-on-read</strong> bits in the registers will be set to
<strong>zero</strong>.</p></li>
<li><p>The <strong>mirrored value</strong> will be updated using the
<code>uvm_reg::predict()</code> method.</p></li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> read(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                         <span class="keyword">output</span> uvm_reg_data_t    value,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_path_e        path = UVM_DEFAULT_PATH,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">int</span>               prior = -<span class="number">1</span>,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> do_read(uvm_reg_item rw);</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/13/uvm-ral-src-reading/uvmreg_read.drawio.svg"
alt="uvmreg_read.drawio" /></p>
<blockquote>
<p><strong>readback value can be different from m_mirrored , m_desired
or value</strong></p>
</blockquote>
<h2 id="uvm_regpoke">uvm_reg::poke</h2>
<ul>
<li><p>Deposit the value in the DUT register corresponding to this
abstraction class instance, <strong>as-is</strong>, using a back-door
access.</p></li>
<li><p>Uses the HDL path for the design abstraction specified by
<strong>kind</strong>.</p></li>
<li><p>The <strong>mirrored value</strong> will be updated using the
<code>uvm_reg::predict()</code> method.</p></li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> poke(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_reg_data_t    value,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">string</span>            kind = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="uvm_regpeek">uvm_reg::peek</h2>
<ul>
<li>Sample the value in the DUT register corresponding to this
abstraction class instance using a <strong>back-door</strong> access.
The register value is sampled, not modified.</li>
<li>Uses the HDL path for the design abstraction specified by
<code>kind</code>.</li>
<li>The <strong>mirrored value</strong> will be updated using the
<code>uvm_reg::predict()</code> method.</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> peek(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                         <span class="keyword">output</span> uvm_reg_data_t    value,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">string</span>            kind = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                         <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="uvm_regmirror">uvm_reg::mirror</h2>
<ul>
<li><p>Read the register and optionally compared the <strong>readback
value</strong> with the <strong>current mirrored value</strong> if
<code>check</code> is <code>UVM_CHECK</code>.</p></li>
<li><p>The <strong>mirrored value</strong> will be updated using the
<code>uvm_reg::predict()</code> method based on the <strong>readback
value</strong>.</p></li>
<li><p>The mirroring can be performed using the physical interfaces
(frontdoor) or <code>uvm_reg::peek()</code> (backdoor).</p></li>
<li><p>If the register contains <strong>write-only</strong> fields,
their content is mirrored and optionally checked only if a
<code>UVM_BACKDOOR</code> access path is used to read the
register.</p></li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> mirror(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                           <span class="keyword">input</span> uvm_check_e        check  = UVM_NO_CHECK,</span><br><span class="line">                           <span class="keyword">input</span> uvm_path_e         path = UVM_DEFAULT_PATH,</span><br><span class="line">                           <span class="keyword">input</span> uvm_reg_map        map = <span class="literal">null</span>,</span><br><span class="line">                           <span class="keyword">input</span> uvm_sequence_base  parent = <span class="literal">null</span>,</span><br><span class="line">                           <span class="keyword">input</span> <span class="keyword">int</span>                prior = -<span class="number">1</span>,</span><br><span class="line">                           <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                           <span class="keyword">input</span> <span class="keyword">string</span>             fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                           <span class="keyword">input</span> <span class="keyword">int</span>                lineno = <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="uvm_regupdate">uvm_reg::update</h2>
<ul>
<li>Write this register if the DUT register is out-of-date with the
desired/mirrored value in the abstraction class, as determined by the
<code>uvm_reg::needs_update()</code> method.</li>
<li>The update can be performed using the using the physical interfaces
(frontdoor) or <code>uvm_reg::poke()</code> (backdoor) access.</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">task</span> update(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                           <span class="keyword">input</span>  uvm_path_e        path = UVM_DEFAULT_PATH,</span><br><span class="line">                           <span class="keyword">input</span>  uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                           <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                           <span class="keyword">input</span>  <span class="keyword">int</span>               prior = -<span class="number">1</span>,</span><br><span class="line">                           <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                           <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                           <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">bit</span> uvm_reg::needs_update();</span><br><span class="line">    needs_update = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (m_fields[i]) <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">if</span> (m_fields[i]<span class="variable">.needs_update</span>()) <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span>: needs_update</span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">task</span> uvm_reg::update(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                     <span class="keyword">input</span>  uvm_path_e        path = UVM_DEFAULT_PATH,</span><br><span class="line">                     <span class="keyword">input</span>  uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                     <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                     <span class="keyword">input</span>  <span class="keyword">int</span>               prior = -<span class="number">1</span>,</span><br><span class="line">                     <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                     <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                     <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line">   uvm_reg_data_t upd;</span><br><span class="line"></span><br><span class="line">   status = UVM_IS_OK;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!needs_update()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Concatenate the write-to-update values from each field</span></span><br><span class="line">   <span class="comment">// Fields are stored in LSB or MSB order</span></span><br><span class="line">   upd = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">foreach</span> (m_fields[i])</span><br><span class="line">      upd |= m_fields[i]<span class="variable">.XupdateX</span>() &lt;&lt; m_fields[i]<span class="variable">.get_lsb_pos</span>();</span><br><span class="line"></span><br><span class="line">   write(status, upd, path, map, parent, prior, extension, fname, lineno);</span><br><span class="line"><span class="keyword">endtask</span>: update</span><br></pre></td></tr></table></figure>
<h2 id="uvm_regpredict">uvm_reg::predict</h2>
<ul>
<li>Update the <strong>mirrored and desired value</strong> for this
register.</li>
<li>Predict the mirror (and desired) value of the fields in the register
based on the specified observed <code>value</code> on a specified
address <code>map</code>, or based on a calculated value.</li>
<li>See <code>uvm_reg_field::predict()</code> for more details.</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">function</span> <span class="keyword">bit</span> predict (uvm_reg_data_t    value,</span><br><span class="line">                                     uvm_reg_byte_en_t be = -<span class="number">1</span>,</span><br><span class="line">                                     uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                                     uvm_path_e        path = UVM_FRONTDOOR,</span><br><span class="line">                                     uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                                     <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                                     <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">virtual</span> <span class="keyword">function</span> <span class="keyword">void</span> do_predict</span><br><span class="line">                             (uvm_reg_item      rw,</span><br><span class="line">                              uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                              uvm_reg_byte_en_t be = -<span class="number">1</span>);</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<h3 id="uvm_regdo_predict">uvm_reg::do_predict</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg::do_predict(uvm_reg_item      rw,</span><br><span class="line">                                  uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                                  uvm_reg_byte_en_t be = -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   uvm_reg_data_t reg_value = rw<span class="variable">.value</span>[<span class="number">0</span>];</span><br><span class="line">   m_fname = rw<span class="variable">.fname</span>;</span><br><span class="line">   m_lineno = rw<span class="variable">.lineno</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (rw<span class="variable">.status</span> ==UVM_IS_OK )</span><br><span class="line">   rw<span class="variable">.status</span> = UVM_IS_OK;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (m_is_busy &amp;&amp; kind == UVM_PREDICT_DIRECT) <span class="keyword">begin</span></span><br><span class="line">      `uvm_warning(<span class="string">&quot;RegModel&quot;</span>, &#123;<span class="string">&quot;Trying to predict value of register &#x27;&quot;</span>,</span><br><span class="line">                  get_full_name(),<span class="string">&quot;&#x27; while it is being accessed&quot;</span>&#125;)</span><br><span class="line">      rw<span class="variable">.status</span> = UVM_NOT_OK;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">foreach</span> (m_fields[i]) <span class="keyword">begin</span></span><br><span class="line">      rw<span class="variable">.value</span>[<span class="number">0</span>] = (reg_value &gt;&gt; m_fields[i]<span class="variable">.get_lsb_pos</span>()) &amp;</span><br><span class="line">                                 ((<span class="number">1</span> &lt;&lt; m_fields[i]<span class="variable">.get_n_bits</span>())-<span class="number">1</span>);</span><br><span class="line">      m_fields[i]<span class="variable">.do_predict</span>(rw, kind, be&gt;&gt;(m_fields[i]<span class="variable">.get_lsb_pos</span>()/<span class="number">8</span>));</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">   rw<span class="variable">.value</span>[<span class="number">0</span>] = reg_value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endfunction</span>: do_predict</span><br></pre></td></tr></table></figure>
<h3 id="uvm_reg_fielddo_predict">uvm_reg_field::do_predict</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_field::do_predict(uvm_reg_item      rw,</span><br><span class="line">                                        uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                                        uvm_reg_byte_en_t be = -<span class="number">1</span>);</span><br><span class="line">   </span><br><span class="line">   uvm_reg_data_t field_val = rw<span class="variable">.value</span>[<span class="number">0</span>] &amp; ((<span class="number">1</span> &lt;&lt; m_size)-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (rw<span class="variable">.status</span> != UVM_NOT_OK)</span><br><span class="line">     rw<span class="variable">.status</span> = UVM_IS_OK;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Assume that the entire field is enabled</span></span><br><span class="line">   <span class="keyword">if</span> (!be[<span class="number">0</span>])</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">   m_fname = rw<span class="variable">.fname</span>;</span><br><span class="line">   m_lineno = rw<span class="variable">.lineno</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> (kind)</span><br><span class="line"></span><br><span class="line">     UVM_PREDICT_WRITE:</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         uvm_reg_field_cb_iter cbs = <span class="keyword">new</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (rw<span class="variable">.path</span> == UVM_FRONTDOOR || rw<span class="variable">.path</span> == UVM_PREDICT)</span><br><span class="line">            field_val = XpredictX(m_mirrored, field_val, rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">         m_written = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span> (uvm_reg_cbs cb = cbs<span class="variable">.first</span>(); cb != <span class="literal">null</span>; cb = cbs<span class="variable">.next</span>())</span><br><span class="line">            cb<span class="variable">.post_predict</span>(<span class="keyword">this</span>, m_mirrored, field_val, </span><br><span class="line">                            UVM_PREDICT_WRITE, rw<span class="variable">.path</span>, rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">         field_val &amp;= (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">     UVM_PREDICT_READ:</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         uvm_reg_field_cb_iter cbs = <span class="keyword">new</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (rw<span class="variable">.path</span> == UVM_FRONTDOOR || rw<span class="variable">.path</span> == UVM_PREDICT) <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> acc = get_access(rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (acc == <span class="string">&quot;RC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;WRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;WSRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;W1SRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;W0SRC&quot;</span>)</span><br><span class="line">              field_val = <span class="number">0</span>;  <span class="comment">// (clear)</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (acc == <span class="string">&quot;RS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WCRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;W1CRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;W0CRS&quot;</span>)</span><br><span class="line">              field_val = (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>; <span class="comment">// all 1&#x27;s (set)</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (acc == <span class="string">&quot;WO&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WOC&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WOS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WO1&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;NOACCESS&quot;</span>)</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span> (uvm_reg_cbs cb = cbs<span class="variable">.first</span>(); cb != <span class="literal">null</span>; cb = cbs<span class="variable">.next</span>())</span><br><span class="line">            cb<span class="variable">.post_predict</span>(<span class="keyword">this</span>, m_mirrored, field_val,</span><br><span class="line">                            UVM_PREDICT_READ, rw<span class="variable">.path</span>, rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">         field_val &amp;= (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">     UVM_PREDICT_DIRECT:</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span> (m_parent<span class="variable">.is_busy</span>()) <span class="keyword">begin</span></span><br><span class="line">           `uvm_warning(<span class="string">&quot;RegModel&quot;</span>, &#123;<span class="string">&quot;Trying to predict value of field &#x27;&quot;</span>,</span><br><span class="line">              get_name(),<span class="string">&quot;&#x27; while register &#x27;&quot;</span>,m_parent<span class="variable">.get_full_name</span>(),</span><br><span class="line">              <span class="string">&quot;&#x27; is being accessed&quot;</span>&#125;)</span><br><span class="line">           rw<span class="variable">.status</span> = UVM_NOT_OK;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// update the mirror with predicted value</span></span><br><span class="line">   m_mirrored = field_val;</span><br><span class="line">   m_desired  = field_val;</span><br><span class="line">   <span class="keyword">this</span><span class="variable">.value</span> = field_val;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endfunction</span>: do_predict</span><br></pre></td></tr></table></figure>
<h3 id="uvm_reg_fieldxpredictx">uvm_reg_field::XpredictX</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> uvm_reg_data_t uvm_reg_field::XpredictX (uvm_reg_data_t cur_val,</span><br><span class="line">                                                  uvm_reg_data_t wr_val,</span><br><span class="line">                                                  uvm_reg_map    map);</span><br><span class="line">   uvm_reg_data_t mask = (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> (get_access(map))</span><br><span class="line">     <span class="string">&quot;RO&quot;</span>:    <span class="keyword">return</span> cur_val;</span><br><span class="line">     <span class="string">&quot;RW&quot;</span>:    <span class="keyword">return</span> wr_val;</span><br><span class="line">     <span class="string">&quot;RC&quot;</span>:    <span class="keyword">return</span> cur_val;</span><br><span class="line">     <span class="string">&quot;RS&quot;</span>:    <span class="keyword">return</span> cur_val;</span><br><span class="line">     <span class="string">&quot;WC&quot;</span>:    <span class="keyword">return</span> &#x27;<span class="number">0</span>;</span><br><span class="line">     <span class="string">&quot;WS&quot;</span>:    <span class="keyword">return</span> mask;</span><br><span class="line">     <span class="string">&quot;WRC&quot;</span>:   <span class="keyword">return</span> wr_val;</span><br><span class="line">     <span class="string">&quot;WRS&quot;</span>:   <span class="keyword">return</span> wr_val;</span><br><span class="line">     <span class="string">&quot;WSRC&quot;</span>:  <span class="keyword">return</span> mask;</span><br><span class="line">     <span class="string">&quot;WCRS&quot;</span>:  <span class="keyword">return</span> &#x27;<span class="number">0</span>;</span><br><span class="line">     <span class="string">&quot;W1C&quot;</span>:   <span class="keyword">return</span> cur_val &amp; (~wr_val);</span><br><span class="line">     <span class="string">&quot;W1S&quot;</span>:   <span class="keyword">return</span> cur_val | wr_val;</span><br><span class="line">     <span class="string">&quot;W1T&quot;</span>:   <span class="keyword">return</span> cur_val ^ wr_val;</span><br><span class="line">     <span class="string">&quot;W0C&quot;</span>:   <span class="keyword">return</span> cur_val &amp; wr_val;</span><br><span class="line">     <span class="string">&quot;W0S&quot;</span>:   <span class="keyword">return</span> cur_val | (~wr_val &amp; mask);</span><br><span class="line">     <span class="string">&quot;W0T&quot;</span>:   <span class="keyword">return</span> cur_val ^ (~wr_val &amp; mask);</span><br><span class="line">     <span class="string">&quot;W1SRC&quot;</span>: <span class="keyword">return</span> cur_val | wr_val;</span><br><span class="line">     <span class="string">&quot;W1CRS&quot;</span>: <span class="keyword">return</span> cur_val &amp; (~wr_val);</span><br><span class="line">     <span class="string">&quot;W0SRC&quot;</span>: <span class="keyword">return</span> cur_val | (~wr_val &amp; mask);</span><br><span class="line">     <span class="string">&quot;W0CRS&quot;</span>: <span class="keyword">return</span> cur_val &amp; wr_val;</span><br><span class="line">     <span class="string">&quot;WO&quot;</span>:    <span class="keyword">return</span> wr_val;</span><br><span class="line">     <span class="string">&quot;WOC&quot;</span>:   <span class="keyword">return</span> &#x27;<span class="number">0</span>;</span><br><span class="line">     <span class="string">&quot;WOS&quot;</span>:   <span class="keyword">return</span> mask;</span><br><span class="line">     <span class="string">&quot;W1&quot;</span>:    <span class="keyword">return</span> (m_written) ? cur_val : wr_val;</span><br><span class="line">     <span class="string">&quot;WO1&quot;</span>:   <span class="keyword">return</span> (m_written) ? cur_val : wr_val;</span><br><span class="line">     <span class="string">&quot;NOACCESS&quot;</span>: <span class="keyword">return</span> cur_val;</span><br><span class="line">     <span class="keyword">default</span>: <span class="keyword">return</span> wr_val;</span><br><span class="line">   <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">   `uvm_fatal(<span class="string">&quot;RegModel&quot;</span>, <span class="string">&quot;uvm_reg_field::XpredictX(): Internal error&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">endfunction</span>: XpredictX</span><br></pre></td></tr></table></figure>
<h2 id="uvm_regreset-uvm_reg_fieldreset">uvm_reg::reset ,
uvm_reg_field::reset</h2>
<p>Resetting a register model sets the mirror to the reset value
specified in the model</p>
<h3 id="uvm_regreset">uvm_reg::reset</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg::reset(<span class="keyword">string</span> kind = <span class="string">&quot;HARD&quot;</span>);</span><br><span class="line">   <span class="keyword">foreach</span> (m_fields[i])</span><br><span class="line">      m_fields[i]<span class="variable">.reset</span>(kind);</span><br><span class="line">   <span class="comment">// Put back a key in the semaphore if it is checked out</span></span><br><span class="line">   <span class="comment">// in case a thread was killed during an operation</span></span><br><span class="line">   <span class="keyword">void</span>&#x27;(m_atomic<span class="variable">.try_get</span>(<span class="number">1</span>));</span><br><span class="line">   m_atomic<span class="variable">.put</span>(<span class="number">1</span>);</span><br><span class="line">   m_process = <span class="literal">null</span>;</span><br><span class="line">   Xset_busyX(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">endfunction</span>: reset</span><br></pre></td></tr></table></figure>
<h3 id="uvm_reg_fieldreset">uvm_reg_field::reset</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_field::reset(<span class="keyword">string</span> kind = <span class="string">&quot;HARD&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!m_reset<span class="variable">.exists</span>(kind))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">   m_mirrored = m_reset[kind];</span><br><span class="line">   m_desired  = m_mirrored;</span><br><span class="line">   value      = m_mirrored;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (kind == <span class="string">&quot;HARD&quot;</span>)</span><br><span class="line">      m_written  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endfunction</span>: reset</span><br></pre></td></tr></table></figure>
<h2 id="uvm_reg_fieldrandomize">uvm_reg_field::randomize</h2>
<h3 id="uvm_reg_fieldpre_randomize">uvm_reg_field::pre_randomize()</h3>
<p>Update the only publicly known property <code>value</code> with the
<strong>current desired</strong> value so it can be used as a state
variable should the <code>rand_mode</code> of the field be turned
off.</p>
<blockquote>
<p><code>value</code> is <code>m_desired</code> if
<code>rand_mode</code> is off.</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_field::pre_randomize();</span><br><span class="line">   value = m_desired;</span><br><span class="line"><span class="keyword">endfunction</span>: pre_randomize</span><br></pre></td></tr></table></figure>
<h3 id="uvm_reg_fieldpost_randomize">uvm_reg_field::post_randomize</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_field::post_randomize();</span><br><span class="line">   m_desired = value;</span><br><span class="line"><span class="keyword">endfunction</span>: post_randomize</span><br></pre></td></tr></table></figure>
<h2 id="misc">misc</h2>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span>  <span class="keyword">bit</span> <span class="keyword">unsigned</span> [`UVM_REG_DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>]  uvm_reg_data_t ;</span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enum: uvm_predict_e</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// How the mirror is to be updated</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// UVM_PREDICT_DIRECT  - Predicted value is as-is</span></span><br><span class="line"><span class="comment">// UVM_PREDICT_READ    - Predict based on the specified value having been read</span></span><br><span class="line"><span class="comment">// UVM_PREDICT_WRITE   - Predict based on the specified value having been written</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">   <span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">      UVM_PREDICT_DIRECT,</span><br><span class="line">      UVM_PREDICT_READ,</span><br><span class="line">      UVM_PREDICT_WRITE</span><br><span class="line">   &#125; uvm_predict_e;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/12/uvm-ral/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/12/uvm-ral/" class="post-title-link" itemprop="url">UVM Register Abstraction Layer (RAL) - overview</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-12 11:16:25" itemprop="dateCreated datePublished" datetime="2022-03-12T11:16:25+00:00">2022-03-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Within an UVM testbench a register model is used</p>
<ul>
<li><p>either as a means of looking up a mirror of the current DUT
hardware state</p></li>
<li><p>or as means of accessing the hardware via the front or back
door</p>
<p>and updating the register model database.</p></li>
</ul>
<p><img src="/2022/03/12/uvm-ral/image-20220312125516500.png"
alt="image-20220312125516500" /></p>
<h4 id="register-frontdoor-write">Register Frontdoor Write</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.write</span>(status, value, [UVM_FRONTDOOR], <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>Sequence sets <code>uvm_reg</code> with value</li>
<li><code>uvm_reg</code> content is translated into bus transaction</li>
<li>Driver gets bus transaction and writes DUT register</li>
<li><strong>Mirror</strong> can be updated either implicitly or
explicitly (predictor)</li>
</ul>
<h4 id="register-backdoor-write">Register Backdoor Write</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.write</span>(status, value, UVM_BACKDOOR, <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<p><code>uvm_reg</code> uses DPI/XMR to set DUT register with value</p>
<ul>
<li>Physical interface is bypassed</li>
<li>Register behavior is mimicked</li>
</ul>
<h4 id="register-backdoor-poke">Register Backdoor Poke</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.poke</span>(status, value, <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<p><code>uvm_reg</code> used DPI/XMR to set DUT register with
<strong>value as is</strong></p>
<ul>
<li>Physical interface is bypassed</li>
<li>Register behavior is <strong>NOT</strong> mimicked</li>
</ul>
<hr />
<h4 id="register-frontdoor-read">Register Frontdoor Read</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.read</span>(status, value, [UVM_FRONTDOOR], <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>Sequence executes <code>uvm_reg</code> READ</li>
<li><code>uvm_reg</code> is translated into bus transaction</li>
<li>Driver gets bus transaction and read DUT register</li>
<li>Read value is translated into <code>uvm_reg</code> data and returned
to sequence</li>
<li>Mirror updates</li>
</ul>
<h4 id="register-backdoor-read">Register Backdoor Read</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.read</span>(status, value, UVM_BACKDOOR, <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<p><code>uvm_reg</code> used DPI/XMR to get DUT register value</p>
<ul>
<li>Physical interface is bypassed</li>
<li>Register behavior is <strong>mimicked</strong> (acc)</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EXECUTE READ...</span></span><br><span class="line"><span class="keyword">case</span> (rw<span class="variable">.path</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ...VIA USER BACKDOOR</span></span><br><span class="line">   UVM_BACKDOOR: <span class="keyword">begin</span> </span><br><span class="line">      uvm_reg_backdoor bkdr = get_backdoor();</span><br><span class="line"></span><br><span class="line">      uvm_reg_map map = uvm_reg_map::backdoor();</span><br><span class="line">      <span class="keyword">if</span> (map<span class="variable">.get_check_on_read</span>()) exp = get();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (bkdr != <span class="literal">null</span>)</span><br><span class="line">        bkdr<span class="variable">.read</span>(rw);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        backdoor_read(rw);</span><br><span class="line"></span><br><span class="line">      value = rw<span class="variable">.value</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Need to clear RC fields, set RS fields and mask WO fields</span></span><br><span class="line">      <span class="keyword">if</span> (rw<span class="variable">.status</span> != UVM_NOT_OK) <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">         uvm_reg_data_t wo_mask;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">foreach</span> (m_fields[i]) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">string</span> acc = m_fields[i]<span class="variable">.get_access</span>(uvm_reg_map::backdoor());</span><br><span class="line">            <span class="keyword">if</span> (acc == <span class="string">&quot;RC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;WRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;WSRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;W1SRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;W0SRC&quot;</span>) <span class="keyword">begin</span></span><br><span class="line">               value &amp;= ~(((<span class="number">1</span>&lt;&lt;m_fields[i]<span class="variable">.get_n_bits</span>())-<span class="number">1</span>)</span><br><span class="line">                                       &lt;&lt; m_fields[i]<span class="variable">.get_lsb_pos</span>());</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (acc == <span class="string">&quot;RS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WCRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;W1CRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;W0CRS&quot;</span>) <span class="keyword">begin</span></span><br><span class="line">               value |= (((<span class="number">1</span>&lt;&lt;m_fields[i]<span class="variable">.get_n_bits</span>())-<span class="number">1</span>)</span><br><span class="line">                                       &lt;&lt; m_fields[i]<span class="variable">.get_lsb_pos</span>());</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (acc == <span class="string">&quot;WO&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WOC&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WOS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WO1&quot;</span>) <span class="keyword">begin</span></span><br><span class="line">               wo_mask |= ((<span class="number">1</span>&lt;&lt;m_fields[i]<span class="variable">.get_n_bits</span>())-<span class="number">1</span>)</span><br><span class="line">                                       &lt;&lt; m_fields[i]<span class="variable">.get_lsb_pos</span>();</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (value != rw<span class="variable">.value</span>[<span class="number">0</span>]) <span class="keyword">begin</span></span><br><span class="line">           uvm_reg_data_t saved;</span><br><span class="line">           saved = rw<span class="variable">.value</span>[<span class="number">0</span>];</span><br><span class="line">           rw<span class="variable">.value</span>[<span class="number">0</span>] = value;</span><br><span class="line">           <span class="keyword">if</span> (bkdr != <span class="literal">null</span>)</span><br><span class="line">              bkdr<span class="variable">.write</span>(rw);</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">              backdoor_write(rw);</span><br><span class="line">           rw<span class="variable">.value</span>[<span class="number">0</span>] = saved;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">         rw<span class="variable">.value</span>[<span class="number">0</span>] &amp;= ~wo_mask;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (map<span class="variable">.get_check_on_read</span>() &amp;&amp;</span><br><span class="line">            rw<span class="variable">.status</span> != UVM_NOT_OK) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">void</span>&#x27;(do_check(exp, rw<span class="variable">.value</span>[<span class="number">0</span>], map));</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         </span><br><span class="line">         do_predict(rw, UVM_PREDICT_READ);</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h4 id="register-backdoor-peek">Register Backdoor Peek</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.peek</span>(status, value, <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<p><code>uvm_reg</code> uses DPI/XMR to get DUT register <strong>value
as is</strong></p>
<ul>
<li>Physical interface is bypassed</li>
<li>Register behavior is <strong>NOT</strong> mimicked</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">task</span> uvm_reg::peek(<span class="keyword">output</span> uvm_status_e      status,</span><br><span class="line">                   <span class="keyword">output</span> uvm_reg_data_t    value,</span><br><span class="line">                   <span class="keyword">input</span>  <span class="keyword">string</span>            kind = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                   <span class="keyword">input</span>  uvm_sequence_base parent = <span class="literal">null</span>,</span><br><span class="line">                   <span class="keyword">input</span>  uvm_object        extension = <span class="literal">null</span>,</span><br><span class="line">                   <span class="keyword">input</span>  <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                   <span class="keyword">input</span>  <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   uvm_reg_backdoor bkdr = get_backdoor();</span><br><span class="line">   uvm_reg_item rw;</span><br><span class="line"></span><br><span class="line">   m_fname = fname;</span><br><span class="line">   m_lineno = lineno;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// create an abstract transaction for this operation</span></span><br><span class="line">   rw = uvm_reg_item::type_id::create(<span class="string">&quot;mem_peek_item&quot;</span>,,get_full_name());</span><br><span class="line">   rw<span class="variable">.element</span>      = <span class="keyword">this</span>;</span><br><span class="line">   rw<span class="variable">.path</span>         = UVM_BACKDOOR;</span><br><span class="line">   rw<span class="variable">.element_kind</span> = UVM_REG;</span><br><span class="line">   rw<span class="variable">.kind</span>         = UVM_READ;</span><br><span class="line">   rw<span class="variable">.bd_kind</span>      = kind;</span><br><span class="line">   rw<span class="variable">.parent</span>       = parent;</span><br><span class="line">   rw<span class="variable">.extension</span>    = extension;</span><br><span class="line">   rw<span class="variable">.fname</span>        = fname;</span><br><span class="line">   rw<span class="variable">.lineno</span>       = lineno;</span><br><span class="line"></span><br><span class="line">   do_predict(rw, UVM_PREDICT_READ);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endtask</span>: peek </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="methods-to-handle-property-of-uvm_reg-or-uvm_reg_block">Methods
to handle property of uvm_reg or uvm_reg_block</h4>
<h5 id="mirror">mirror</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.mirror</span>(status, [check], [path], <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br><span class="line">model<span class="variable">.r0</span><span class="variable">.mirro</span>(status, [check], [path], <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<p>Update <strong>mirrored</strong> and <strong>desired</strong>
properties with DUT content</p>
<h5 id="set">set</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.set</span>(value);</span><br></pre></td></tr></table></figure>
<p>Set value in <strong>desired</strong> properties</p>
<h5 id="randomize">randomize</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.randomize</span>();</span><br><span class="line">model<span class="variable">.r0</span><span class="variable">.randomize</span>();</span><br></pre></td></tr></table></figure>
<p>Populate <strong>desired</strong> property with random value</p>
<h5 id="get">get</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = model<span class="variable">.r0</span><span class="variable">.get</span>();</span><br></pre></td></tr></table></figure>
<p>Get value from <strong>desired</strong> property</p>
<h5 id="update">update</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.update</span>(status, [path], <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br><span class="line">model<span class="variable">.r0</span><span class="variable">.update</span>(status, [path], <span class="variable">.parent</span>(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure>
<p>Update <strong>DUT</strong> and <strong>mirrored</strong> property
with <strong>desired</strong> property if <strong>mirrored</strong>
property is different from <strong>desired</strong></p>
<h5 id="predict">predict</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model<span class="variable">.r0</span><span class="variable">.predict</span>(value);</span><br></pre></td></tr></table></figure>
<p>Set the value of <strong>mirrored</strong> property</p>
<h5 id="get_mirrored_value">get_mirrored_value</h5>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = model<span class="variable">.r0</span><span class="variable">.get_mirrored_value</span>();</span><br></pre></td></tr></table></figure>
<p>Get value from <strong>mirrored</strong> property</p>
<h4 id="backdoor-access">Backdoor Access</h4>
<ul>
<li>Two ways to generate the backdoor access:
<ul>
<li>Via SystemVerilog Cross Module Reference (XMR)</li>
<li>Via SystemVerilog DPI call</li>
</ul></li>
<li>Both allow register model to be part of SystemVerilog package</li>
<li>XMR implementation is faster
<ul>
<li>Requires user to compile one additional file and at compile-time
provide top level path to DUT</li>
<li><strong>VCS only</strong></li>
</ul></li>
<li>DPI implementation is slower
<ul>
<li>No additional file is needed and top level path can be provided at
run-time</li>
<li>Portable to other simulators</li>
</ul></li>
</ul>
<h4 id="uvm-register-classes-uvm_reg_bus_op-uvm_reg_item">UVM Register
Classes: uvm_reg_bus_op &amp; uvm_reg_item</h4>
<p>The generic register item is implemented as a struct in order to
minimise the amount of memory resource it uses. The struct is defined as
type <code>uvm_reg_bus_op</code> and this contains 6 fields:</p>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 26%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="header">
<th>Property</th>
<th>Type</th>
<th>Comment/Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>addr</td>
<td>uvm_reg_addr_t</td>
<td>Address field, defaults to 64 bits</td>
</tr>
<tr class="even">
<td>data</td>
<td>uvm_reg_data_t</td>
<td>Read or write data, defaults to 64 bits</td>
</tr>
<tr class="odd">
<td>kind</td>
<td>uvm_access_e</td>
<td>UVM_READ or UVM_WRITE</td>
</tr>
<tr class="even">
<td>n_bits</td>
<td>unsigned int</td>
<td>Number of bits being transferred</td>
</tr>
<tr class="odd">
<td>byte_en</td>
<td>uvm_reg_byte_en_t</td>
<td>Byte enable</td>
</tr>
<tr class="even">
<td>status</td>
<td>uvm_status_e</td>
<td>UVM_IS_OK, UVM_IS_X, UVM_NOT_OK</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">  uvm_access_e kind;	<span class="comment">// Kind of access: READ or WRITE.</span></span><br><span class="line">  uvm_reg_addr_t addr;	<span class="comment">// The bus address.</span></span><br><span class="line">  uvm_reg_data_t data;	<span class="comment">// The data to write.</span></span><br><span class="line">  <span class="comment">// The number of bits of &lt;uvm_reg_item::value&gt; being transferred by this transaction.</span></span><br><span class="line">  <span class="keyword">int</span> n_bits;	</span><br><span class="line">  uvm_reg_byte_en_t byte_en;	<span class="comment">// Enables for the byte lanes on the bus.</span></span><br><span class="line">  uvm_status_e status;	<span class="comment">// The result of the transaction: UVM_IS_OK, UVM_HAS_X, UVM_NOT_OK.</span></span><br><span class="line">&#125; uvm_reg_bus_op;</span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> uvm_reg_item <span class="keyword">extends</span> uvm_sequence_item;</span><br><span class="line">    <span class="keyword">rand</span> uvm_access_e kind;</span><br><span class="line">    <span class="keyword">rand</span> uvm_reg_data_t value[];</span><br><span class="line">    <span class="keyword">rand</span> uvm_reg_addr_t offset;</span><br><span class="line">    uvm_status_e status;</span><br><span class="line">    uvm_reg_map map;</span><br><span class="line"><span class="keyword">endclass</span></span><br></pre></td></tr></table></figure>
<h4 id="registers">Registers</h4>
<p>The register class contains a <code>build</code> method which is used
to <strong>create</strong> and <strong>configure the
fields</strong>.</p>
<blockquote>
<p>this <code>build</code> method is not called by the UVM
<code>build_phase</code>, since the register is an
<code>uvm_object</code> rather than an <code>uvm_component</code></p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// uvm_reg constructor prototype:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">new</span> (<span class="keyword">string</span> name=<span class="string">&quot;&quot;</span>,      <span class="comment">// Register name</span></span><br><span class="line">              <span class="keyword">int</span> <span class="keyword">unsigned</span> n_bits, <span class="comment">// Register width in bits</span></span><br><span class="line">              <span class="keyword">int</span> has_coverage);   <span class="comment">// Coverage model supported by the register</span></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Function: new</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">new</span>(<span class="keyword">string</span> name = <span class="string">&quot;ctrl_reg&quot;</span>);</span><br><span class="line">    <span class="keyword">super</span><span class="variable">.new</span>(name, <span class="number">32</span>, build_coverage(UVM_CVR_FIELD_VALS));</span><br><span class="line">    add_coverage(build_coverage(UVM_CVR_FIELD_VALS));</span><br><span class="line">    <span class="keyword">if</span>(has_coverage(UVM_CVR_FIELD_VALS))</span><br><span class="line">        cg_vals = <span class="keyword">new</span>();</span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function: sample_values</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">virtual</span> <span class="keyword">function</span> <span class="keyword">void</span> sample_values();</span><br><span class="line">    <span class="keyword">super</span><span class="variable">.sample_values</span>();</span><br><span class="line">    <span class="keyword">if</span> (get_coverage(UVM_CVR_FIELD_VALS))</span><br><span class="line">        cg_vals<span class="variable">.sample</span>();</span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function: build</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">virtual</span> <span class="keyword">function</span> <span class="keyword">void</span> build();</span><br><span class="line">    ass = uvm_reg_field::type_id::create(<span class="string">&quot;ass&quot;</span>);</span><br><span class="line">    ie = uvm_reg_field::type_id::create(<span class="string">&quot;ie&quot;</span>);</span><br><span class="line">    lsb = uvm_reg_field::type_id::create(<span class="string">&quot;lsb&quot;</span>);</span><br><span class="line">    tx_neg = uvm_reg_field::type_id::create(<span class="string">&quot;tx_neg&quot;</span>);</span><br><span class="line">    rx_neg = uvm_reg_field::type_id::create(<span class="string">&quot;rx_neg&quot;</span>);</span><br><span class="line">    go_bsy = uvm_reg_field::type_id::create(<span class="string">&quot;go_bsy&quot;</span>);</span><br><span class="line">    reserved2 = uvm_reg_field::type_id::create(<span class="string">&quot;reserved2&quot;</span>);</span><br><span class="line">    char_len = uvm_reg_field::type_id::create(<span class="string">&quot;char_len&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ass<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    ie<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    lsb<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    tx_neg<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    rx_neg<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    go_bsy<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    reserved2<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">1&#x27;b0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    char_len<span class="variable">.configure</span>(<span class="keyword">this</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="string">&quot;RW&quot;</span>, <span class="number">0</span>, <span class="number">7&#x27;b0000000</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>As shown above, Register width is <strong>32</strong> same with the
bus width, <strong>lower 14 bit</strong> is configured.</p>
</blockquote>
<p><strong>RTL</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">define</span> SPI_CTRL_BIT_NB         14</span></span><br><span class="line"><span class="keyword">reg</span> [`SPI_CTRL_BIT_NB-<span class="number">1</span>:<span class="number">0</span>] ctrl;	<span class="comment">// Control and status register</span></span><br></pre></td></tr></table></figure>
<h4 id="register-maps">Register Maps</h4>
<p>Two purpose of the register map</p>
<ul>
<li>provide information on the offset of the registers, memories and/or
register blocks</li>
<li>identify bus agent based sequences to be executed ???</li>
</ul>
<blockquote>
<p>There can be several register maps within a block, each one can
specify a different <strong>address map</strong> and a different
<strong>target bus agent</strong></p>
<p>register map has to be created which the <strong>register
block</strong> using the <code>create_map</code> method</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Prototype for the create_map method</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">function</span> uvm_reg_map create_map(<span class="keyword">string</span> name,               <span class="comment">// Name of the map handle</span></span><br><span class="line">                                uvm_reg_addr_t base_addr,  <span class="comment">// The maps base address</span></span><br><span class="line">                                <span class="keyword">int</span> <span class="keyword">unsigned</span> n_bytes,      <span class="comment">// Map access width in bytes</span></span><br><span class="line">                                uvm_endianness_e endian,   <span class="comment">// The endianess of the map</span></span><br><span class="line">                                <span class="keyword">bit</span> byte_addressing=<span class="number">1</span>);    <span class="comment">// Whether byte_addressing is supported</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Example:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">AHB_map = create_map(<span class="string">&quot;AHB_map&quot;</span>, <span class="number">&#x27;h0</span>, <span class="number">4</span>, UVM_LITTLE_ENDIAN);</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>The <strong>n_bytes</strong> parameter is the word size (bus
width) of the bus to which the map is associated. If a register's width
exceeds the bus width, more than one bus access is needed to read and
write that register over that bus.</p></li>
<li><p>he <em>byte_addressing</em> argument affects how the address is
incremented in these consecutive accesses. For example, if
<em>n_bytes</em>=4 and <em>byte_addressing</em>=0, then an access to a
register that is 64-bits wide and at offset 0 will result in two bus
accesses at addresses 0 and 1. With <em>byte_addressing</em>=1, that
same access will result in two bus accesses at addresses 0 and 4.</p>
<p><strong>The default for <em>byte_addressing is</em>
1</strong></p></li>
<li><p>The <strong>first map</strong> to be created within a register
block is assigned to the <strong>default_map</strong> member of the
register block</p></li>
</ul>
</blockquote>
<p><img src="/2022/03/12/uvm-ral/byte_addressing.drawio.svg"
alt="byte_addressing.drawio" /></p>
<h4 id="register-adapter">Register Adapter</h4>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="header">
<th>uvm_reg_adapter</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Methods</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>reg2bus</td>
<td>Overload to convert generic register access items to target bus
agent sequence items</td>
</tr>
<tr class="odd">
<td>bus2reg</td>
<td>Overload to convert target bus sequence items to register model
items</td>
</tr>
<tr class="even">
<td><strong>Properties (Of type bit)</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="odd">
<td>supports_byte_enable</td>
<td>Set to 1 if the target bus and the target bus agent supports byte
enables, else set to 0</td>
</tr>
<tr class="even">
<td>provides_responses</td>
<td>Set to 1 if the target agent driver sends separate response
sequence_items that require response handling</td>
</tr>
</tbody>
</table>
<blockquote>
<p>The <strong>provides_responses</strong> bit should be set if the
agent driver returns a separate response item (i.e.
<code>put(response)</code>, or <code>item_done(response)</code>) from
its request item</p>
</blockquote>
<h4 id="prediction">Prediction</h4>
<p>the update, or prediction, of the register model content can occur
using one of three models</p>
<h5 id="auto-prediction">Auto Prediction</h5>
<p>This mode of operation is the simplest to implement, but suffers from
the drawback that it can only keep the register model up to date with
<strong>the transfers that it initiates</strong>. If any other sequences
directly access the target sequencer to update register content, or if
there are register accesses from other DUT interfaces, then the register
model will not be updated.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_map::set_auto_predict(<span class="keyword">bit</span> on=<span class="number">1</span>); m_auto_predict = on; <span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Gets the auto-predict mode setting for this map.</span></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">bit</span>  uvm_reg_map::get_auto_predict(); <span class="keyword">return</span> m_auto_predict; <span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>// Function: set_auto_predict</p>
<p>//</p>
<p>// Sets the auto-predict mode for his map.</p>
<p>//</p>
<p>// When <sub>on</sub> is <sub>TRUE</sub>,</p>
<p>// the register model will automatically update its
<strong>mirror</strong> (what it thinks should be in the DUT)</p>
<p>immediately after any bus read or write operation via this map.
<strong>Before</strong> a <code>uvm_reg::write</code></p>
<p>// or <code>uvm_reg::read</code> operation returns, the register's
<code>uvm_reg::predict</code> method is called to update</p>
<p>the <strong>mirrored</strong> value in the register.</p>
<p>//</p>
<p>// When <sub>on</sub> is <sub>FALSE</sub>, bus reads and writes via
this map do not</p>
<p>// automatically update the mirror. For real-time updates to the
mirror</p>
<p>// in this mode, you connect a <code>uvm_reg_predictor</code>
instance to the bus</p>
<p>// monitor. The predictor takes observed bus transactions from
the</p>
<p>// bus monitor, looks up the associated <code>uvm_reg</code> register
given</p>
<p>// the address, then calls that register's
<code>uvm_reg::predict</code> method.</p>
<p>// While more complex, this mode will capture all register
read/write</p>
<p>// activity, including that not directly descendant from calls to</p>
<p>// <code>uvm_reg::write</code> and <code>uvm_reg::read</code>.</p>
<p>//</p>
<p>// <strong>By default, auto-prediction is turned off</strong>.</p>
<p>//</p>
</blockquote>
<p><img
src="https://s3.amazonaws.com/cookbook.verification.academy/images/Reg_auto_predict.gif"
alt="Reg auto predict.gif" /></p>
<blockquote>
<p>The register model content is updated based on the register accesses
it initiates</p>
</blockquote>
<h5 id="explicit-prediction-recommended-approach">Explicit Prediction
(Recommended Approach)</h5>
<p>Explicit prediction is the <strong>default mode</strong> of
prediction</p>
<p><img
src="https://s3.amazonaws.com/cookbook.verification.academy/images/Reg_explicit_prediction.gif"
alt="Reg explicit prediction.gif" /></p>
<p>The register model content is updated via the <strong>predictor
component</strong> based on all observed bus transactions, ensuring that
register accesses made without the register model are mirrored
correctly. The predictor looks up the accessed register by address then
calls its <code>predict()</code> method</p>
<h6 id="uvm_regpredict-uvm_regdo_predict">uvm_reg::predict &amp;
uvm_reg::do_predict</h6>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// predict</span></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">bit</span> uvm_reg::predict (uvm_reg_data_t    value,</span><br><span class="line">                               uvm_reg_byte_en_t be = -<span class="number">1</span>,</span><br><span class="line">                               uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                               uvm_path_e        path = UVM_FRONTDOOR,</span><br><span class="line">                               uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                               <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                               <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line">  uvm_reg_item rw = <span class="keyword">new</span>; </span><br><span class="line">  rw<span class="variable">.value</span>[<span class="number">0</span>] = value;</span><br><span class="line">  rw<span class="variable">.path</span> = path;</span><br><span class="line">  rw<span class="variable">.map</span> = map; </span><br><span class="line">  rw<span class="variable">.fname</span> = fname;</span><br><span class="line">  rw<span class="variable">.lineno</span> = lineno;</span><br><span class="line">  do_predict(rw, kind, be); </span><br><span class="line">  predict = (rw<span class="variable">.status</span> == UVM_NOT_OK) ? <span class="number">0</span> : <span class="number">1</span>; </span><br><span class="line"><span class="keyword">endfunction</span>: predict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// do_predict</span></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg::do_predict(uvm_reg_item      rw,  </span><br><span class="line">                                  uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                                  uvm_reg_byte_en_t be = -<span class="number">1</span>); </span><br><span class="line"></span><br><span class="line">   uvm_reg_data_t reg_value = rw<span class="variable">.value</span>[<span class="number">0</span>];</span><br><span class="line">   m_fname = rw<span class="variable">.fname</span>;</span><br><span class="line">   m_lineno = rw<span class="variable">.lineno</span>;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">if</span> (rw<span class="variable">.status</span> ==UVM_IS_OK )</span><br><span class="line">   rw<span class="variable">.status</span> = UVM_IS_OK;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (m_is_busy &amp;&amp; kind == UVM_PREDICT_DIRECT) <span class="keyword">begin</span></span><br><span class="line">      `uvm_warning(<span class="string">&quot;RegModel&quot;</span>, &#123;<span class="string">&quot;Trying to predict value of register &#x27;&quot;</span>,</span><br><span class="line">                  get_full_name(),<span class="string">&quot;&#x27; while it is being accessed&quot;</span>&#125;)</span><br><span class="line">      rw<span class="variable">.status</span> = UVM_NOT_OK;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">end</span>  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">foreach</span> (m_fields[i]) <span class="keyword">begin</span></span><br><span class="line">      rw<span class="variable">.value</span>[<span class="number">0</span>] = (reg_value &gt;&gt; m_fields[i]<span class="variable">.get_lsb_pos</span>()) &amp;</span><br><span class="line">                                 ((<span class="number">1</span> &lt;&lt; m_fields[i]<span class="variable">.get_n_bits</span>())-<span class="number">1</span>);</span><br><span class="line">      m_fields[i]<span class="variable">.do_predict</span>(rw, kind, be&gt;&gt;(m_fields[i]<span class="variable">.get_lsb_pos</span>()/<span class="number">8</span>));</span><br><span class="line">   <span class="keyword">end</span>  </span><br><span class="line"></span><br><span class="line">   rw<span class="variable">.value</span>[<span class="number">0</span>] = reg_value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endfunction</span>: do_predict</span><br></pre></td></tr></table></figure>
<h6
id="uvm_reg_fieldpredict-uvm_reg_fielddo_predict">uvm_reg_field::predict
&amp; uvm_reg_field::do_predict</h6>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// predict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">bit</span> uvm_reg_field::predict (uvm_reg_data_t    value,</span><br><span class="line">                                     uvm_reg_byte_en_t be = -<span class="number">1</span>,</span><br><span class="line">                                     uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                                     uvm_path_e        path = UVM_FRONTDOOR,</span><br><span class="line">                                     uvm_reg_map       map = <span class="literal">null</span>,</span><br><span class="line">                                     <span class="keyword">string</span>            fname = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                                     <span class="keyword">int</span>               lineno = <span class="number">0</span>);</span><br><span class="line">  uvm_reg_item rw = <span class="keyword">new</span>;</span><br><span class="line">  rw<span class="variable">.value</span>[<span class="number">0</span>] = value;</span><br><span class="line">  rw<span class="variable">.path</span> = path;</span><br><span class="line">  rw<span class="variable">.map</span> = map;</span><br><span class="line">  rw<span class="variable">.fname</span> = fname;</span><br><span class="line">  rw<span class="variable">.lineno</span> = lineno;</span><br><span class="line">  do_predict(rw, kind, be);</span><br><span class="line">  predict = (rw<span class="variable">.status</span> == UVM_NOT_OK) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">endfunction</span>: predict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// do_predict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="keyword">void</span> uvm_reg_field::do_predict(uvm_reg_item      rw,</span><br><span class="line">                                        uvm_predict_e     kind = UVM_PREDICT_DIRECT,</span><br><span class="line">                                        uvm_reg_byte_en_t be = -<span class="number">1</span>);</span><br><span class="line">   </span><br><span class="line">   uvm_reg_data_t field_val = rw<span class="variable">.value</span>[<span class="number">0</span>] &amp; ((<span class="number">1</span> &lt;&lt; m_size)-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (rw<span class="variable">.status</span> != UVM_NOT_OK)</span><br><span class="line">     rw<span class="variable">.status</span> = UVM_IS_OK;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Assume that the entire field is enabled</span></span><br><span class="line">   <span class="keyword">if</span> (!be[<span class="number">0</span>])</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">   m_fname = rw<span class="variable">.fname</span>;</span><br><span class="line">   m_lineno = rw<span class="variable">.lineno</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> (kind)</span><br><span class="line"></span><br><span class="line">     UVM_PREDICT_WRITE:</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         uvm_reg_field_cb_iter cbs = <span class="keyword">new</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (rw<span class="variable">.path</span> == UVM_FRONTDOOR || rw<span class="variable">.path</span> == UVM_PREDICT)</span><br><span class="line">            field_val = XpredictX(m_mirrored, field_val, rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">         m_written = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span> (uvm_reg_cbs cb = cbs<span class="variable">.first</span>(); cb != <span class="literal">null</span>; cb = cbs<span class="variable">.next</span>())</span><br><span class="line">            cb<span class="variable">.post_predict</span>(<span class="keyword">this</span>, m_mirrored, field_val, </span><br><span class="line">                            UVM_PREDICT_WRITE, rw<span class="variable">.path</span>, rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">         field_val &amp;= (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">     UVM_PREDICT_READ:</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         uvm_reg_field_cb_iter cbs = <span class="keyword">new</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (rw<span class="variable">.path</span> == UVM_FRONTDOOR || rw<span class="variable">.path</span> == UVM_PREDICT) <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> acc = get_access(rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (acc == <span class="string">&quot;RC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;WRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;WSRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;W1SRC&quot;</span> ||</span><br><span class="line">                acc == <span class="string">&quot;W0SRC&quot;</span>)</span><br><span class="line">              field_val = <span class="number">0</span>;  <span class="comment">// (clear)</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (acc == <span class="string">&quot;RS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WCRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;W1CRS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;W0CRS&quot;</span>)</span><br><span class="line">              field_val = (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>; <span class="comment">// all 1&#x27;s (set)</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (acc == <span class="string">&quot;WO&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WOC&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WOS&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;WO1&quot;</span> ||</span><br><span class="line">                     acc == <span class="string">&quot;NOACCESS&quot;</span>)</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span> (uvm_reg_cbs cb = cbs<span class="variable">.first</span>(); cb != <span class="literal">null</span>; cb = cbs<span class="variable">.next</span>())</span><br><span class="line">            cb<span class="variable">.post_predict</span>(<span class="keyword">this</span>, m_mirrored, field_val,</span><br><span class="line">                            UVM_PREDICT_READ, rw<span class="variable">.path</span>, rw<span class="variable">.map</span>);</span><br><span class="line"></span><br><span class="line">         field_val &amp;= (<span class="number">&#x27;b1</span> &lt;&lt; m_size)-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">     UVM_PREDICT_DIRECT:</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span> (m_parent<span class="variable">.is_busy</span>()) <span class="keyword">begin</span></span><br><span class="line">           `uvm_warning(<span class="string">&quot;RegModel&quot;</span>, &#123;<span class="string">&quot;Trying to predict value of field &#x27;&quot;</span>,</span><br><span class="line">              get_name(),<span class="string">&quot;&#x27; while register &#x27;&quot;</span>,m_parent<span class="variable">.get_full_name</span>(),</span><br><span class="line">              <span class="string">&quot;&#x27; is being accessed&quot;</span>&#125;)</span><br><span class="line">           rw<span class="variable">.status</span> = UVM_NOT_OK;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// update the mirror with predicted value</span></span><br><span class="line">   m_mirrored = field_val;</span><br><span class="line">   m_desired  = field_val;</span><br><span class="line">   <span class="keyword">this</span><span class="variable">.value</span> = field_val;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endfunction</span>: do_predict</span><br></pre></td></tr></table></figure>
<h6 id="uvm_access_e">uvm_access_e</h6>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enum: uvm_access_e</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Type of operation begin performed</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// UVM_READ     - Read operation</span></span><br><span class="line"><span class="comment">// UVM_WRITE    - Write operation</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">   <span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">      UVM_READ,</span><br><span class="line">      UVM_WRITE,</span><br><span class="line">      UVM_BURST_READ,</span><br><span class="line">      UVM_BURST_WRITE</span><br><span class="line">   &#125; uvm_access_e;</span><br></pre></td></tr></table></figure>
<h6 id="uvm_predict_e">uvm_predict_e</h6>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enum: uvm_predict_e</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// How the mirror is to be updated</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// UVM_PREDICT_DIRECT  - Predicted value is as-is</span></span><br><span class="line"><span class="comment">// UVM_PREDICT_READ    - Predict based on the specified value having been read</span></span><br><span class="line"><span class="comment">// UVM_PREDICT_WRITE   - Predict based on the specified value having been written</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">   <span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">      UVM_PREDICT_DIRECT,</span><br><span class="line">      UVM_PREDICT_READ,</span><br><span class="line">      UVM_PREDICT_WRITE</span><br><span class="line">   &#125; uvm_predict_e;</span><br></pre></td></tr></table></figure>
<h6 id="uvm_path_e">uvm_path_e</h6>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enum: uvm_path_e</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Path used for register operation</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// UVM_FRONTDOOR    - Use the front door</span></span><br><span class="line"><span class="comment">// UVM_BACKDOOR     - Use the back door</span></span><br><span class="line"><span class="comment">// UVM_PREDICT      - Operation derived from observations by a bus monitor via</span></span><br><span class="line"><span class="comment">//                    the &lt;uvm_reg_predictor&gt; class.</span></span><br><span class="line"><span class="comment">// UVM_DEFAULT_PATH - Operation specified by the context</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">   <span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">      UVM_FRONTDOOR,</span><br><span class="line">      UVM_BACKDOOR,</span><br><span class="line">      UVM_PREDICT,</span><br><span class="line">      UVM_DEFAULT_PATH</span><br><span class="line">   &#125; uvm_path_e;</span><br></pre></td></tr></table></figure>
<h5 id="passive-prediction">Passive Prediction</h5>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/09/spf-complex-pwl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/09/spf-complex-pwl/" class="post-title-link" itemprop="url">Single-Pole Filter and Complex Conjugate Pole pair in Event-Driven PWL model</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-09 23:40:23" itemprop="dateCreated datePublished" datetime="2022-03-09T23:40:23+00:00">2022-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/analog/" itemprop="url" rel="index"><span itemprop="name">analog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>Real number modeling</strong> of analog circuits in hardware
description languages (HDLs) has become more common as a part of
mixed-signal SoC validation. <strong>Piecewise linear (PWL)</strong>
waveform approximation represent analog signals and <strong>dynamically
schedule the events</strong> for approximating the signal waveform to
PWL segments with a well controlled error bound.</p>
<p><img src="/2022/03/09/spf-complex-pwl/image-20220310000010013.png"
alt="image-20220310000010013" /></p>
<p>Definition of a piecewise liner (PWL) waveform using struct in
Systemverilog</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">real</span> y; <span class="comment">// signal offset</span></span><br><span class="line">    <span class="keyword">real</span> slope; <span class="comment">// signal slope</span></span><br><span class="line">    <span class="keyword">real</span> t0;	<span class="comment">// time offset</span></span><br><span class="line">&#125; pwl; <span class="comment">// pwl datatype</span></span><br></pre></td></tr></table></figure>
<h4 id="when-to-update-piecewise-model">When to update piecewise
model</h4>
<ol type="1">
<li>model parameter update once new input come in</li>
<li>error is greater than user-define tolerance <span
class="math inline">\(e_{tol}\)</span>, trigger by <span
class="math inline">\(\Delta T\)</span></li>
</ol>
<p><img src="/2022/03/09/spf-complex-pwl/tolerance_error.drawio.svg"
alt="tolerance_error.drawio" /></p>
<h4 id="dynamic-time-step-control">Dynamic Time Step Control</h4>
<p>When approximating a function <span
class="math inline">\(y(t)\)</span> to a <strong>piecewise linear
segment</strong> for the interval <span class="math inline">\(t_0 \le
t_0 + \Delta t\)</span>, the approximation error <span
class="math inline">\(err\)</span> is bounded by <span
class="math display">\[
\left| err \right| \le \frac{1}{8}\cdot \Delta t^2 \cdot \max(\left|
\ddot{y(t)} \right|)
\]</span> Using Rolle's theorem for the interval <span
class="math inline">\(t_0 \le t_0 + \Delta t\)</span>, the needed time
step <span class="math inline">\(\Delta t\)</span> is givend by <span
class="math display">\[
\Delta t(t=t_0) = \sqrt{\frac{8\cdot e_{tol}}{\max(\left| \ddot{y(t)}
\right|)}}
\]</span></p>
<h4 id="single-pole-filter-model">Single-Pole Filter Model</h4>
<p>The <strong>ramp</strong> input <span
class="math inline">\(X(s)\)</span>, the single pole system Laplace
s-domain <span class="math inline">\(H(s)\)</span> and the output
response <span class="math inline">\(Y(s)\)</span>, <span
class="math display">\[\begin{align}
X(s) &amp;= \frac{a}{s} +\frac{b}{s^2} \\
H(s) &amp;= \frac{Y(s)}{X(s)} = \frac{1}{1+\frac{s}{\omega_{1}}} \\
Y(s) &amp;= X(s) \cdot H(s)
\end{align}\]</span></p>
<p>Time domain of ramp input shown as below <span
class="math display">\[
x(t) = a +b \cdot t
\]</span></p>
<ol type="1">
<li>The output transfer function <span
class="math display">\[\begin{align}
Y(s) &amp;= X(s) \cdot H(s) \\
&amp;= \frac{\omega_1}{\omega_1+s}\cdot X
\end{align}\]</span> <span class="math display">\[
Y\omega_1 + sY = \omega_1 X
\]</span></li>
<li>its differential equation <span class="math display">\[
y(t) \cdot \omega_1+\frac{d y(t)}{dt} = \omega_1 \cdot x(t)
\]</span></li>
<li>Laplace transfrom two side of the above equation, <span
class="math inline">\(y_0\)</span> is initial conditon of output, <span
class="math inline">\(x_0=0\)</span> <span class="math display">\[
Y\omega_1 + sY-y_0 = \omega_1 \cdot X
\]</span> Solving <span class="math inline">\(Y(s)\)</span> <span
class="math display">\[\begin{align}
Y &amp;= \frac{y_0}{\omega_1+s}+\frac{\omega_1}{\omega_1+s}\cdot X \\
&amp;= \frac{y_0}{\omega_1+s}+\frac{\omega_1}{\omega_1+s}\cdot
(\frac{a}{s}+\frac{b}{s^2}) \\
&amp;= \frac{y_0}{\omega_1+s}+\frac{\omega_1}{\omega_1+s}\cdot
\frac{a}{s}+\frac{\omega_1}{\omega_1+s}\cdot\frac{b}{s^2}
\end{align}\]</span></li>
<li>inverse Laplace transform <span class="math display">\[
y(t) = y_0e^{-\omega_1t}+(a-a\cdot e^{-\omega_1t})+(b\cdot
t-\frac{b}{\omega_1}+\frac{b}{\omega_1}\cdot e^{-\omega_1 t})
\]</span></li>
</ol>
<blockquote>
<p>step-1 transfer function in Laplace s-domain, which
<strong>don't</strong> initial conditon and is only steady response.</p>
<p>step-2 differential equation</p>
<p>step-3 Laplace transform of <span
class="math inline">\(Y(s)\)</span>, (the initial conditon of input
<span class="math inline">\(X(s)\)</span> is zero, that of <span
class="math inline">\(Y(s)\)</span> is explicit)</p>
<p>step-4 inverse Laplace transform, with the help of Laplace transform
table or matlab <code>syms</code> and <code>ilaplace</code> function</p>
</blockquote>
<p><span class="math inline">\(y(t)\)</span> has a continuous second
derivative <span class="math inline">\(\ddot{y(t)}\)</span> <span
class="math display">\[
\ddot{y(t)} =(-a+\frac{b}{\omega_1}+y_0)\cdot \omega_1^2\cdot
e^{-\omega_1t}
\]</span> It's obvious <span class="math inline">\(\left| \ddot{y(t)}
\right|\)</span> is a decaying function and thus the maximum value is
<span class="math inline">\(\left| \ddot{y(t_0)} \right|\)</span> for
the interval <span class="math inline">\(t_0 \le t_0 + \Delta
t\)</span>. The time step <span class="math inline">\(\Delta t\)</span>
for the error tolerance <span class="math inline">\(e_{tol}\)</span>:
<span class="math display">\[
\Delta t(t=t_0) = \sqrt{\frac{8\cdot e_{tol}}{\left| \ddot{y(t_0)}
\right|}}
\]</span></p>
<h4 id="complex-conjugate-pole-pair">Complex Conjugate Pole pair</h4>
<p><span class="math display">\[
H(s) = \frac{r}{s+\omega_p} + \frac{r^*}{s+\omega_p^*}
\]</span></p>
<p>where <span class="math inline">\(\omega_p\)</span> and <span
class="math inline">\(r\)</span> are complex numbers, <span
class="math inline">\(r=r_r+jr_i\)</span>, <span
class="math inline">\(\omega_p=\omega_{pr}+j\omega_{pi}\)</span></p>
<p>Follow the procedure as above single pole <span
class="math display">\[
\frac{Y(s)}{X(s)} = \frac{s\cdot r_{cs}+e}{s^2+s\cdot \omega_{p\_cs}+f}
\]</span> where <span class="math inline">\(r_{cs}=r+r^*\)</span>, <span
class="math inline">\(\omega_{p\_cs}=\omega_p+\omega_p^*\)</span> and
<span class="math inline">\(e=r\omega_p^*+r^*\omega_p\)</span>, <span
class="math inline">\(f=\omega_p\omega_p^*\)</span> implies <span
class="math display">\[
s^2Y(s)+s\omega_{p\_cs}Y(s)+fY(s)=(s\cdot r_{cs}+e)X(s)
\]</span> or a differential equation <span class="math display">\[
\frac{d^2y(t)}{dt^2}+\omega_{p\_cs}\frac{dy(t)}{dt}+fy(t)=r_{cs}\frac{dx(t)}{dt}+e\cdot
x(t)
\]</span> Taking Laplace transform with initial conditions <span
class="math inline">\(y_0\)</span>, <span
class="math inline">\(\dot{y_0}\)</span> and <span
class="math inline">\(x_0=0\)</span>, <span class="math display">\[
s^2-sy_0-\dot{y_0}+\omega_{p\_cs}(sY(s)-y_0)+f\cdot y(t) = r_{cs}\cdot
(sX(s)-0)+e\cdot X(s)
\]</span> Solving for <span class="math inline">\(Y(s)\)</span> <span
class="math display">\[
Y(s)=\frac{s\cdot
y_0+\dot{y_0}+\omega_{p\_cs}y_0}{s^2+s\cdot{\omega_{p\_cs}}+f}+\frac{s\cdot{r_{cs}}+e}{s^2+s\cdot{\omega_{p\_cs}}+f}X(s)
\]</span> With an ramp input, height <span
class="math inline">\(a\)</span>, slope <span
class="math inline">\(b\)</span>, i.e. <span
class="math inline">\(X(s)=\frac{a}{s}+\frac{b}{s^2}\)</span> <span
class="math display">\[
Y(s)=\frac{s\cdot
y_0+\dot{y_0}+\omega_{p\_cs}y_0}{s^2+s\cdot{\omega_{p\_cs}}+f}+\frac{s\cdot{r_{cs}}+e}{s^2+s\cdot{\omega_{p\_cs}}+f}(\frac{a}{s}+\frac{b}{s^2})
\]</span> After inverse Laplace transform, we can get total response
<span class="math display">\[
y(t)=e^{-\omega_{pr}t}\cdot \left[ y_0\cdot
\cos(\omega_{pi}t)+\frac{\dot{y_0}+y_0\omega_{pr}}{\omega_{pi}}\sin(\omega_{pi}t)+D\cdot
\cos(\omega_{pi}t)+\frac{C-D\cdot{\omega_{pr}}}{\omega_{pi}}\sin(\omega_{pi}t)
\right]+B+A\cdot{t}
\]</span> where <span class="math display">\[\begin{align}
A &amp;= \frac{e\cdot{b}}{f} \\
B &amp;= \frac{r_{cs}\cdot{b}+a\cdot{e}-A\cdot{\omega_{p\_{cs}}}}{f} \\
C &amp;= a\cdot{r_{cs}}-A-B\cdot{\omega_{p\_cs}} \\
D &amp;= -B
\end{align}\]</span></p>
<p>As a double check, note that at <span
class="math inline">\(t=0\)</span>, <span class="math display">\[
y(0)=\left[ y_0 + D \right]+B=y_0
\]</span></p>
<p>To derive derivative, we first assume <span class="math display">\[
y_0\cdot
\cos(\omega_{pi}t)+\frac{\dot{y_0}+y_0\omega_{pr}}{\omega_{pi}}\sin(\omega_{pi}t)+D\cdot
\cos(\omega_{pi}t)+\frac{C-D\cdot{\omega_{pr}}}{\omega_{pi}}\sin(\omega_{pi}t)
= \alpha \cdot{\cos(\omega_{pi}t+\phi)}
\]</span> The above equation implies <span
class="math display">\[\begin{align}
y_0+D &amp;= \alpha\cdot{\cos(\phi)} \\
\frac{\dot{y_0}+y_0\omega_{pr}}{\omega_{pi}}+\frac{C-D\cdot{\omega_{pr}}}{\omega_{pi}}
&amp;= -\alpha\cdot{\sin(\phi)}
\end{align}\]</span> Then <span class="math display">\[
\alpha^2=(y_0+D)^2+\left(\frac{\dot{y_0}+y_0\omega_{pr}}{\omega_{pi}}+\frac{C-D\cdot{\omega_{pr}}}{\omega_{pi}}
\right)^2
\]</span> And <span class="math inline">\(\alpha\)</span> can be used to
estimate time step size. The total response is <span
class="math display">\[
y(t)=e^{-\omega_{pr}t}\cdot \alpha
\cdot{\cos(\omega_{pi}t+\phi)}+B+A\cdot{t}
\]</span> It's second derivative is <span class="math display">\[
\ddot{y(t)} = \alpha\left[
(\omega_{pr}^2-\omega_{pi}^2)e^{-\omega_{pr}t}\cos(\omega_{pi}t+\phi)+2\cdot
\omega_{pr}\omega_{pi}e^{-\omega_{pr}t}\sin(\omega_{pi}t+\phi) \right]
\]</span> Absolute value <span class="math display">\[
\left| \ddot{y(t)} \right| = \left| \alpha \right| \left|
(\omega_{pr}^2-\omega_{pi}^2)e^{-\omega_{pr}t}\cos(\omega_{pi}t+\phi)+2\cdot
\omega_{pr}\omega_{pi}e^{-\omega_{pr}t}\sin(\omega_{pi}t+\phi) \right|
\]</span> Define new function <span
class="math inline">\(g_0(t)\)</span> <span class="math display">\[
g_0(t) = \left| \alpha \right| \left|
(\omega_{pr}^2-\omega_{pi}^2)e^{-\omega_{pr}t}\cos(\omega_{pi}t+\phi)
\right|+2\cdot |\alpha| \left|
\omega_{pr}\omega_{pi}e^{-\omega_{pr}t}\sin(\omega_{pi}t+\phi) \right|
\]</span> another new funtion <span
class="math inline">\(g_1(t)\)</span>, by equating <span
class="math inline">\(\sin(\omega_{pi}t+\phi)\)</span> and <span
class="math inline">\(\cos(\omega_{pi}t+\phi)\)</span> to one <span
class="math display">\[
g_1(t) = \left| \alpha \right| \left|
(\omega_{pr}^2-\omega_{pi}^2)e^{-\omega_{pr}t} \right|+2\cdot |\alpha|
\left| \omega_{pr}\omega_{pi}e^{-\omega_{pr}t} \right|
\]</span></p>
<p>By triangular inequality, <span class="math inline">\(g_0(t)\)</span>
is the upper bound of <span class="math inline">\(\left| \ddot{y(t)}
\right|\)</span>, and <span class="math inline">\(g_1(t)\)</span> is the
upper bound of <span class="math inline">\(g_0(t)\)</span></p>
<p>Because <span class="math inline">\(g_1(t)\)</span> is a decaying
exponential function, Therefore, a conservative time step can be
obtained, for inteval <span class="math inline">\(t_0 \le t_0 + \Delta
t\)</span>, <span class="math display">\[
\Delta t(t=t_0) = \sqrt{\frac{8\cdot e_{tol}}{\left| g_1(t_0) \right|}}
\]</span></p>
<h4 id="one-fixed-time-step-systemverilog-model-example">One Fixed-time
step SystemVerilog model example</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">timeunit</span> <span class="number">1</span>ns;</span><br><span class="line"><span class="keyword">timeprecision</span> <span class="number">1</span>fs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span> #<span class="number">0</span><span class="variable">.1</span> <span class="keyword">forever</span> <span class="keyword">begin</span></span><br><span class="line">    Ir4 = (Vm - Vout) / R4;</span><br><span class="line">    Ir3 = (Vcp - Vm) / R3;</span><br><span class="line">    Ir2 = (Vcp - Vz) / R2;</span><br><span class="line"></span><br><span class="line">    Vout = Vout + Ir4 * <span class="number">0</span><span class="variable">.1</span> * (<span class="number">1</span>e-<span class="number">9</span>) / C4;</span><br><span class="line">    Vm = Vm + (Ir3 - Ir4) * <span class="number">0</span><span class="variable">.1</span> * (<span class="number">1</span>e-<span class="number">9</span>) / C3;</span><br><span class="line">    Vz = Vz + Ir2 * <span class="number">0</span><span class="variable">.1</span> * (<span class="number">1</span>e-<span class="number">9</span>) / C2;</span><br><span class="line">    Vcp = Vcp + (Icp - Ir2 - Ir3) * <span class="number">0</span><span class="variable">.1</span> * (<span class="number">1</span>e-<span class="number">9</span>) / C1;</span><br><span class="line">    last_time = <span class="built_in">$realtime</span>;</span><br><span class="line">    #<span class="number">0</span><span class="variable">.1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h4 id="acknowledgement">Acknowledgement</h4>
<p>My colleague, Zhang Wenpian help me a lot in understanding this
modeling method. Lots of content here are copied from Zhang's note.</p>
<h4 id="reference">Reference</h4>
<p>B. C. Lim and M. Horowitz, "Error Control and Limit Cycle Elimination
in Event-Driven Piecewise Linear Analog Functional Models," in IEEE
Transactions on Circuits and Systems I: Regular Papers, vol. 63, no. 1,
pp. 23-33, Jan. 2016, doi: 10.1109/TCSI.2015.2512699.</p>
<p>S. Liao and M. Horowitz, "A Verilog piecewise-linear analog behavior
model for mixed-signal validation," Proceedings of the IEEE 2013 Custom
Integrated Circuits Conference, 2013, pp. 1-5, doi:
10.1109/CICC.2013.6658461.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/StanfordVLSI/DaVE">StanfordVLSI/DaVE -
tools regarding on analog modeling,validation, and generation</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/08/sst-drv/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/08/sst-drv/" class="post-title-link" itemprop="url">SST Driver</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-08 19:24:11" itemprop="dateCreated datePublished" datetime="2022-03-08T19:24:11+00:00">2022-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/analog/" itemprop="url" rel="index"><span itemprop="name">analog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="sharing-termination-in-sst-transmitter">sharing termination in
SST transmitter</h2>
<p><img src="/2022/03/08/sst-drv/tx_leg.drawio.svg"
alt="tx_leg.drawio" /></p>
<p>Sharing termination keep a constant current through leg, which
improve TX speed in this way. On the other hand, the sharing termination
facilitate drain/source sharing technique in layout.</p>
<h2 id="pull-up-and-pull-down-resistor">pull-up and pull-down
resistor</h2>
<p><img src="/2022/03/08/sst-drv/sst-evolution.png"
alt="sst-evolution" /></p>
<p><strong>Original stacked structure</strong></p>
<p>Pro's:</p>
<p>smaller static current when both pull up and pull down path is on</p>
<p>Con's:</p>
<p>slowly switching due to parasitic capacitance behind pull-up and
pull-down resistor</p>
<p><strong>with single shared linearization resistor</strong></p>
<p>Pro's:</p>
<p>The parasitic capacitance behind the resistor still exists but is now
always driven high or low actively</p>
<p>Con's:</p>
<p>more static current</p>
<h2 id="reference">reference</h2>
<p>Bulzacchelli, J.F. &amp; Menolfi, Christian &amp; Beukema, T.J. &amp;
Storaska, D.W. &amp; Hertle, Jürgen &amp; Hanson, D.R. &amp; Hsieh,
Ping-Hsuan &amp; Rylov, Sergey &amp; Furrer, Daniel &amp; Gardellini,
Daniele &amp; Prati, Andrea &amp; Morf, Thomas &amp; Sharma, Vivek &amp;
Kelkar, Ram &amp; Ainspan, H. &amp; Kelly, W.R. &amp; Chieco, L.R. &amp;
Ritter, G.A. &amp; Sorice, J.A. &amp; Friedman, D.J.. (2012). A 28-Gb/s
4-Tap FFE/15-Tap DFE Serial Link Transceiver in 32-nm SOI CMOS
Technology. Solid-State Circuits, IEEE Journal of. 47. 3232-3248.
10.1109/JSSC.2012.2216414.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/07/parallel-compensation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/07/parallel-compensation/" class="post-title-link" itemprop="url">Parallel Compensation in Two stage amplifier</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-07 23:48:11" itemprop="dateCreated datePublished" datetime="2022-03-07T23:48:11+00:00">2022-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/analog/" itemprop="url" rel="index"><span itemprop="name">analog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><strong>Parallel Compensation</strong> is also known as <strong>Lead
Compensation</strong>, <strong>Pole-Zero Compensation</strong></p>
</blockquote>
<p><img
src="/2022/03/07/parallel-compensation/image-20220307234938855.png"
alt="image-20220307234938855" /></p>
<p><strong>Note</strong>: The dominant pole is at output of the first
stage, i.e. <span
class="math inline">\(\frac{1}{R_{EQ}C_{EQ}}\)</span>.</p>
<p><img
src="/2022/03/07/parallel-compensation/image-20221006001114562.png"
alt="image-20221006001114562" /></p>
<h4 id="pole-and-zero-in-transfer-function">Pole and Zero in transfer
function</h4>
<blockquote>
<p>Design with operational amplifiers and analog integrated circuits /
Sergio Franco, San Francisco State University. – Fourth edition</p>
</blockquote>
<p><img
src="/2022/03/07/parallel-compensation/image-20221005220854411.png"
alt="image-20221005220854411" /></p>
<p><span class="math display">\[
Y = \frac{1}{R_1} + sC_1+\frac{1}{R_c+1/SC_c}
\]</span></p>
<p><span class="math display">\[\begin{align}
Z &amp;= \frac{1}{\frac{1}{R_1} + sC_1+\frac{1}{R_c+1/SC_c}} \\
&amp;= \frac{R_1(1+sR_cC_c)}{s^2R_1C_1R_cC_c+S(R_1C_c+R_1C_1+R_cC_c)+1}
\end{align}\]</span> If <span class="math inline">\(p_{1c} \ll
p_{3c}\)</span>, two real roots can be found <span
class="math display">\[\begin{align}
p_{1c} &amp;= \frac{1}{R_1C_c+R_1C_1+R_cC_c} \\
p_{3c} &amp;= \frac{R_1C_c+R_1C_1+R_cC_c}{R_1C_1R_cC_c}
\end{align}\]</span></p>
<p>The additional zero is <span class="math display">\[
z_c = \frac{1}{R_cC_c}
\]</span> Given <span class="math inline">\(R_c \ll R\)</span> and <span
class="math inline">\(C_c \gg C\)</span> <span
class="math display">\[\begin{align}
p_{1c} &amp;\simeq \frac{1}{R_1(C_c+C_1)} \simeq \frac{1}{R_1C_c}\\
p_{3c} &amp;= \frac{1}{R_cC_1}+\frac{1}{R_cC_c}+\frac{1}{R_1C_1} \simeq
\frac{1}{R_cC_1}
\end{align}\]</span></p>
<p>The output pole is unchanged, which is <span class="math display">\[
p_2 = \frac{1}{R_LC_L}
\]</span> We usually <strong>cancel</strong> <span
class="math inline">\(p_2\)</span> with <span
class="math inline">\(z_c\)</span>, i.e. <span class="math display">\[
R_cC_c=R_LC_L
\]</span></p>
<h4 id="phase-margin">Phase margin</h4>
<p>unity-gain frequency <span class="math inline">\(\omega_t\)</span>
<span class="math display">\[
\omega_t = \frac{g_{m1}g_{m2}R_L}{C_c}
\]</span></p>
<ol type="1">
<li><p>PM=45<span class="math inline">\(^o\)</span> <span
class="math display">\[
p_{3c} = \omega_t
\]</span> Then, <span class="math inline">\(C_c\)</span> and <span
class="math inline">\(R_c\)</span> can be obtained</p>
<p><span class="math display">\[\begin{align}
   R_c &amp;= \sqrt{\frac{R_1}{C_1\cdot A_{DC}\cdot
p_2}}=\sqrt{\frac{R_1\cdot R_LC_L}{C_1\cdot A_{DC}}} \\
C_c &amp;= \sqrt{\frac{A_{DC}\cdot C_1}{R_1\cdot
p_2}}=\sqrt{\frac{A_{DC}\cdot C_1 \cdot R_LC_L}{R_1}}
\end{align}\]</span></p></li>
<li><p>PM=60<span class="math inline">\(^o\)</span> <span
class="math display">\[
p_{3c} = 2\cdot\omega_t
\]</span> Then, <span class="math inline">\(C_c\)</span> and <span
class="math inline">\(R_c\)</span> can be obtained <span
class="math display">\[\begin{align}
   R_c &amp;= \sqrt{\frac{R_1}{C_1\cdot 2A_{DC}\cdot p_2}} =
\sqrt{\frac{R_1\cdot R_LC_L}{C_1\cdot 2A_{DC}}} \\
   &amp;= \sqrt{\frac{C_L}{2g_{m1}g_{m2}C_1}}\\
C_c &amp;= \sqrt{\frac{2A_{DC}\cdot C_1}{R_1\cdot p_2}} =
\sqrt{\frac{2A_{DC}\cdot C_1 \cdot R_LC_L}{R_1}} \\
&amp;= R_L\sqrt{2g_{m1}g_{m2}C_1C_L}
\end{align}\]</span></p>
<p>for the unity-gain frequency <span
class="math inline">\(\omega_t\)</span> we find <span
class="math display">\[
\omega_t = \sqrt{\frac{1}{2}\cdot \frac{g_{m1}g_{m2}}{C_1C_L}}
\]</span> The parallel compensation shows a remarkably good result. The
new 0 dB frequency lies only a factor <span
class="math inline">\(\sqrt{2}\)</span> lower than the theoretical
maximum</p></li>
</ol>
<blockquote>
<p>To increase <span class="math inline">\(\phi_m\)</span>, we need to
<strong>raise</strong> <span class="math inline">\(C_c\)</span> a bit
while <strong>lowering</strong> <span class="math inline">\(R_c\)</span>
in proportion in order to maintain pole-zero cancellation. This causes
<span class="math inline">\(p_{1c}\)</span> and <span
class="math inline">\(p_{3c}\)</span> to split a bit further apart.</p>
</blockquote>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">clc;</span><br><span class="line">clear;</span><br><span class="line"></span><br><span class="line">fd = <span class="number">84</span>*<span class="number">1e3</span>;	<span class="comment">% dominant freq, unit: Hz</span></span><br><span class="line">fnd = <span class="number">3.25</span>*<span class="number">1e6</span>;	<span class="comment">% unit: Hz</span></span><br><span class="line">C = <span class="number">478</span>*<span class="number">1e-15</span>;</span><br><span class="line">R = <span class="number">1</span>/fd/(<span class="number">2</span>*<span class="built_in">pi</span>)/C;</span><br><span class="line">Adc = <span class="number">10</span>^(<span class="number">80</span>/<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">ri = <span class="number">2</span>; <span class="comment">% PM=45: 1;  PM=60: 2</span></span><br><span class="line">Rc = (R/C/fnd/<span class="number">2</span>/<span class="built_in">pi</span>/ri/Adc)^<span class="number">0.5</span>; <span class="comment">% compensation resistor</span></span><br><span class="line">Cc = (ri*Adc*C/fnd/<span class="number">2</span>/<span class="built_in">pi</span>/R)^<span class="number">0.5</span>; <span class="comment">% compensation capacitor</span></span><br><span class="line"></span><br><span class="line">wzc = <span class="number">1</span>/<span class="number">2</span>/<span class="built_in">pi</span>/Rc/Cc; <span class="comment">% zero frequency</span></span><br></pre></td></tr></table></figure>
<h4 id="reference">reference</h4>
<p>Viola Schäffer, Designing Amplifiers for Stability, ISSCC 2021
Tutorials</p>
<p>R.Eschauzier "Wide Bandwidth Low Power Operational Amplifiers", Delft
University Press, 1994.</p>
<p>Gene F. Franklin, J. David Powell, and Abbas Emami-Naeini. 2018.
Feedback Control of Dynamic Systems (8th Edition) (8th. ed.). Pearson.
6.7 Compensation</p>
<p>Application Note AN-1286 Compensation for the LM3478 Boost
Controller</p>
<p>ECEN 607 Advanced Analog Circuit Design Techniques Spring 2017 URL:
<a
target="_blank" rel="noopener" href="https://people.engr.tamu.edu/s-sanchez/Lec_for_607_stability%20Jan27.pdf">Lect
1D Op-Amps Stability and Frequency Compensation Techniques</a></p>
<p>Sergio Franco, San Francisco State University, Design with
Operational Amplifiers and Analog Integrated Circuits, 4/e</p>
<p>J. H. Huijsing, 6.2.2.1 Two-GA-stage Parallel Compensation (PC),
"Operational Amplifiers, Theory and Design, 3rd ed. New York: Springer,
2017"</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/06/EDI-post-mask-ECO-sparecell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/06/EDI-post-mask-ECO-sparecell/" class="post-title-link" itemprop="url">How does EDI System identify spare cells in a post-mask ECO flow?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-06 22:56:40" itemprop="dateCreated datePublished" datetime="2022-03-06T22:56:40+00:00">2022-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/innovus/" itemprop="url" rel="index"><span itemprop="name">innovus</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4
id="how-does-edi-system-identify-spare-cells-in-a-post-mask-eco-flow">How
does EDI System identify spare cells in a post-mask ECO flow?</h4>
<p>Spare cells should have a unique string in their instance name to
identify them. Then the command <code>specifySpareGate</code> or
<code>ecoDesign -useSpareCells patternName</code> is run to identify the
spare instances. For example, if all spare cells have _spare_ in their
name then they are identified using:</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">specifySpareGate -inst *_spare_*</span><br></pre></td></tr></table></figure>
<p>OR</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ecoDesign -spareCells *_spare_* ...</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>: if you are making <strong>manual ECO</strong>
changes to a netlist and converting a spare cell to a logical instance,
<strong>it's important to change the instance name</strong>. Otherwise,
the instance may be identified as a spare cell if a future ECO is
performed because it still has the spare cell instance name.</p>
<h4 id="example">Example</h4>
<h5 id="the-cell-to-be-swapped-is-unplaced">The cell to be swapped is
unplaced</h5>
<p><img
src="/2022/03/06/EDI-post-mask-ECO-sparecell/image-20220307002842020.png"
alt="image-20220307002842020" /></p>
<p>pre_buf: <strong>unplaced</strong></p>
<p>spare_buf: <strong>placed</strong></p>
<blockquote>
<p>innovus 49&gt; dbGet top.insts.name</p>
<p><strong>spare_buf</strong> <strong>pre_buf</strong> UDriver USink</p>
<p>innovus 50&gt; dbGet top.insts.</p>
<p><strong>0x7f7b03ef60e0</strong> <strong>0x7f7b03ef6150</strong>
0x7f7b03ef6000 0x7f7b03ef6070</p>
</blockquote>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">specifySpareGate -inst spare_*</span><br><span class="line">ecoSwapSpareCell pre_buf spare_buf</span><br></pre></td></tr></table></figure>
<p><img
src="/2022/03/06/EDI-post-mask-ECO-sparecell/image-20220307003059068.png"
alt="image-20220307003059068" /></p>
<blockquote>
<p>innovus 55&gt; dbGet top.insts.name</p>
<p><strong>pre_buf</strong> UDriver USink</p>
<p>innovus 56&gt; dbGet top.insts.</p>
<p><strong>0x7f7b03ef6150</strong> 0x7f7b03ef6000 0x7f7b03ef6070</p>
<p>innovus 57&gt; dbGet top.insts.Pstatus</p>
<p><strong>placed</strong> fixed fixed</p>
</blockquote>
<p><strong>Note</strong>: sparecell's pointer and name is swapped with
the unplaced cell.</p>
<h5 id="the-cell-to-be-swapped-is-placed">The cell to be swapped is
placed</h5>
<p><img
src="/2022/03/06/EDI-post-mask-ECO-sparecell/image-20220307004654614.png"
alt="image-20220307004654614" /></p>
<blockquote>
<p>innovus 62&gt; dbGet top.insts.name</p>
<p><strong>spare_buf</strong> <strong>pre_buf</strong> UDriver USink</p>
<p>innovus 63&gt; dbGet top.insts.</p>
<p><strong>0x7f7b03ef60e0</strong> <strong>0x7f7b03ef6150</strong>
0x7f7b03ef6000 0x7f7b03ef6070</p>
<p>innovus 64&gt; dbGet top.insts.pStatus</p>
<p><strong>placed</strong> <strong>placed</strong> fixed fixed</p>
</blockquote>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">innovus <span class="number">66</span>&gt; specifySpareGate -inst spare_*</span><br><span class="line">Specifying instance [spare_buf] as spare gate.</span><br><span class="line">Specified <span class="number">1</span> instances as spare gate.</span><br><span class="line">innovus <span class="number">67</span>&gt; ecoSwapSpareCell pre_buf spare_buf</span><br></pre></td></tr></table></figure>
<p><img
src="/2022/03/06/EDI-post-mask-ECO-sparecell/image-20220307005254488.png"
alt="image-20220307005254488" /></p>
<blockquote>
<p>innovus 68&gt; dbGet top.insts.name</p>
<p><strong>spare_buf pre_buf</strong> UDriver USink</p>
<p>innovus 69&gt; dbGet top.insts.</p>
<p><strong>0x7f7b03ef60e0 0x7f7b03ef6150</strong> 0x7f7b03ef6000
0x7f7b03ef6070</p>
<p>innovus 70&gt; dbGet top.insts.pStatus</p>
<p>placed placed fixed fixed</p>
</blockquote>
<p><strong>Note</strong>: sparecell's pointer and name is swapped with
the placed cell.</p>
<h5 id="error-in-innovus-text-command-reference-21.12">Error in "Innovus
Text Command Reference 21.12"</h5>
<p><strong>ecoSwapSpareCell</strong></p>
<p><del>If the cell to be swapped is unplaced, it is mapped to the spare
cell. <code>*instName*</code> is deleted, and its connection is
transferred to the spare cell. If the cell to be swapped is placed, it
is swapped with the spare cell and is renamed to
<code>*instNameSuffix*</code> if the <code>-suffix</code> option is
used. If a suffix is not specified, the <code>*instName*</code> cell is
renamed to <code>*spareCellInstName*</code>. The <code>*instName*</code>
cell's connections are transferred to <code>*spareCellInstName*</code>.
The input of <code>*instName*</code> is <code>tielo</code>, based on the
global connection definition.</del></p>
<p><strong>reference:</strong></p>
<p><a
target="_blank" rel="noopener" href="https://community.cadence.com/cadence_blogs_8/b/di/posts/answers-to-frequently-asked-questions-when-performing-ecos-in-edi-system">Answers
to Top 10 Questions on Performing ECOs in EDI System</a></p>
<p><a
target="_blank" rel="noopener" href="https://eecs.wsu.edu/~daehyun/teaching/2014_EE582/assignments/a10/a10.html">EE
582: Physical Design Automation of VLSI Circuits and Systems</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/06/power-ground-io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/06/power-ground-io/" class="post-title-link" itemprop="url">Power/Ground and I/O Pins</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-06 18:24:54" itemprop="dateCreated datePublished" datetime="2022-03-06T18:24:54+00:00">2022-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-07-14 11:30:34" itemprop="dateModified" datetime="2023-07-14T11:30:34+00:00">2023-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="power-ground-pin-information">Power / Ground Pin
Information</h4>
<p>In both digital and analog I/O, power and ground pins appear at the
sub-circuit definiton, allowing user to use the I/O in voltage islands.
They follow certain naming conventions.</p>
<ol type="1">
<li>digital I/O sub-circuit</li>
</ol>
<ul>
<li>VDD: pre-driver core voltage (supplied by PVDD1CDGM)</li>
<li>VSS: pre-driver ground and also global ground (supplied by
PVDD1CDGM)</li>
<li>VDDPST: I/O post-driver voltage, i.e. 1.8V (supplied by PVDD2CDGM or
PVDD2POCM)</li>
<li>VSSPOST: I/O post-driver ground (supplied by PVDD2CDGM or
PVDD2POCM)</li>
<li>POCCTRL: POCCTRL signal (supplied by PVDD2POCM)</li>
</ul>
<ol start="2" type="1">
<li>analog I/O placed in a core voltage domain, the convention is</li>
</ol>
<ul>
<li>TACVDD: analog core voltage (supplied by PVDD3ACM)</li>
<li>TACVSS: analog core ground (supplied by PVDD3ACM)</li>
<li>VSS: global core ground</li>
</ul>
<ol start="3" type="1">
<li>analog I/O placed in an I/O voltage domain, the convention is:</li>
</ol>
<ul>
<li>TAVDD: analog I/O voltage, i.e. 1.8V (supplied by PVDD3AM)</li>
<li>TAVSS: analog I/O ground (supplied by PVDD3AM)</li>
<li>VSS: global core ground</li>
</ul>
<p>Power/Ground <strong>Combo Cells</strong></p>
<table>
<colgroup>
<col style="width: 35%" />
<col style="width: 36%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="header">
<th>power/ground combo pad cell</th>
<th>pins to be connected to bump</th>
<th>to core side pin name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PVDD1CDGM</td>
<td>VDD VSS</td>
<td>VDD VSS</td>
</tr>
<tr class="even">
<td>PVDD2CDGM PVDD2POCM</td>
<td>VDDPST VSSPST</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>PVDD3AM</td>
<td>TAVDD TAVSS</td>
<td>AVDD AVSS</td>
</tr>
<tr class="even">
<td>PVDD3ACM</td>
<td>TACVDD TACVSS</td>
<td>AVDD AVSS</td>
</tr>
</tbody>
</table>
<h4 id="note-for-the-retention-mode">Note for the retention mode</h4>
<ol type="1">
<li>At initial state, IRTE must be <strong>0</strong> when VDD is
off.</li>
<li>IRTE must be kept &gt;= 10us after VDD turns on again (from the
retention mode to the normal operation mode).</li>
<li>IRTE can be switched only when both VDD and VDDPST are on.</li>
</ol>
<p><img src="/2022/03/06/power-ground-io/rention_seq.drawio.svg"
alt="rention_seq.drawio" /></p>
<p>When the rention function is needed, IRTE signal must come from an
"always-on" core power domain. If you don't need the rention function,
it is required to tie IRTE to ground. In other words, <strong>no matter
the rention feature is needed or not, it is required to have PCBRTE in
each domain</strong>.</p>
<p><img
src="/2022/03/06/power-ground-io/PCBRTE_in_digital_domain.drawio.svg"
alt="PCBRTE_in_digital_domain.drawio" /></p>
<p><strong>Note</strong>: PCBRTE <strong>does not</strong> need PAD
connection.</p>
<h4 id="internal-pins">Internal Pins</h4>
<p>There are 3 internal global pins, i.e. <strong>ESD</strong>,
<strong>POCCTRL</strong>, <strong>RTE</strong>, in all digital domain
cells.</p>
<p>In real application,</p>
<ul>
<li><strong>ESD pin</strong> is an internal signal and
<strong>active</strong> in ESD event happening</li>
<li><strong>POCCTRL</strong> is an internal signal and active in
Power-on-control event.</li>
</ul>
<p>However, these special events (i.e. ESD event and Power-on-control
event) are not modeled in NLDM kit (.lib), only normal function is
covered, so <strong>ESD</strong> and <strong>POCCTRL</strong> pins are
simply defined as ground in NLDM kit (.lib).</p>
<blockquote>
<p>These 3 global pins will be connected automatically after
<strong>cell-to-cell abutting</strong> in physical layout.</p>
</blockquote>
<h4 id="power-up-sequence-in-digital-domain">Power-Up sequence in
Digital Domain</h4>
<p>Power up the I/O power (VDDPST) first, then the core power (VDD)</p>
<p><img src="/2022/03/06/power-ground-io/pocctrl_seq.drawio.svg"
alt="pocctrl_seq.drawio" /></p>
<ol type="1">
<li>PVDDD2POCM cell would generate Power-On-Control signal (POCCTRL) to
have the post-driver NMOS and PMOS off, so that the crowbar current
would not occur in the post-driver fingers when the I/O voltage is on
while the core voltage remains off. As such, I/O cell would be in the
Hi-Z state. when POCCTRL is on, the pll-up/down resistor is disabled and
C is 0.</li>
<li>The POCCTRL signal is transmitted to I/O cells through <strong>cell
abutment</strong>. There is no need to have routing for POCCTTRL nor
give a control signal to the POCCTRL pin any of I/O cells. Note that the
POCCTRL signal would be cut if inserting a power-cut (PRCUT) cell.</li>
</ol>
<p><img
src="/2022/03/06/power-ground-io/power-on-control-ciruit.drawio.svg"
alt="power-on-control-ciruit.drawio" /></p>
<h4 id="power-down-sequence-in-digital-domain">Power-Down sequence in
Digital Domain</h4>
<p>It's the reverse of power-up sequence.</p>
<h4 id="use-model-in-innovus">Use model in Innovus</h4>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> init_gnd_net <span class="string">&quot;vss_core vss DUMMY_ESD DUMMY_POCCTRL&quot;</span></span><br><span class="line"></span><br><span class="line">addInst -moduleBased u_io -ori R270 -physical -status fixed -loc <span class="number">135</span> <span class="number">994</span> -inst u_io/VDDIO_1 -cell PVDD2CDGM_H</span><br><span class="line"></span><br><span class="line">addNet u_io_RTE</span><br><span class="line">attachTerm FILLER_6 RTE u_io_RTE</span><br><span class="line">attachTerm VDDIO_1 RTE u_right_RTE</span><br><span class="line">setAttribute -skip_routing true -net u_io_RTE</span><br><span class="line"></span><br><span class="line">clearGlobalNets</span><br><span class="line">globalNetConnect DUMMY_POCCTRL -type pgpin -pin POCCTRL -singleInstance u_io/VDDDIO_1 -override</span><br><span class="line">globalNetConnect DUMMY_ESD -type pgpin -pin ESD -singleInstance u_io/VDDDIO_1 -override</span><br></pre></td></tr></table></figure>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> pins [get_object_name [get_ports *]]</span><br><span class="line"><span class="keyword">foreach</span> pin <span class="variable">$pins</span> &#123;</span><br><span class="line">	<span class="keyword">set</span> netPtr [dbGetNetByName <span class="variable">$pin</span>]</span><br><span class="line">	<span class="keyword">if</span> &#123; <span class="variable">$netPtr</span> == <span class="string">&quot;0x0&quot;</span> &#125; &#123;</span><br><span class="line">		<span class="keyword">puts</span> <span class="string">&quot;INFO: can&#x27;t find the port: $pin&quot;</span></span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		setAttribute -net <span class="variable">$pin</span> -skip_routing true</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> net [get_object_name [get_nets -of_objects [get_pins */RTE -hierarchical]]] &#123;</span><br><span class="line">	setAttribute -net <span class="variable">$net</span> -skip_routing true</span><br><span class="line">	dbSet [dbGetNetByName <span class="variable">$net</span>].dontTouch true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Guo</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
