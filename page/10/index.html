<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="KNOW-HOW">
<meta property="og:url" content="http://example.com/page/10/index.html">
<meta property="og:site_name" content="KNOW-HOW">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Guo">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>KNOW-HOW</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">KNOW-HOW</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">168</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/raytroop" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;raytroop" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:raytroop@gmail.com" title="E-Mail → mailto:raytroop@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/07/Overflowflag-verilog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/07/Overflowflag-verilog/" class="post-title-link" itemprop="url">Overflow Detection in Verilog</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-07 21:12:38" itemprop="dateCreated datePublished" datetime="2022-05-07T21:12:38+00:00">2022-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:51" itemprop="dateModified" datetime="2024-06-02T08:39:51+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>Arithmetic operations have a potential to run into a condition known
as <em>overflow</em>.</li>
<li>Overflow occurs with respect to the <strong>size of the data
type</strong> that must accommodate the result.</li>
<li>Overflow indicates that the result was <em>too large</em> or <em>too
small</em> to fit in the original data type.</li>
</ul>
<h2 id="overflow-when-adding-unsigned-number">Overflow when adding
unsigned number</h2>
<p>When two unsigned numbers are added, overflow occurs if</p>
<ul>
<li>there is a <strong>carry out</strong> of the leftmost bit.</li>
</ul>
<h2 id="overflow-when-adding-signed-numbers">Overflow when adding signed
numbers</h2>
<p>When two signed 2's complement numbers are added, overflow is
detected if:</p>
<ol type="1">
<li>both operands are positive and the result is negative, or</li>
<li>both operands are negative and the result is positive.</li>
</ol>
<p>Notice that when operands have <strong>opposite signs</strong>, their
sum will never overflow. Therefore, <em>overflow can only occur when the
operands have the same sign</em>.</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th>carryout_sum</th>
<th>overflow</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>0</strong>11 (3)</td>
<td><strong>0</strong>11 (3)</td>
<td>0_<strong>1</strong>10 (6)</td>
<td>overflow</td>
</tr>
<tr class="even">
<td><strong>1</strong>00 (-4)</td>
<td><strong>1</strong>00 (-4)</td>
<td>1_<strong>0</strong>00 (-8)</td>
<td>underflow</td>
</tr>
<tr class="odd">
<td><strong>1</strong>11 (-1)</td>
<td><strong>1</strong>10 (-2)</td>
<td>1_<strong>1</strong>01 (-3)</td>
<td>-</td>
</tr>
</tbody>
</table>
<blockquote>
<p>carryout information <strong>ISN'T</strong> needed to detect
overflow/underflow for signed number addition</p>
</blockquote>
<h3 id="extbitmsb">EXTBIT:MSB</h3>
<p>extended 1bit and msb bit can be used to detect overflow or
underflow</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span>  [<span class="number">1</span>:<span class="number">0</span>]      acc_inc;</span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span>  [<span class="number">10</span>-<span class="number">1</span>:<span class="number">0</span>]   acc;</span><br><span class="line"><span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">10</span>  :<span class="number">0</span>]   acc_w;  <span class="comment">// extend 1b for saturation</span></span><br><span class="line"><span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">10</span>-<span class="number">1</span>:<span class="number">0</span>]   acc_stat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> acc_w = acc + acc_inc;   <span class="comment">// signed arithmetic</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> acc_stat = (acc_w[<span class="number">10</span>-<span class="number">1</span> +: <span class="number">2</span>] == <span class="number">2&#x27;b01</span>) ? &#123;<span class="number">1&#x27;b0</span>, &#123;(<span class="number">10</span>-<span class="number">1</span>)&#123;<span class="number">1&#x27;b1</span>&#125;&#125;&#125; : <span class="comment">// up saturation</span></span><br><span class="line">    (acc_w[<span class="number">10</span>-<span class="number">1</span> +: <span class="number">2</span>] == <span class="number">2&#x27;b10</span>) ? &#123;<span class="number">1&#x27;b1</span>, &#123;(<span class="number">10</span>-<span class="number">1</span>)&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;  :   			 <span class="comment">// down saturation</span></span><br><span class="line">    acc_w[<span class="number">10</span>-<span class="number">1</span>:<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>2'b01</code> : overflow, up saturation</p>
<p><code>2'b10</code>: underflow, down saturation</p>
</blockquote>
<h2 id="s-complement-negative-number">2's complement negative
number</h2>
<ol type="1">
<li>Flip all bits</li>
<li>Add <strong>1</strong>.</li>
</ol>
<p>N-bit signed number <span class="math display">\[
A = -M_{N-1}2^{N-1}+\sum_{k=0}^{N-2}M_k2^k
\]</span> Flip all bits <span class="math display">\[\begin{align}
A_{flip} &amp;= -(1-M_{N-1})2^{N-1} +\sum_{k=0}^{N-2}(1-M_k)2^k \\
&amp;= M_{N-1}2^{N-1}-\sum_{k=0}^{N-2}M_k2^k
-2^{N-1}+\sum_{k=0}^{N-2}2^k \\
&amp;= M_{N-1}2^{N-1}-\sum_{k=0}^{N-2}M_k2^k -1
\end{align}\]</span></p>
<p>Add <strong>1</strong> <span class="math display">\[\begin{align}
A_- &amp;= A_{flip}+1 \\
&amp;= M_{N-1}2^{N-1}-\sum_{k=0}^{N-2}M_k2^k \\
&amp;= -A
\end{align}\]</span></p>
<h2 id="reference">reference</h2>
<p>Overflow Detection: <a
target="_blank" rel="noopener" href="http://www.c-jump.com/CIS77/CPU/Overflow/lecture.html">http://www.c-jump.com/CIS77/CPU/Overflow/lecture.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/07/mixed-sign-verilog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/07/mixed-sign-verilog/" class="post-title-link" itemprop="url">Mixing Signed and Unsigned in Verilog</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-07 16:23:26" itemprop="dateCreated datePublished" datetime="2022-05-07T16:23:26+00:00">2022-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Sign Extension</p>
<ol type="1">
<li>Calculate the necessary minimum width of the sum so that it contains
all input possibilities</li>
<li>Extend the inputs' sign bits to the width of the answer</li>
<li>Add as usual</li>
<li>Ignore bits that ripple to the left of the answer's MSB</li>
</ol>
<ol type="1">
<li><strong>signed</strong></li>
</ol>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 18%" />
<col style="width: 18%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>inA (signed)</th>
<th>inB (signed)</th>
<th>outSum<br />(signed/unsigned)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>0101 (5)</td>
<td>1111 (-1)</td>
<td></td>
</tr>
<tr class="even">
<td><em>extend sign</em></td>
<td><strong>0</strong>0101</td>
<td><strong>1</strong>1111</td>
<td></td>
</tr>
<tr class="odd">
<td><em>sum result</em></td>
<td></td>
<td></td>
<td>00100</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inA;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inB;</span><br><span class="line">    <span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">4</span>:<span class="number">0</span>] outSumSg;	<span class="comment">// signed result</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] outSumUs;			<span class="comment">// unsigned result</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">		inA = <span class="number">4&#x27;b0101</span>;</span><br><span class="line">		inB = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">		outSumUs = inA + inB;</span><br><span class="line">		outSumSg = inA + inB;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%d): %0d&quot;</span>, outSumSg);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%b): %b&quot;</span>, outSumSg);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%d): %0d&quot;</span>, outSumUs);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%b): %b&quot;</span>, outSumUs);</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li><strong>mixed</strong></li>
</ol>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>inA (signed)</th>
<th>inB (unsigned)</th>
<th>outSum<br />(signed/unsigned)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>0101 (5)</td>
<td>1111 (15)</td>
<td></td>
</tr>
<tr class="even">
<td><em>extend sign</em></td>
<td><strong>0</strong>0101</td>
<td><strong>0</strong>1111</td>
<td></td>
</tr>
<tr class="odd">
<td><em>sum result</em></td>
<td></td>
<td></td>
<td>10100</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inA;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] inB;</span><br></pre></td></tr></table></figure>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 20%" />
<col style="width: 17%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>inA (unsigned)</th>
<th>inB (signed)</th>
<th>outSum<br />(signed/unsigned)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>0101 (5)</td>
<td>1111 (-1)</td>
<td></td>
</tr>
<tr class="even">
<td><em>extend sign</em></td>
<td><strong>0</strong>0101</td>
<td><strong>0</strong>1111</td>
<td></td>
</tr>
<tr class="odd">
<td><em>sum result</em></td>
<td></td>
<td></td>
<td>10100</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb;</span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] inA;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inB;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">4</span>:<span class="number">0</span>] outSumSg;</span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] outSumUs;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">		inA = <span class="number">4&#x27;b0101</span>;</span><br><span class="line">		inB = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">		outSumUs = inA + inB;</span><br><span class="line">		outSumSg = inA + inB;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%d): %0d&quot;</span>, outSumSg);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%b): %b&quot;</span>, outSumSg);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%d): %0d&quot;</span>, outSumUs);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%b): %b&quot;</span>, outSumUs);</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><strong>xcelium</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xcelium&gt; run</span><br><span class="line">signed out(%d): -12</span><br><span class="line">signed out(%b): 10100</span><br><span class="line">unsigned out(%d): 20</span><br><span class="line">unsigned out(%b): 10100</span><br><span class="line">xmsim: *W,RNQUIE: Simulation is complete.</span><br><span class="line">xcelium&gt; exit</span><br></pre></td></tr></table></figure>
<p><strong>vcs</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Compiler version S-2021.09-SP2-1_Full64; Runtime version S-2021.09-SP2-1_Full64;  May  7 17:24 2022</span><br><span class="line">signed out(%d): -12</span><br><span class="line">signed out(%b): 10100</span><br><span class="line">unsigned out(%d): 20</span><br><span class="line">unsigned out(%b): 10100</span><br><span class="line">           V C S   S i m u l a t i o n   R e p o r t</span><br></pre></td></tr></table></figure>
<h3 id="observation">observation</h3>
<blockquote>
<p>When <em>signed</em> and <em>unsigned</em> is <strong>mixed</strong>,
the result is by default <strong>unsigned</strong>.</p>
<p>Prepend to operands with <strong>0</strong>s instead of extending
sign, even though the operands is signed</p>
<p>LHS <strong>DONT</strong> affect how the simulator operate on the
operands but what the results represent, signed or unsigned</p>
</blockquote>
<p>Therefore, although <code>outSumUs</code> is declared as signed, its
result is unsigned</p>
<h4 id="subtraction-example">subtraction example</h4>
<p>In logic arithmetic, addition and subtraction are commonly used for
digital design. Subtraction is similar to addition except that the
subtracted number is 2's complement. By using 2's complement for the
subtracted number, both addition and subtraction can be unified to using
addition only.</p>
<h5 id="operands-are-signed">operands are signed</h5>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 18%" />
<col style="width: 18%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>inA (signed)</th>
<th>inB (signed)</th>
<th>outSub<br />(signed/unsigned)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>1111 (-1)</td>
<td>0010 (2)</td>
<td></td>
</tr>
<tr class="even">
<td><em>extend sign</em></td>
<td><strong>1</strong>1111</td>
<td><strong>0</strong>0010</td>
<td></td>
</tr>
<tr class="odd">
<td><em>sub result</em></td>
<td></td>
<td></td>
<td>11101</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inA;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inB;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">4</span>:<span class="number">0</span>] outSubSg;</span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] outSubUs;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">		inA = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">		inB = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">		outSubUs = inA - inB;</span><br><span class="line">		outSubSg = inA - inB;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%d): %0d&quot;</span>, outSubSg);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%b): %b&quot;</span>, outSubSg);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%d): %0d&quot;</span>, outSubUs);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%b): %b&quot;</span>, outSubUs);</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Compiler version S-2021.09-SP2-1_Full64; Runtime version S-2021.09-SP2-1_Full64;  May  7 17:46 2022</span><br><span class="line">signed out(%d): -3</span><br><span class="line">signed out(%b): 11101</span><br><span class="line">unsigned out(%d): 29</span><br><span class="line">unsigned out(%b): 11101</span><br><span class="line">           V C S   S i m u l a t i o n   R e p o r t</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xcelium&gt; run</span><br><span class="line">signed out(%d): -3</span><br><span class="line">signed out(%b): 11101</span><br><span class="line">unsigned out(%d): 29</span><br><span class="line">unsigned out(%b): 11101</span><br><span class="line">xmsim: *W,RNQUIE: Simulation is complete.</span><br></pre></td></tr></table></figure>
<h5 id="operands-are-mixed">operands are mixed</h5>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>inA (signed)</th>
<th>inB (unsigned)</th>
<th>outSub<br />(signed/unsigned)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>1111 (-1)</td>
<td>0010 (2)</td>
<td></td>
</tr>
<tr class="even">
<td><em>extend sign</em></td>
<td><strong>0</strong>1111</td>
<td><strong>0</strong>0010</td>
<td></td>
</tr>
<tr class="odd">
<td><em>sub result</em></td>
<td></td>
<td></td>
<td>01101</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> tb;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] inA;</span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] inB;</span><br><span class="line">	<span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">4</span>:<span class="number">0</span>] outSubSg;</span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] outSubUs;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">		inA = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">		inB = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">		outSubUs = inA - inB;</span><br><span class="line">		outSubSg = inA - inB;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%d): %0d&quot;</span>, outSubSg);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;signed out(%%b): %b&quot;</span>, outSubSg);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%d): %0d&quot;</span>, outSubUs);</span><br><span class="line">		<span class="built_in">$display</span>(<span class="string">&quot;unsigned out(%%b): %b&quot;</span>, outSubUs);</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Compiler version S-2021.09-SP2-1_Full64; Runtime version S-2021.09-SP2-1_Full64;  May  7 17:50 2022</span><br><span class="line">signed out(%d): 13</span><br><span class="line">signed out(%b): 01101</span><br><span class="line">unsigned out(%d): 13</span><br><span class="line">unsigned out(%b): 01101</span><br><span class="line">           V C S   S i m u l a t i o n   R e p o r t </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xcelium&gt; run</span><br><span class="line">signed out(%d): 13</span><br><span class="line">signed out(%b): 01101</span><br><span class="line">unsigned out(%d): 13</span><br><span class="line">unsigned out(%b): 01101</span><br><span class="line">xmsim: *W,RNQUIE: Simulation is complete.</span><br><span class="line">xcelium&gt; exit</span><br></pre></td></tr></table></figure>
<h3 id="danger-sign">Danger Sign</h3>
<p><a
target="_blank" rel="noopener" href="https://projectf.io/posts/numbers-in-verilog/">https://projectf.io/posts/numbers-in-verilog/</a></p>
<blockquote>
<p>Verilog has a nasty habit of treating everything as unsigned unless
all variables in an expression are signed. To add insult to injury, most
tools won’t warn you if signed values are being ignored.</p>
<p>If you take one thing away from this post:</p>
<p><strong>Never mix signed and unsigned variables in one
expression!</strong></p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> signed_tb ();</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">7</span>:<span class="number">0</span>] x;  <span class="comment">// &#x27;x&#x27; is unsigned</span></span><br><span class="line">    <span class="keyword">logic</span> <span class="keyword">signed</span> [<span class="number">7</span>:<span class="number">0</span>] y;  <span class="comment">// &#x27;y&#x27; is signed</span></span><br><span class="line">    <span class="keyword">logic</span> <span class="keyword">signed</span> [<span class="number">7</span>:<span class="number">0</span>] x1, y1;</span><br><span class="line">    <span class="keyword">logic</span> <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] move;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        x1 = x + move;  <span class="comment">// !? DANGER: &#x27;x&#x27; is unsigned but &#x27;move&#x27; is signed</span></span><br><span class="line">        y1 = y + move;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        #<span class="number">10</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;Coordinates (7,7):&quot;</span>);</span><br><span class="line">        x = <span class="number">8&#x27;d7</span>;</span><br><span class="line">        y = <span class="number">8&#x27;d7</span>;</span><br><span class="line">        #<span class="number">10</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;x : %b  %d&quot;</span>, x, x);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;y : %b  %d&quot;</span>, y, y);</span><br><span class="line"></span><br><span class="line">        #<span class="number">10</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;Move +4:&quot;</span>);</span><br><span class="line">        move = <span class="number">4</span>&#x27;sd4;  <span class="comment">// signed positive value</span></span><br><span class="line">        #<span class="number">10</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;x1: %b  %d  *LOOKS OK*&quot;</span>, x1, x1);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;y1: %b  %d&quot;</span>, y1, y1);</span><br><span class="line"></span><br><span class="line">        #<span class="number">10</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;Move -4:&quot;</span>);</span><br><span class="line">        move = -<span class="number">4</span>&#x27;sd4;  <span class="comment">// signed negative value</span></span><br><span class="line">        #<span class="number">10</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;x1: %b  %d  *SURPRISE*&quot;</span>, x1, x1);     <span class="comment">// 0000_0111 + &#123;0000&#125;_1100 = 0001_0011</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;y1: %b  %d&quot;</span>, y1, y1);                 <span class="comment">// 0000_0111 + &#123;1111&#125;_1100 = 0000_0011</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Chronologic VCS simulator copyright 1991-2021</span><br><span class="line">Contains Synopsys proprietary information.</span><br><span class="line">Compiler version S-2021.09-SP2-2_Full64; Runtime version S-2021.09-SP2-2_Full64;  Nov 19 11:02 2022                                     </span><br><span class="line">Coordinates (7,7):</span><br><span class="line">x : 00000111    7</span><br><span class="line">y : 00000111            7</span><br><span class="line">Move +4:</span><br><span class="line">x1: 00001011           11  *LOOKS OK*</span><br><span class="line">y1: 00001011           11</span><br><span class="line">Move -4:</span><br><span class="line">x1: 00010011           19  *SURPRISE*</span><br><span class="line">y1: 00000011            3</span><br><span class="line">           V C S   S i m u l a t i o n   R e p o r t</span><br><span class="line">Time: 60</span><br><span class="line">CPU Time:      0.260 seconds;       Data structure size:   0.0Mb</span><br></pre></td></tr></table></figure>
<h3 id="reference">reference</h3>
<p>Lee WF. Learning from VLSI Design Experience [electronic Resource] /
by Weng Fook Lee. 1st ed. 2019. Springer International Publishing; 2019.
doi:10.1007/978-3-030-03238-8</p>
<p><a target="_blank" rel="noopener" href="https://www.ece.ucdavis.edu/~bbaas/281/">Bevan Baas, VLSI
Digital Signal Processing, EEC 281 - VLSI Digital Signal
Processing</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/07/signed-verilog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/07/signed-verilog/" class="post-title-link" itemprop="url">signed and unsigned arithmetic in Verilog</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-07 11:37:18" itemprop="dateCreated datePublished" datetime="2022-05-07T11:37:18+00:00">2022-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/digital/" itemprop="url" rel="index"><span itemprop="name">digital</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>With <strong>implict sign extension</strong>, the implementation of
<strong>signed</strong> arithmetic is <strong>DIFFERENT</strong> from
that of <strong>unsigned</strong>. Otherwise, their implementations are
same.</p>
<p>The implementations manifest the RTL's behaviour correctly</p>
<h2 id="add-without-implicit-sign-extension">add without implicit sign
extension</h2>
<h3 id="unsigned">unsigned</h3>
<h4 id="rtl">rtl</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> TOP (</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] data0</span><br><span class="line">	,<span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] data1</span><br><span class="line">	,<span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] result</span><br><span class="line">);</span><br><span class="line">	<span class="keyword">assign</span> result = data0 + data1;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/07/signed-verilog/image-20220507114215200.png"
alt="image-20220507114215200" /></p>
<h4 id="synthesized-netlist">synthesized netlist</h4>
<p><img src="/2022/05/07/signed-verilog/image-20220507114307439.png"
alt="image-20220507114307439" /></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Created by: Synopsys DC Ultra(TM) in wire load mode</span></span><br><span class="line"><span class="comment">// Version   : S-2021.06-SP5</span></span><br><span class="line"><span class="comment">// Date      : Sat May  7 11:43:27 2022</span></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> TOP ( data0, data1, result );</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] data0;</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] data1;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] result;</span><br><span class="line">  <span class="keyword">wire</span>   n4, n5, n6;</span><br><span class="line"></span><br><span class="line">  an02d0 U6 ( <span class="variable">.A1</span>(data0[<span class="number">0</span>]), <span class="variable">.A2</span>(data1[<span class="number">0</span>]), <span class="variable">.Z</span>(n5) );</span><br><span class="line">  nr02d0 U7 ( <span class="variable">.A1</span>(data0[<span class="number">0</span>]), <span class="variable">.A2</span>(data1[<span class="number">0</span>]), <span class="variable">.ZN</span>(n4) );</span><br><span class="line">  nr02d0 U8 ( <span class="variable">.A1</span>(n5), <span class="variable">.A2</span>(n4), <span class="variable">.ZN</span>(result[<span class="number">0</span>]) );</span><br><span class="line">  ad01d0 U9 ( <span class="variable">.A</span>(data1[<span class="number">1</span>]), <span class="variable">.B</span>(data0[<span class="number">1</span>]), <span class="variable">.CI</span>(n5), <span class="variable">.CO</span>(n6), <span class="variable">.S</span>(result[<span class="number">1</span>]) );</span><br><span class="line">  xr03d1 U10 ( <span class="variable">.A1</span>(n6), <span class="variable">.A2</span>(data0[<span class="number">2</span>]), <span class="variable">.A3</span>(data1[<span class="number">2</span>]), <span class="variable">.Z</span>(result[<span class="number">2</span>]) );</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>vcs compile with <code>-v /path/to/lib.v</code></p>
</blockquote>
<h3 id="signed">signed</h3>
<h4 id="rtl-1">rtl</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> TOP (</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">2</span>:<span class="number">0</span>] data0</span><br><span class="line">	,<span class="keyword">input</span> <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">2</span>:<span class="number">0</span>] data1</span><br><span class="line">	,<span class="keyword">output</span> <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">2</span>:<span class="number">0</span>] result</span><br><span class="line">);</span><br><span class="line">	<span class="keyword">assign</span> result = data0 + data1;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/07/signed-verilog/image-20220507114654777.png"
alt="image-20220507114654777" /></p>
<h4 id="synthesized-netlist-1">synthesized netlist</h4>
<p><img src="/2022/05/07/signed-verilog/image-20220507114844111.png"
alt="image-20220507114844111" /></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Created by: Synopsys DC Ultra(TM) in wire load mode</span></span><br><span class="line"><span class="comment">// Version   : S-2021.06-SP5</span></span><br><span class="line"><span class="comment">// Date      : Sat May  7 11:48:54 2022</span></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> TOP ( data0, data1, result );</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] data0;</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] data1;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] result;</span><br><span class="line">  <span class="keyword">wire</span>   n4, n5, n6;</span><br><span class="line"></span><br><span class="line">  an02d0 U6 ( <span class="variable">.A1</span>(data0[<span class="number">0</span>]), <span class="variable">.A2</span>(data1[<span class="number">0</span>]), <span class="variable">.Z</span>(n5) );</span><br><span class="line">  nr02d0 U7 ( <span class="variable">.A1</span>(data0[<span class="number">0</span>]), <span class="variable">.A2</span>(data1[<span class="number">0</span>]), <span class="variable">.ZN</span>(n4) );</span><br><span class="line">  nr02d0 U8 ( <span class="variable">.A1</span>(n5), <span class="variable">.A2</span>(n4), <span class="variable">.ZN</span>(result[<span class="number">0</span>]) );</span><br><span class="line">  ad01d0 U9 ( <span class="variable">.A</span>(data1[<span class="number">1</span>]), <span class="variable">.B</span>(data0[<span class="number">1</span>]), <span class="variable">.CI</span>(n5), <span class="variable">.CO</span>(n6), <span class="variable">.S</span>(result[<span class="number">1</span>]) );</span><br><span class="line">  xr03d1 U10 ( <span class="variable">.A1</span>(n6), <span class="variable">.A2</span>(data0[<span class="number">2</span>]), <span class="variable">.A3</span>(data1[<span class="number">2</span>]), <span class="variable">.Z</span>(result[<span class="number">2</span>]) );</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="add-with-implicit-sign-extension">add WITH implicit sign
extension</h2>
<h3 id="unsigned-with-0-extension">unsigned with 0 extension</h3>
<h4 id="rtl-2">rtl</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> TOP (</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] data0		<span class="comment">// 3 bit unsigned</span></span><br><span class="line">    ,<span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] data1		<span class="comment">// 2 bit unsigned</span></span><br><span class="line">    ,<span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] result	<span class="comment">// 3 bit unsigned</span></span><br><span class="line">);</span><br><span class="line">	<span class="keyword">assign</span> result = data0 + data1;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/07/signed-verilog/image-20220507121521303.png"
alt="image-20220507121521303" /></p>
<h4 id="synthesized-netlist-2">synthesized netlist</h4>
<p><img src="/2022/05/07/signed-verilog/image-20220507121622001.png"
alt="image-20220507121622001" /></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Created by: Synopsys DC Ultra(TM) in wire load mode</span></span><br><span class="line"><span class="comment">// Version   : S-2021.06-SP5</span></span><br><span class="line"><span class="comment">// Date      : Sat May  7 12:15:58 2022</span></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> TOP ( data0, data1, result );</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] data0;</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] data1;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] result;</span><br><span class="line">  <span class="keyword">wire</span>   n4, n5, n6;</span><br><span class="line"></span><br><span class="line">  an02d0 U6 ( <span class="variable">.A1</span>(data1[<span class="number">0</span>]), <span class="variable">.A2</span>(data0[<span class="number">0</span>]), <span class="variable">.Z</span>(n6) );</span><br><span class="line">  ad01d0 U7 ( <span class="variable">.A</span>(data1[<span class="number">1</span>]), <span class="variable">.B</span>(data0[<span class="number">1</span>]), <span class="variable">.CI</span>(n6), <span class="variable">.CO</span>(n4), <span class="variable">.S</span>(result[<span class="number">1</span>]) );</span><br><span class="line">  xr02d1 U8 ( <span class="variable">.A1</span>(data0[<span class="number">2</span>]), <span class="variable">.A2</span>(n4), <span class="variable">.Z</span>(result[<span class="number">2</span>]) );</span><br><span class="line">  nr02d0 U9 ( <span class="variable">.A1</span>(data1[<span class="number">0</span>]), <span class="variable">.A2</span>(data0[<span class="number">0</span>]), <span class="variable">.ZN</span>(n5) );</span><br><span class="line">  nr02d0 U10 ( <span class="variable">.A1</span>(n6), <span class="variable">.A2</span>(n5), <span class="variable">.ZN</span>(result[<span class="number">0</span>]) );</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="signed-with-implicit-sign-extension">signed with implicit sign
extension</h3>
<h4 id="rtl-3">rtl</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> TOP (</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">2</span>:<span class="number">0</span>] data0</span><br><span class="line">	,<span class="keyword">input</span> <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">1</span>:<span class="number">0</span>] data1</span><br><span class="line">	,<span class="keyword">output</span> <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">2</span>:<span class="number">0</span>] result</span><br><span class="line">);</span><br><span class="line">	<span class="keyword">assign</span> result = data0 + data1;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/07/signed-verilog/image-20220507122053948.png"
alt="image-20220507122053948" /></p>
<h4 id="synthesized-netlist-3">synthesized netlist</h4>
<p><img src="/2022/05/07/signed-verilog/image-20220507122217830.png"
alt="image-20220507122217830" /></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Created by: Synopsys DC Ultra(TM) in wire load mode</span></span><br><span class="line"><span class="comment">// Version   : S-2021.06-SP5</span></span><br><span class="line"><span class="comment">// Date      : Sat May  7 12:21:51 2022</span></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> TOP ( data0, data1, result );</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] data0;</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] data1;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] result;</span><br><span class="line">  <span class="keyword">wire</span>   n6, n7, n8, n9, n10;</span><br><span class="line"></span><br><span class="line">  nd02d0 U9 ( <span class="variable">.A1</span>(data1[<span class="number">0</span>]), <span class="variable">.A2</span>(data0[<span class="number">0</span>]), <span class="variable">.ZN</span>(n10) );</span><br><span class="line">  inv0d0 U10 ( <span class="variable">.I</span>(n10), <span class="variable">.ZN</span>(n9) );</span><br><span class="line">  nr02d0 U11 ( <span class="variable">.A1</span>(data0[<span class="number">1</span>]), <span class="variable">.A2</span>(data1[<span class="number">1</span>]), <span class="variable">.ZN</span>(n7) );</span><br><span class="line">  aor221d1 U12 ( <span class="variable">.B1</span>(n9), <span class="variable">.B2</span>(data1[<span class="number">1</span>]), <span class="variable">.C1</span>(n10), <span class="variable">.C2</span>(data0[<span class="number">1</span>]), <span class="variable">.A</span>(n7), <span class="variable">.Z</span>(</span><br><span class="line">        n6) );</span><br><span class="line">  xn02d1 U13 ( <span class="variable">.A1</span>(data0[<span class="number">2</span>]), <span class="variable">.A2</span>(n6), <span class="variable">.ZN</span>(result[<span class="number">2</span>]) );</span><br><span class="line">  ora21d1 U14 ( <span class="variable">.B1</span>(data1[<span class="number">0</span>]), <span class="variable">.B2</span>(data0[<span class="number">0</span>]), <span class="variable">.A</span>(n10), <span class="variable">.Z</span>(result[<span class="number">0</span>]) );</span><br><span class="line">  aor21d1 U15 ( <span class="variable">.B1</span>(data1[<span class="number">1</span>]), <span class="variable">.B2</span>(data0[<span class="number">1</span>]), <span class="variable">.A</span>(n7), <span class="variable">.Z</span>(n8) );</span><br><span class="line">  mx02d0 U16 ( <span class="variable">.I0</span>(n10), <span class="variable">.I1</span>(n9), <span class="variable">.S</span>(n8), <span class="variable">.Z</span>(result[<span class="number">1</span>]) );</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/04/cdr-linear/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/04/cdr-linear/" class="post-title-link" itemprop="url">Linear model of the CDR</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-04 10:16:23" itemprop="dateCreated datePublished" datetime="2022-05-04T10:16:23+00:00">2022-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:51" itemprop="dateModified" datetime="2024-06-02T08:39:51+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/analog/" itemprop="url" rel="index"><span itemprop="name">analog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/2022/05/04/cdr-linear/image-20220504101924272.png"
alt="image-20220504101924272" /></p>
<blockquote>
<p>condition:</p>
<p>Linear model of the CDR is used in a <strong>frequency lock
condition</strong> and is approaching to achieve <strong>phase
lock</strong></p>
</blockquote>
<p>Using this model, the power spectral density (PSD) of jitter in the
recovered clock <span class="math inline">\(S_{out}(f)\)</span> is <span
class="math display">\[
S_{out}(f)=|H_T(f)|^2S_{in}(f)+|H_G(f)|^2S_{VCO}(f)
\]</span> Here, we assume <span
class="math inline">\(\varphi_{in}\)</span> and <span
class="math inline">\(\varphi_{VCO}\)</span> are uncorrelated as they
come from independent sources.</p>
<h2 id="jitter-transfer">Jitter Transfer</h2>
<p><span class="math display">\[
H_T(s) =
\frac{\varphi_{out}(s)}{\varphi_{in}(s)}|_{\varphi_{vco}=0}=\frac{K_{PD}K_{VCO}R_s+\frac{K_{PD}K_{VCO}}{C}}{s^2+K_{PD}K_{VCO}R_s+\frac{K_{PD}K_{VCO}}{C}}
\]</span></p>
<p>Using below notation <span class="math display">\[\begin{align}
\omega_n^2=\frac{K_{PD}K_{VCO}}{C} \\
\xi=\frac{K_{PD}K_{VCO}}{2\omega_n^2}
\end{align}\]</span></p>
<p>We can rewrite transfer function as follows <span
class="math display">\[
H_T(s)=\frac{2\xi\omega_n s+\omega_n^2}{s^2+2\xi \omega_n s+\omega_n^2}
\]</span></p>
<blockquote>
<p>The jitter transfer represents a <strong>low-pass filter</strong>
whose magnitude is around 1 (0 dB) for low jitter frequencies and drops
at 20 db/decade for frequencies above <span
class="math inline">\(\omega_n\)</span></p>
</blockquote>
<p><img src="/2022/05/04/cdr-linear/image-20220504104202197.png"
alt="image-20220504104202197" /></p>
<ul>
<li>the recovered clock <strong>track</strong> the <em>low-frequency
jitter</em> of the input data</li>
<li>the recovered clock <strong>DONT</strong> track the
<em>high-frequency jitter</em> of the input data</li>
</ul>
<p>The recovered clock does not suffer from high-frequency jitter even
though the input signal may contain high-frequency jitter, which will
limit the CDR tolerance to high-frequency jitter.</p>
<h2 id="jitter-peaking-in-jitter-transfer-function">Jitter Peaking in
Jitter Transfer Function</h2>
<p>The peak, slightly larger than 1 (0dB) implies that jitter will be
<strong>amplified</strong> at some frequencies in the CDR, producing a
jitter amplitude in the recovered clock, and thus also in the recovered
data, that is slightly <strong>larger</strong> than the jitter amplitude
in the input data.</p>
<p>This is certainly undesirable, especially in applications such as
repeaters.</p>
<p><img src="/2022/05/04/cdr-linear/image-20220504110722442.png"
alt="image-20220504110722442" /></p>
<h2 id="jitter-generation">Jitter Generation</h2>
<p>If the input data to the CDR is clean with no jitter, i.e., <span
class="math inline">\(\varphi_{in}=0\)</span>, the jitter of the
recovered clock comes directly from the VCO jitter. The transfer
function that relates the VCO jitter to the recovered clock jitter is
known as <strong>jitter generation</strong>. <span
class="math display">\[
H_G(s)=\frac{\varphi_{out}}{\varphi_{VCO}}|_{\varphi_{in}=0}=\frac{s^2}{s^2+2\xi
\omega_n s+\omega_n^2}
\]</span> Jitter generation is <strong>high-pass filter</strong> with
two zeros, at zero frequency, and two poles identical to those of the
jitter transfer function</p>
<p><img src="/2022/05/04/cdr-linear/image-20220504110737718.png"
alt="image-20220504110737718" /></p>
<h2 id="jitter-tolerance">Jitter Tolerance</h2>
<p>To quantify jitter tolerance, we often apply a sinusoidal jitter of a
fixed frequency to the CDR input data and observe the BER of the CDR</p>
<p>The jitter tolerance curve <strong>DONT</strong> capture a CDR's true
tolerance to <strong>random</strong> jitter. Because we are applying
"sinusoidal" jitter, which is <strong>deterministic</strong> signal.</p>
<p>We can deal only with the jitter's amplitude and frequency instead of
the PSD of the jitter thanks to deterministic sinusoidal jitter signal.
<span class="math display">\[
JTOL(f) = \left | \varphi_{in}(f)  \right |_{\text{pp-max}} \quad
\text{for a fixed BER}
\]</span> Where the subscript <span
class="math inline">\(\text{pp-max}\)</span> indicates the maximum
peak-to-peak amplitude. We can further expand this equation as follows
<span class="math display">\[
JTOL(f)=\left| \frac{\varphi_{in}(f)}{\varphi_{e}(f)} \right| \cdot
|\varphi_e(f)|_{pp-max}
\]</span> <img src="/2022/05/04/cdr-linear/image-20220504114650749.png"
alt="image-20220504114650749" /></p>
<blockquote>
<p>Relative jitter, <span class="math inline">\(\varphi_e\)</span> must
be less than 1UIpp for error-free operation</p>
</blockquote>
<p>In an ideal CDR, the <strong>maximum peak-to-peak amplitude</strong>
of <span class="math inline">\(|\varphi_e(f)|\)</span> is
<strong>1UI</strong>, i.e.,<span
class="math inline">\(|\varphi_e(f)|_{pp-max}=1UI\)</span></p>
<p>Accordingly, jitter tolerance can be expressed in terms of the number
of UIs as <span class="math display">\[
JTOL(f)=\left| \frac{\varphi_{in}(f)}{\varphi_{e}(f)} \right|\quad
\text{[UI]}
\]</span> Given the linear CDR model, we can write <span
class="math display">\[
JTOL(f)=\left| 1+\frac{K_{PD}K_{VCO}H_{LF}(f)}{j2\pi f} \right|\quad
\text{[UI]}
\]</span> Expand <span class="math inline">\(H_{LF}(f)\)</span> for the
CDR, we can write <span class="math display">\[
JTOL(f)=\left| 1-2\xi j \left(\frac{f_n}{f}\right) -
\left(\frac{f_n}{f}\right)^2 \right|\quad \text{[UI]}
\]</span> <img src="/2022/05/04/cdr-linear/image-20220504120538534.png"
alt="image-20220504120538534" /></p>
<p>At frequencies far below and above the natural frequency, the jitter
tolerance can be approximated by the following <span
class="math display">\[
JTOL(f) = \left\{ \begin{array}{cl}
\left(\frac{f_n}{f}\right)^2 &amp; : \ f\ll f_n \\
1 &amp; : \ f\gg f_n
\end{array} \right.
\]</span></p>
<ul>
<li>the jitter tolerance at very <strong>high jitter
frequencies</strong> is limited to <strong>1UIpp</strong>
<ul>
<li>This is consistent with that the recovered clock does not track the
high-frequency jitter, limiting the maximum peak-to-peak deviation of
the data edge from its nominal position to 1UI</li>
<li>The circumstance, (b) jittery data with ideal clock</li>
</ul></li>
<li>the jitter tolerance is increased at 40dB/decade for jitter
frequencies below <span class="math inline">\(f_c\)</span>
<ul>
<li>This is consistent with our obervation earlier that the recovered
clock better tracks data jitter at lower jitter frequencies</li>
<li>Equivalently, the data edge and the clock edge move together in the
<strong>same direction</strong>. As a result, the relative jitter
between the data and the clock remains small, i.e., below 1UI
peak-to-peak</li>
<li>The circumstance, (c) jittery data and jittery clock</li>
</ul></li>
</ul>
<h2 id="ojtf">OJTF</h2>
<h3 id="concepts-of-jtf-and-ojtf">Concepts of JTF and OJTF</h3>
<p>Simplified Block Diagram of a Clock-Recovery PLL <img
src="/2022/05/04/cdr-linear/pll_block_diagram.gif"
alt="pll_block_diagram" /></p>
<p><strong>Jitter Transfer Function (JTF)</strong></p>
<ul>
<li>Input Signal Versus Recovered Clock</li>
<li>JTF, by jitter frequency, compares how much input signal jitter is
transferred to the <strong>output of a clock-recovery's PLL (recovered
clock)</strong>
<ul>
<li>Input signal jitter that is within the clock recovery PLL's loop
bandwidth results in jitter that is faithfully transferred (closed-loop
gain) to the clock recovery PLL's output signal. JTF in this situation
is approximately 1.</li>
<li>Input signal jitter that is outside the clock recovery PLL's loop
bandwidth results in decreasing jitter (open-loop gain) on the clock
recovery PLL's output, because the jitter is filtered out and no longer
reaches the PLL's VCO</li>
</ul></li>
</ul>
<p><strong>Observed Jitter Transfer Function</strong></p>
<ul>
<li>Input Signal Versus Sampled Signal</li>
<li>OJTF compares how much input signal jitter is transferred to the
<strong>output of a receiver's decision making circuit</strong> as
effected by a clock recovery's PLL. As the recovered clock is the
reference for detecting the input signal
<ul>
<li>Input signal jitter that is <strong>within</strong> the clock
recovery PLL's loop bandwidth results in jitter on the recovered clock
which reduces the amount of jitter that can be detected. The input
signal and clock signal are closer in phase</li>
<li>Input signal jitter that is <strong>outside</strong> the clock
recovery PLL's loop bandwidth results in <strong>reduced jitter on the
recovered cloc</strong>k which increases the amount of jitter that can
be detected. The input signal and clock signal are more out of phase.
Jitter that is on both the input and clock signals can not detected or
is reduced</li>
</ul></li>
</ul>
<p>JTF and OJTF for 1st Order PLLs</p>
<p><img src="/2022/05/04/cdr-linear/jsa_1st_order_graph.png"
alt="jsa_1st_order_graph" /></p>
<p><img src="/2022/05/04/cdr-linear/neuhelium-jtf-ojtf.png"
alt="neuhelium-jtf-ojtf" /></p>
<blockquote>
<p>The observed jitter is a complement to the PLL jitter transfer
response OJTF=1-JTF <strong>(Phase matters!)</strong></p>
<p>OTJF gives the amount of jitter which is tracked and therefore not
observed at the output of the CDR as a function of the jitter rate
applied to the input.</p>
</blockquote>
<p><img src="/2022/05/04/cdr-linear/A-jtf-ojtf.png"
alt="A-jtf-ojtf" /></p>
<h3 id="jitter-measurement">Jitter Measurement</h3>
<p><span class="math display">\[
J_{\text{measured}} = JTF_{\text{DUT}} \cdot OJTF_{\text{instrument}}
\]</span> The combination of the OJTF of a jitter measurement device and
the JTF of the clock generator under test gives the measured jitter as a
function of frequency.</p>
<p><img src="/2022/05/04/cdr-linear/image-20220716094732273.png"
alt="image-20220716094732273" /></p>
<p>For example, a clock generator with a type 1, 1st order PLL measured
with a jitter measurement device employing a golden PLL is <span
class="math display">\[
J_{\text{measured}} = \frac{\omega_1}{s+\omega_1}\frac{s}{s+\omega_2}
\]</span></p>
<p>Accurate measurement of the clock JTF requires that the OJTF cutoff
of the jitter measurement be significantly below that of the clock JTF
and that the measurement is compensated for the instrument's OJTF.</p>
<p>The overall response is a band pass filter because the clock JTF is
low pass and the jitter measurement device OJTF is high pass.</p>
<p>The compensation for the instrument OJTF is performed by measuring
the jitter of the reference clock at each jitter rate being tested and
comparing the <strong>reference jitter</strong> with the <strong>jitter
measured at the output of the DUT</strong>.</p>
<p><img src="/2022/05/04/cdr-linear/jit_resp.png" alt="jtf-ojtf" /></p>
<p>The lower the cutoff frequency of the jitter measurement device the
better the accuracy of the measurement will be.</p>
<p>The cutoff frequency is limited by several factors including the
phase noise of the DUT and measurement time.</p>
<h3 id="digital-sampling-oscilloscope">Digital Sampling
Oscilloscope</h3>
<p>How to analyze jitter:</p>
<ul>
<li>TIE (Time Interval Error) track</li>
<li>histogram</li>
<li>FFT</li>
</ul>
<p><strong>TIE track</strong> provides a direct view of how the phase of
the clock evolves over time.</p>
<p><strong>histogram</strong> provides valuable information about the
long term variations in the timing.</p>
<p><strong>FFT</strong> allows jitter at specific rates to be measured
down to the femto-second range.</p>
<blockquote>
<p>Maintaining the record length at a minimum of <span
class="math inline">\(1/10\)</span> of the inverse of the PLL loop
bandwidth minimizes the response error</p>
</blockquote>
<h2 id="reference">reference</h2>
<p>Dalt, Nicola Da and Ali Sheikholeslami. “Understanding Jitter and
Phase Noise: A Circuits and Systems Perspective.” (2018).</p>
<p>neuhelium, 抖动、眼图和高速数字链路分析基础 URL: <a
target="_blank" rel="noopener" href="http://www.neuhelium.com/ueditor/net/upload/file/20200826/DSOS254A/03.pdf">http://www.neuhelium.com/ueditor/net/upload/file/20200826/DSOS254A/03.pdf</a></p>
<p>Keysight JTF &amp; OJTF Concepts, <a
target="_blank" rel="noopener" href="https://rfmw.em.keysight.com/DigitalPhotonics/flexdca/FlexPLL-UG/Content/Topics/Quick-Start/jtf-pll-theory.htm?TocPath=Quick%20Start%7C_____4">https://rfmw.em.keysight.com/DigitalPhotonics/flexdca/FlexPLL-UG/Content/Topics/Quick-Start/jtf-pll-theory.htm?TocPath=Quick%20Start%7C_____4</a></p>
<p>Complementary Transmitter and Receiver Jitter Test Methodlogy, URL:
<a
target="_blank" rel="noopener" href="https://www.ieee802.org/3/bm/public/mar14/ghiasi_01_0314_optx.pdf">https://www.ieee802.org/3/bm/public/mar14/ghiasi_01_0314_optx.pdf</a></p>
<p>SerDesDesign.com CDR_BangBang_Model URL: <a
target="_blank" rel="noopener" href="https://www.serdesdesign.com/home/web_documents/models/CDR_BangBang_Model.pdf">https://www.serdesdesign.com/home/web_documents/models/CDR_BangBang_Model.pdf</a></p>
<p>M. Schnecker, Jitter Transfer Measurement in Clock Circuits, LeCroy
Corporation, DesignCon 2009. URL: <a
target="_blank" rel="noopener" href="http://cdn.teledynelecroy.com/files/whitepapers/designcon2009_lecroy_jitter_transfer_measurement_in_clock_circuits.pdf">http://cdn.teledynelecroy.com/files/whitepapers/designcon2009_lecroy_jitter_transfer_measurement_in_clock_circuits.pdf</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/01/rhel8-old-kernels/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/01/rhel8-old-kernels/" class="post-title-link" itemprop="url">What is the proper method to remove old kernels from a Red Hat Enterprise Linux system?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-01 22:43:32" itemprop="dateCreated datePublished" datetime="2022-05-01T22:43:32+00:00">2022-05-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>Red Hat Enterprise Linux 8</strong></p>
<p>The YUM version 4 (based on the upstream <code>DNF</code> project)
method for removing kernels and keeping only the latest version and
running kernel:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum remove --oldinstallonly</span><br></pre></td></tr></table></figure>
<p>From the <code>yum</code> man page:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf [options] remove --oldinstallonly</span><br><span class="line">    Removes old installonly packages, keeping only latest versions and  version  of  running</span><br><span class="line">    kernel.</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/01/sampling-dft/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/01/sampling-dft/" class="post-title-link" itemprop="url">Sampling of Continuous Time Signals</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-01 01:03:18" itemprop="dateCreated datePublished" datetime="2022-05-01T01:03:18+00:00">2022-05-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/dsp/" itemprop="url" rel="index"><span itemprop="name">dsp</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>The sampling process mathematically in the two stages:</p>
<ul>
<li><p>impulse train modulator <span class="math display">\[
x_s(t)=x_c(t)s(t)
\]</span></p></li>
<li><p>impulse train to a sequence</p></li>
</ul>
<p><img src="/2022/05/01/sampling-dft/image-20230519000700841.png"
alt="image-20230519000700841" /></p>
<h2 id="impulse-train-modulator">impulse train modulator</h2>
<p><img src="/2022/05/01/sampling-dft/image-20230519000740312.png"
alt="image-20230519000740312" /></p>
<blockquote>
<p>Arrows with length proportional to their area.</p>
</blockquote>
<p>The periodic impulse train is <span class="math display">\[
s(t) = \sum_{n=-\infty}^{+\infty}\delta (t-nT)
\]</span> where <span class="math inline">\(\delta (t)\)</span> is the
<strong>unit</strong> impulse function, or Dirac delta function; <span
class="math inline">\(T\)</span> is the <em>sampling period</em>, and
its reciprocal, <span class="math inline">\(f_s=1/T\)</span>, is the
<em>sampling frequency</em>, in samples per second.</p>
<p>The product of <span class="math inline">\(s(t)\)</span> and <span
class="math inline">\(x_c (t)\)</span> is therefore</p>
<p><span class="math display">\[\begin{align}
x_s (t) &amp;= x_c(t)s(t) \\
&amp;= x_c(t) \sum_{n=-\infty}^{+\infty}\delta (t-nT) =
\sum_{n=-\infty}^{+\infty}x_c(t)\delta (t-nT)
\end{align}\]</span></p>
<p>The impulse train sampling <span
class="math inline">\(x_s(t)\)</span> can be expressed as <span
class="math display">\[
x_s(t) = \sum_{n=-\infty}^{+\infty}x_c(nT)\delta (t-nT)
\]</span> i.e., the size (area) of the <em>impulse</em> at sample time
<span class="math inline">\(nT\)</span> is equal to the value of the
continuous-time signal at that time.</p>
<h3 id="x_st-in-frequency-domain"><span
class="math inline">\(x_s(t)\)</span> in Frequency-domain</h3>
<p><span class="math display">\[
X_s(j\Omega) = \frac{1}{T}\sum_{k=-\infty}^{+\infty}X_c(j(\Omega -
k\Omega_s))
\]</span></p>
<blockquote>
<p>The relationship between the Fourier transforms of the input and the
output of the <em>impulse train modulator</em></p>
</blockquote>
<p><img src="/2022/05/01/sampling-dft/image-20230519002317865.png"
alt="image-20230519002317865" /></p>
<h2 id="impulse-train-to-a-sequence">impulse train to a sequence</h2>
<p><img src="/2022/05/01/sampling-dft/image-20230519000938294.png"
alt="image-20230519000938294" /></p>
<blockquote>
<ul>
<li><p>The <span class="math inline">\(x_s(t)\)</span> is, in a sense, a
<em>continuous-time signal (specifically, an impulse train)</em> that is
zero,except at integer multiples of <span
class="math inline">\(T\)</span>.</p></li>
<li><p>The sequence <span class="math inline">\(x[n]\)</span> is indexed
on the integer variable <span class="math inline">\(n\)</span>, which
introduces a <em>time normalization</em>, <span
class="math inline">\(x[n]\)</span> contains <strong>no</strong>
explicit information about the sampling period <span
class="math inline">\(T\)</span></p></li>
<li><p>The samples of <span class="math inline">\(x_c(t)\)</span> are
represented by <em>finite numbers</em> in <span
class="math inline">\(x[n]\)</span> rather than as the <em>areas of
impulses</em> in <span class="math inline">\(x_s(t)\)</span></p></li>
</ul>
</blockquote>
<p>Our eventual objective is to express <span
class="math inline">\(X(e^{j\omega})\)</span>, the <em>discrete-time
Fourier transform (DTFT) of the sequence <span
class="math inline">\(x[n]\)</span></em>, in terms of <span
class="math inline">\(X_s(j\Omega)\)</span> and <span
class="math inline">\(X_c(j\Omega)\)</span>.</p>
<p>Toward this end, let us consider an alternative expression for <span
class="math inline">\(X_s(j\Omega)\)</span>, Applying the
continuous-time Fourier transform to <span class="math inline">\(x_s(t)
= \sum_{n=-\infty}^{+\infty}x_c(nT)\delta (t-nT)\)</span>, we obtain
<span class="math display">\[
X_s(j\Omega) = \sum_{n=-\infty}^{+\infty}x_c(nT)e^{-j\Omega Tn}
\]</span> and <span class="math display">\[
X(e^{j\omega}) =\sum_{n=-\infty}^{+\infty}x[n]e^{-j\omega n}
\]</span> where DTFT is applied</p>
<p>Since <span class="math display">\[
x[n] = x_c(nT)
\]</span> it follows that <span class="math display">\[
X_s(j\Omega) = X(e^{j\omega})|_{\omega=\Omega T} = X(e^{j\Omega T})
\]</span> Consequently, <span class="math display">\[
X(e^{j\Omega T}) =X_s(j\Omega)=
\frac{1}{T}\sum_{k=-\infty}^{+\infty}X_c(j(\Omega - k\Omega_s))
\]</span></p>
<p>or equivalently, <span class="math display">\[
X(e^{j\omega}) = \frac{1}{T}\sum_{k=-\infty}^{+\infty}X_c \left[
j\left(\frac{\omega}{T} - \frac{2\pi k}{T}\right)\right]
\]</span></p>
<blockquote>
<p><span class="math inline">\(\omega\)</span>: radians per sample</p>
<p><span class="math inline">\(\Omega\)</span>: radians per second</p>
</blockquote>
<p>The factor <span class="math inline">\(\frac{1}{T}\)</span> in <span
class="math inline">\(X(e^{j\omega})\)</span> is misleading, actually
<span class="math inline">\(x[n]\)</span> is not scaled by <span
class="math inline">\(\frac{1}{T}\)</span> when taking <span
class="math inline">\(\omega\)</span> variable of integration into
account <span class="math display">\[\begin{align}
x_r[n] &amp;= \frac{1}{2\pi} \int_{2\pi}X(e^{j\omega})e^{j\omega
n}d\omega \\
&amp;= \frac{1}{2\pi}\int_{2\pi}\frac{1}{T}\sum_{k=-\infty}^{+\infty}X_c
\left[ j\left(\frac{\omega}{T} - \frac{2\pi k}{T}\right)\right]
e^{j\omega n}d\omega \\
&amp;\simeq \frac{1}{2\pi}\frac{1}{T}\int_{2\pi}X_c (\frac{\omega}{T} )
e^{j\omega  n} d\omega \\
&amp;=\frac{1}{2\pi} \frac{1}{T}\int_{2\pi} \left[
\int_{\infty}X_c(\Phi)\delta (\Phi - \frac{\omega}{T} )d\Phi
\right]  e^{j\omega  n} d\omega \\
&amp;=\frac{1}{2\pi} \frac{1}{T} \int_{\infty}X_c(\Phi)d\Phi
\int_{2\pi}\delta (\Phi - \frac{\omega}{T} )e^{j\omega  n} d\omega \\
&amp;=\frac{1}{2\pi} \frac{1}{T} \int_{\infty}X_c(\Phi)d\Phi
\int_{2\pi}T\cdot \delta (\Phi T - \omega )e^{j\omega  n} d\omega \\
&amp;=\frac{1}{2\pi} \int_{\infty}X_c(\Phi) e^{j\Phi T n}d\Phi
\end{align}\]</span></p>
<p>That is <span class="math display">\[\begin{align}
x_r[n] &amp;= \frac{1}{2\pi}\int_{2\pi} \frac{1}{T}X_c (\frac{\omega}{T}
) e^{j\omega  n} d\omega \\
&amp;= \frac{1}{2\pi} \int_{\infty}X_c(\Omega) e^{j\Omega T n}d\Omega
\tag{31}
\end{align}\]</span></p>
<blockquote>
<p>assuming Nyquist–Shannon sampling theorem is met</p>
</blockquote>
<p><span class="math display">\[\begin{align}
x_r[n] &amp;= \frac{1}{2\pi} \int_{\infty}X_c(\Omega) e^{j\Omega T
n}d\Omega \\
&amp;= \frac{1}{2\pi} \int_{\infty}X_c(\Omega) e^{j\Omega t}d\Omega \\
&amp;= x_c(t)
\end{align}\]</span></p>
<p>where <span class="math inline">\(t = T n\)</span>, then <span
class="math inline">\(x_r[n] = x_c(nT)\)</span></p>
<hr />
<p>Assuming <span class="math inline">\(x_c(t) = \cos(\omega_0
t)\)</span>, <span class="math inline">\(x_s(t)=
\sum_{n=-\infty}^{\infty}x_c(nT)\delta(t-nT)\)</span> and <span
class="math inline">\(x[n]=x_c(nT)\)</span>, that is <span
class="math display">\[\begin{align}
x_c(t) &amp; = \cos(\omega_0 t) \\
x_s(t) &amp;= \sum_{n=-\infty}^{\infty}\cos(\omega_0 nT)\delta(t-nT) \\
x[n] &amp;= \cos(\omega_0 nT)
\end{align}\]</span></p>
<ul>
<li><p><span class="math inline">\(X_c(j\Omega)\)</span>, the Fourier
Transform of <span class="math inline">\(x_c(t)\)</span> <span
class="math display">\[
X_c(j\Omega) = \pi[\delta(\Omega - \Omega_0) + \delta(\Omega +
\Omega_0)]
\]</span></p></li>
<li><p><span class="math inline">\(X(e^{j\omega})\)</span>​, the the
discrete-time Fourier transform (DTFT) of the sequence <span
class="math inline">\(x[n]\)</span> <span class="math display">\[
X(e^{j\omega}) =\sum_{k=-\infty}^{+\infty}\pi[\delta(\omega -
\omega_0-2\pi k) + \delta(\omega + \omega_0-2\pi k)]
\]</span></p></li>
<li><p><span class="math inline">\(X_s(j\Omega)\)</span>, the Fourier
Transform of <span class="math inline">\(x_s(t)\)</span> <span
class="math display">\[
X_s(j\Omega)= \frac{1}{T}\sum_{k=-\infty}^{+\infty}\pi[\delta(\Omega -
\Omega_0-k\Omega_s) + \delta(\Omega + \Omega_0-k\Omega_s)]
\]</span></p></li>
</ul>
<p>Express <span class="math inline">\(X(e^{j\omega})\)</span> in terms
of <span class="math inline">\(X_s(j\Omega)\)</span> and <span
class="math inline">\(X_c(j\Omega)\)</span> <span
class="math display">\[
X(e^{j\omega}) =
\frac{1}{T}\sum_{k=-\infty}^{+\infty}\pi[\delta(\frac{\omega}{T} -
\Omega_0-k\Omega_s) + \delta(\frac{\omega}{T} + \Omega_0-k\Omega_s)]
\]</span> Inverse <span class="math inline">\(X(e^{j\omega})\)</span>
<span class="math display">\[\begin{align}
x_r[n] &amp;= \frac{1}{2\pi} \int_{2\pi}X(e^{j\omega}) e^{j\omega n}
d\omega \\
&amp;= \frac{1}{2\pi}\int_{2\pi} \pi[\delta(\frac{\omega}{T} - \Omega_0)
+ \delta(\frac{\omega}{T} + \Omega_0)]e^{j\omega n} d\frac{\omega}{T} \\
&amp;= \frac{1}{2\pi}\int_{2\pi} \pi[\delta(\frac{\omega}{T} -
\Omega_0)e^{j\omega_0 n} + \delta(\frac{\omega}{T} +
\Omega_0)e^{-j\omega_0 n}] d\frac{\omega}{T} \\
&amp;= \frac{1}{2}[ e^{j\omega_0 n}\int_{2\pi} [\delta(\frac{\omega}{T}
- \Omega_0)d\frac{\omega}{T} + e^{-j\omega_0 n}\int_{2\pi}
[\delta(\frac{\omega}{T} + \Omega_0)d\frac{\omega}{T}] \\
&amp;= \frac{1}{2}[ e^{j\omega_0 n} + e^{-j\omega_0 n} ] \\
&amp;= \cos(\omega_0 n)
\end{align}\]</span></p>
<p>or follow EQ.(31)</p>
<p><span class="math display">\[\begin{align}
x_r[n] &amp;= \frac{1}{2\pi} \int_{\infty}X_c(\Omega) e^{j\Omega T
n}d\Omega \\
&amp;= \frac{1}{2\pi} \int_{\infty} \pi[\delta(\Omega - \Omega_0) +
\delta(\Omega + \Omega_0)]e^{j\Omega T n}d\Omega \\
&amp;= \frac{1}{2}(e^{j\Omega_0 T n}+e^{-j\Omega_0 T n}) \\
&amp;= \cos(\omega_0 n)
\end{align}\]</span></p>
<p>where <span class="math inline">\(\omega_0 = \Omega_0 T\)</span></p>
<hr />
<h2 id="impulse-invariance">Impulse Invariance</h2>
<p><span class="math display">\[
h[n] = Th_c(nT)
\]</span></p>
<p>When <span class="math inline">\(h[n]\)</span> and <span
class="math inline">\(h_c(t)\)</span> are related through the above
equation, i.e., the impulse response of the discrete-time system is a
<em>scaled</em>, <em>sampled</em> version of <span
class="math inline">\(h_c(t)\)</span>, the <em>discrete-time system</em>
is said to be an <strong>impulse-invariant</strong> version of the
<em>continuous-time system</em>.</p>
<p>we have <span class="math display">\[
H(e^{j\omega}) = H_c\left(j\frac{\omega}{T}\right)
\]</span></p>
<h2 id="application---transfer-function">Application - Transfer
function</h2>
<h3 id="sampled-impulse-response">sampled impulse response</h3>
<p>The below equation demonstrates how to obtain <strong>continuous
Fourier Transform</strong> from <strong>DTFT</strong> . <span
class="math display">\[
X_c(\omega) = T \cdot X(\omega)
\]</span></p>
<blockquote>
<p><span class="math inline">\(T\)</span> is sample period, follow
previous equation</p>
</blockquote>
<h3 id="useful-functions">useful functions</h3>
<ul>
<li><p>using <code>fft</code></p>
<p>The outputs of the DFT are <strong>samples</strong> of the
DTFT</p></li>
<li><p>using <code>freqz</code></p>
<p>modeling as <strong>FIR filter</strong>, and the impulse response
sequence of an FIR filter is the same as the sequence of filter
coefficients, we can express the frequency response in terms of either
the filter coefficients or the impulse response</p>
<blockquote>
<p><code>fft</code> is used in <code>freqz</code> internally</p>
</blockquote></li>
</ul>
<h3 id="practical-example">Practical Example</h3>
<p><strong>Question</strong>:</p>
<p>​ How to obtain continuous system transfer function from sampled
impulse</p>
<p><strong>Answer</strong>:</p>
<p>​ using above mentioned functions</p>
<hr />
<blockquote>
<p>First order lowpass filter with 3-dB frequency
<strong>1Hz</strong></p>
</blockquote>
<p><img src="/2022/05/01/sampling-dft/image-20220501020004068.png"
alt="image-20220501020004068" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">clear all;</span><br><span class="line">clc;</span><br><span class="line"></span><br><span class="line"><span class="comment">%% continuous system</span></span><br><span class="line">s = tf(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">h = <span class="number">2</span>*<span class="built_in">pi</span>/(<span class="number">2</span>*<span class="built_in">pi</span>+s);</span><br><span class="line">[mag, phs, wout] = bode(h);</span><br><span class="line">fct = wout(:)/<span class="number">2</span>/<span class="built_in">pi</span>;</span><br><span class="line">Hct_dB = <span class="number">20</span>*<span class="built_in">log10</span>(mag(:));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fstep = <span class="number">0.01</span>;           <span class="comment">% freq resolution</span></span><br><span class="line">fnyqst = <span class="number">100</span>;</span><br><span class="line">Ts = <span class="number">1</span>/(<span class="number">2</span>*fnyqst);</span><br><span class="line">Fs = <span class="number">1</span>/Ts;              <span class="comment">% sampling freq</span></span><br><span class="line">Ns = <span class="built_in">ceil</span>(Fs/fstep);    <span class="comment">% samping points</span></span><br><span class="line">fstep = Fs/Ns;          <span class="comment">% update fstep</span></span><br><span class="line">t = (<span class="number">0</span>:Ns<span class="number">-1</span>)*Ts;        <span class="comment">% sampling time points</span></span><br><span class="line"></span><br><span class="line">y = impulse(h, t);      <span class="comment">% impulse resp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% modelling as discrete system</span></span><br><span class="line">Y = fft(y);                 <span class="comment">% dft</span></span><br><span class="line">Hfft = Y * Ts;              <span class="comment">% !!! multiply Ts</span></span><br><span class="line">Hfft_dB = <span class="number">20</span>*<span class="built_in">log10</span>(<span class="built_in">abs</span>(Hfft(<span class="number">1</span>:Ns/<span class="number">2</span>+<span class="number">1</span>)));</span><br><span class="line">ffft = (<span class="number">1</span>:Ns/<span class="number">2</span>+<span class="number">1</span>)*fstep - fstep;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Hfir, ffir] = freqz(y, <span class="number">1</span>, [], <span class="number">1</span>/Ts);   <span class="comment">% modelling as FIR</span></span><br><span class="line">Hfir = Hfir * Ts;           <span class="comment">% !!! multiply Ts</span></span><br><span class="line">Hfir_dB = <span class="number">20</span>*<span class="built_in">log10</span>(<span class="built_in">abs</span>(Hfir));</span><br><span class="line"></span><br><span class="line"><span class="comment">%% plot</span></span><br><span class="line">semilogx(fct, Hct_dB, <span class="string">&#x27;k&#x27;</span>, ffft, Hfft_dB, <span class="string">&#x27;r.-&#x27;</span>, ffir, Hfir_dB, <span class="string">&#x27;b--&#x27;</span>);</span><br><span class="line"><span class="built_in">legend</span>(<span class="string">&#x27;bode(s)&#x27;</span>, <span class="string">&#x27;fft&#x27;</span>, <span class="string">&#x27;FIR model&#x27;</span>)</span><br><span class="line">xlabel(<span class="string">&#x27;Freq(Hz)&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;dB&#x27;</span>);</span><br><span class="line">xlim([<span class="number">1e-2</span> <span class="number">1e2</span>]);</span><br><span class="line">grid on;</span><br><span class="line">title(<span class="string">&#x27;frequency response of different methods&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="gotcha">Gotcha</h2>
<p>A remarkable fact of linear systems is that the <strong>complex
exponentials</strong> are <strong>eigenfunctions</strong> of a linear
system, as the system output to these inputs equals the input multiplied
by a constant factor.</p>
<ul>
<li>Both amplitude and phase may change</li>
<li>but the frequency does not change</li>
</ul>
<blockquote>
<p>For an input <span class="math inline">\(x(t)\)</span>, we can
determine the output through the use of the convolution integral, so
that with <span class="math inline">\(x(t) = e^{st}\)</span> <span
class="math display">\[\begin{align}
y(t) &amp;= \int_{-\infty}^{+\infty}h(\tau)x(t-\tau)d\tau \\
&amp;= \int_{-\infty}^{+\infty} h(\tau) e^{s(t-\tau)}d\tau \\
&amp;= e^{st}\int_{-\infty}^{+\infty} h(\tau) e^{-s\tau}d\tau \\
&amp;= e^{st}H(s)
\end{align}\]</span></p>
</blockquote>
<p>Take the input signal to be a complex exponential of the form <span
class="math inline">\(x(t)=Ae^{j\phi}e^{j\omega t}\)</span></p>
<p><span class="math display">\[\begin{align}
y(t) &amp;= h(t)*x(t) \\
&amp;= H(j\omega)Ae^{j\phi}e^{j\omega t}
\end{align}\]</span></p>
<p>The frequency response at <span
class="math inline">\(-\omega\)</span> is the <strong>complex
conjugate</strong> of the frequency response at <span
class="math inline">\(+\omega\)</span>, given <span
class="math inline">\(h(t)\)</span> is real</p>
<p><span class="math display">\[\begin{align}
H^*(t) &amp;= \left(\int_{-\infty}^{+\infty}h(t)e^{-j\omega
t}dt\right)^* \\
&amp;= \int_{-\infty}^{+\infty}h^*(t)e^{+j\omega t}dt \\
&amp;= \int_{-\infty}^{+\infty}h(t)e^{-j(-\omega t)}dt \\
&amp;= H(-j\omega)
\end{align}\]</span></p>
<p>The <strong>real cosine signal</strong> is actually composed of two
<strong>complex exponential signals</strong>: one with positive
frequency and the other with negative <span class="math display">\[
cos(\omega t + \phi) = \frac{e^{j(\omega t + \phi)} + e^{-j(\omega t +
\phi)}}{2}
\]</span></p>
<p>The sinusoidal response is the sum of the complex-exponential
response at the positive frequency <span
class="math inline">\(\omega\)</span> and the response at the
corresponding negative frequency <span
class="math inline">\(-\omega\)</span> because of LTI systems's
superposition property</p>
<ul>
<li><p>input: <span class="math display">\[\begin{align}
x(t) &amp;= A cos(\omega t + \phi) \\
&amp;= \frac{1}{2}Ae^{\phi}e^{\omega t} +
\frac{1}{2}Ae^{-\phi}e^{-\omega t}
\end{align}\]</span></p></li>
<li><p>output with <span
class="math inline">\(H(j\omega)=Ge^{j\theta}\)</span>: <span
class="math display">\[\begin{align}
y(t) &amp;= H(j\omega)\frac{1}{2}Ae^{\phi}e^{\omega t}
+  H(-j\omega)\frac{1}{2}Ae^{-\phi}e^{-\omega t} \\
&amp;= Ge^{j\theta}\frac{1}{2}Ae^{\phi}e^{\omega t} +
Ge^{-j\theta}\frac{1}{2}Ae^{-\phi}e^{-\omega t} \\
&amp;= GAcos(\omega t + \phi + \theta)
\end{align}\]</span></p></li>
</ul>
<p>Its phase shift is <span class="math inline">\(\theta\)</span> and
gain is <span class="math inline">\(G\)</span>, which is same with <span
class="math inline">\(H(j\omega)\)</span>.</p>
<h2 id="reference">reference</h2>
<p>James H. McClellan, Ronald Schafer, and Mark Yoder. 2015. DSP First
(2nd. ed.). Prentice Hall Press, USA.</p>
<p><a target="_blank" rel="noopener" href="https://www.mathworks.com/help/matlab/ref/fft.html">fft -
https://www.mathworks.com/help/matlab/ref/fft.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.mathworks.com/help/signal/ref/freqz.html">freqz
- https://www.mathworks.com/help/signal/ref/freqz.html</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.cs.ccu.edu.tw/~wtchu/courses/2012s_DSP/Lectures/Lecture%2026%20Frequency%20Response.pdf">Wei-Ta
Chu, 2012s_DSP - Lecture 26 Frequency Response</a></p>
<p>Relationship between continuous-time and discrete-time Fourier
transforms URL: <a
target="_blank" rel="noopener" href="https://blogs.mathworks.com/steve/2010/01/18/relationship-between-continuous-time-and-discrete-time-fourier-transforms/">https://blogs.mathworks.com/steve/2010/01/18/relationship-between-continuous-time-and-discrete-time-fourier-transforms/</a></p>
<p>Oppenheim, Alan V. and Cram. “Discrete-time signal processing : Alan
V. Oppenheim, 3rd edition.” (2011).</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/18/ps-psd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/18/ps-psd/" class="post-title-link" itemprop="url">Power Spectra and Power Spectral Densities</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-18 23:53:29" itemprop="dateCreated datePublished" datetime="2022-04-18T23:53:29+00:00">2022-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/dsp/" itemprop="url" rel="index"><span itemprop="name">dsp</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>One will see the following phenomena:</p>
<ol type="1">
<li>A power spectrum is equal to the square of the absolute value of
DFT.</li>
<li>The sum of all power spectral lines in a power spectrum is equal to
the power of the input signal.</li>
<li>The integral of a PSD is equal to the power of the input
signal.</li>
</ol>
<blockquote>
<p>power spectrum has units of <span class="math inline">\(V^2\)</span>
and power spectral density has units of <span
class="math inline">\(V^2/Hz\)</span></p>
</blockquote>
<p><strong>Parseval's theorem</strong> is a property of the Discrete
Fourier Transform (DFT) that states: <span class="math display">\[
\sum_{n=0}^{N-1}|x(n)|^2 = \frac{1}{N}\sum_{k=0}^{N-1}|X(k)|^2
\]</span> Multiply both sides of the above by <span
class="math inline">\(1/N\)</span>: <span class="math display">\[
\frac{1}{N}\sum_{n=0}^{N-1}|x(n)|^2 =
\frac{1}{N^2}\sum_{k=0}^{N-1}|X(k)|^2
\]</span> <span class="math inline">\(|x(n)|^2\)</span> is instantaneous
power of a sample of the time signal. So the left side of the equation
is just the <strong>average power</strong> of the signal over the N
samples. <span class="math display">\[
P_{\text{av}} = \frac{1}{N^2}\sum_{k=0}^{N-1}|X(k)|^2\text{,   }V^2
\]</span> For the each DFT bin, we can say: <span
class="math display">\[
P_{\text{bin}}(k) = \frac{1}{N^2}|X(k)|^2\text{,
k=0:N-1,  }V^2/\text{bin}
\]</span> This is the power spectrum of the signal.</p>
<p>Note that <span class="math inline">\(X(k)\)</span> is the
<strong>two-sided spectrum</strong>. If <span
class="math inline">\(x(n)\)</span> is real, then <span
class="math inline">\(X(k)\)</span> is symmetric about <span
class="math inline">\(fs/2\)</span>, with each side containing half of
the power. In that case, we can choose to keep just the
<strong>one-sided spectrum</strong>, and multiply Pbin by 2
(<strong>except DC &amp; Nyquist</strong>):</p>
<p><span class="math display">\[
P_{\text{bin,one-sided}}(k) = \left\{ \begin{array}{cl}
\frac{1}{N^2}|X(0)|^2 &amp; : \ k = 0 \\
\frac{2}{N^2}|X(k)|^2 &amp; : \ 1 \leq k \leq N/2-1 \\
\frac{1}{N^2}|X(N/2)|^2 &amp; : \ k = N/2
\end{array} \right.
\]</span></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rng default</span><br><span class="line">Fs = <span class="number">1000</span>;</span><br><span class="line">t = <span class="number">0</span>:<span class="number">1</span>/Fs:<span class="number">1</span><span class="number">-1</span>/Fs;</span><br><span class="line">x = <span class="built_in">cos</span>(<span class="number">2</span>*<span class="built_in">pi</span>*<span class="number">100</span>*t) + <span class="built_in">randn</span>(<span class="built_in">size</span>(t));</span><br><span class="line">N = <span class="built_in">length</span>(x);</span><br><span class="line">xdft = fft(x);</span><br><span class="line">xsq_sum_avg = sum(x.^<span class="number">2</span>)/N;</span><br><span class="line">specsq_sum_avg = sum(<span class="built_in">abs</span>(xdft).^<span class="number">2</span>)/N^<span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>where <code>xsq_sum_avg</code> is same with
<code>specsq_sum_avg</code></p>
<blockquote>
<p>For a discrete-time sequence x(n), the DFT is defined as: <span
class="math display">\[
X(k) = \sum_{n=0}^{N-1}x(n)e^{-j2\pi kn/N}
\]</span> By it definition, the DFT does <strong>NOT</strong> apply to
infinite duration signals.</p>
</blockquote>
<h2 id="scaling-dft-results">scaling DFT results</h2>
<table>
<thead>
<tr class="header">
<th>spectra type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>amplitude spectrum</td>
<td>V</td>
</tr>
<tr class="even">
<td>power spectrum</td>
<td>V^2</td>
</tr>
<tr class="odd">
<td>power spectrum density</td>
<td>V^2/Hz</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a
target="_blank" rel="noopener" href="https://appliedacousticschalmers.github.io/scaling-of-the-dft/AES2020_eBrief/">Tutorial
on Scaling of the Discrete Fourier Transform and the Implied Physical
Units of the Spectra of Time-Discrete Signals <em>Jens Ahrens, Carl
Andersson, Patrik Höstmad, Wolfgang Kropp</em></a></p>
</blockquote>
<p>Different scaling is needed to apply for amplitude spectrum, power
spectrum and power spectrum density, which shown as below</p>
<p><img src="/2022/04/18/ps-psd/image-20220427220639646.png"
alt="image-20220427220639646" /></p>
<blockquote>
<p><span class="math inline">\(f_s\)</span> in Eq.(13) is <strong>sample
rate</strong> rather than frequency resolution.</p>
</blockquote>
<p>And Eq.(13) can be expressed as <span class="math display">\[
\text{PSD}(k) =\frac{1}{f_{\text{res}}\cdot
N\sum_{n}w^2(n)}\left|X_{\omega}(k)\right|^2
\]</span> where <span class="math inline">\(f_{\text{res}}\)</span> is
frequency resolution</p>
<p>We define the following two sums for normalization purposes:</p>
<p><span class="math display">\[\begin{align}
S_1 &amp;= \sum_{j=0}^{N-1}w_j \\
S_2 &amp;= \sum_{j=0}^{N-1}w_j^2
\end{align}\]</span></p>
<p>Given Eq.(12) and Eq.(13) <span class="math display">\[\begin{align}
\text{PS(k)} &amp;= \text{PSD(k)} \cdot \frac{f_s
\sum_{n}w^2(n)}{(\sum_{n}\omega(n))^2} \\
&amp;= \text{PSD(k)} \cdot f_{\text{res}} \cdot \frac{N
\sum_{n}w^2(n)}{(\sum_{n}w(n))^2} \\
&amp;= \text{PSD(k)} \cdot f_{\text{res}} \cdot \frac{N S_2}{S_1^2} \\
&amp;= \text{PSD(k)} \cdot f_{\text{res}} \cdot \text{NENBW} \\
&amp;= \text{PSD(k)} \cdot \text{ENBW}
\end{align}\]</span></p>
<p>where <strong>Normalized Equivalent Noise BandWidth</strong> is
defined as <span class="math display">\[
\text{NENBW} =\frac{N S_2}{S_1^2}
\]</span> and <strong>Effective Noise BandWidth</strong> is <span
class="math display">\[
\text{ENBW} =f_{\text{res}} \cdot \frac{N S_2}{S_1^2}
\]</span></p>
<blockquote>
<p>For Rectangular window, <span class="math inline">\(\text{ENBW}
=f_{\text{res}}\)</span></p>
<p>This <em>equivalent noise bandwidth</em> is required when the
resulting spectrum is to be expressed as <em>spectral density (such as
for noise measurements)</em>.</p>
</blockquote>
<p><em>Eq.(13) Example:</em></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Fs = <span class="number">1024</span>; </span><br><span class="line">t  = (<span class="number">0</span>:<span class="number">1</span>/Fs:<span class="number">1</span><span class="number">-1</span>/Fs).&#x27;; </span><br><span class="line">x  = <span class="built_in">sin</span>(<span class="number">2</span>*<span class="built_in">pi</span>*t*<span class="number">200</span>);</span><br><span class="line">Nx = <span class="built_in">length</span>(x);</span><br><span class="line"><span class="comment">% Window data</span></span><br><span class="line">w = hamming(Nx);	<span class="comment">% hamming window</span></span><br><span class="line">xw = x.*w; </span><br><span class="line"><span class="comment">% Calculate power</span></span><br><span class="line">nfft = Nx; </span><br><span class="line">X = fft(xw,nfft);</span><br><span class="line"></span><br><span class="line">NumUniquePts = nfft/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">Pxx1 = <span class="built_in">abs</span>(X(<span class="number">1</span>:NumUniquePts)).^<span class="number">2</span>/sum(w.^<span class="number">2</span>)/Fs;    <span class="comment">%!!! Eq.(13)</span></span><br><span class="line">Pxx1(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>) = Pxx1(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>)*<span class="number">2</span>;    <span class="comment">% twosided -&gt; onesided</span></span><br><span class="line">Fx1 = (<span class="number">0</span>:NumUniquePts<span class="number">-1</span>)*Fs/nfft; </span><br><span class="line"></span><br><span class="line">[Pxx2,Fx2] = pwelch(x,w,<span class="number">0</span>,nfft,Fs);</span><br><span class="line"></span><br><span class="line"><span class="built_in">plot</span>(Fx1,<span class="number">10</span>*<span class="built_in">log10</span>(Pxx1),Fx2,<span class="number">10</span>*<span class="built_in">log10</span>(Pxx2),<span class="string">&#x27;r--&#x27;</span>);</span><br><span class="line"><span class="built_in">legend</span>(<span class="string">&#x27;PSD via Eq.(13)&#x27;</span>,<span class="string">&#x27;PSD via pwelch&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/18/ps-psd/image-20220514165525958.png"
alt="image-20220514165525958" /></p>
<h2 id="window-effects">window effects</h2>
<p>It is possible to correct both the amplitude and energy content of
the windowed signal to equal the original signal. However, both
corrections cannot be applied simultaneously</p>
<h3 id="amplitude-correction">Amplitude correction</h3>
<p><em>Linear (amplitude) Spectrum</em> <span class="math display">\[
X(k) = \frac{X_{\omega}(k)}{S_1}
\]</span> <em>power spectrum</em> <span class="math display">\[
\text{PS}=\frac{\left| X_{\omega}(k) \right|^2}{S_1^2}
\]</span></p>
<blockquote>
<p>usage: tone amplitude</p>
</blockquote>
<h3 id="power-correction">Power correction</h3>
<p><strong>power spectral density (PSD)</strong> <span
class="math display">\[
\text{PSD} =\frac{\left|X_{\omega}(k)\right|^2}{f_s\cdot S_2}
\]</span></p>
<blockquote>
<p>We have <span class="math inline">\(\text{PSD} =
\frac{\text{PS}}{\text{ENBW}}\)</span>, where <span
class="math inline">\(\text{ENBW}=\frac{N \cdot
S_2}{S_1^2}f_{\text{res}}\)</span></p>
</blockquote>
<p><strong>linear power spectrum</strong> <span class="math display">\[
\text{PS}_L=\frac{|X_{\omega}(k)|^2}{N\cdot S_2}
\]</span></p>
<blockquote>
<p>usage: RMS value, total power <span class="math display">\[
\text{PS}_L(k)=\text{PSD(k)} \cdot f_{\text{res}}
\]</span></p>
</blockquote>
<h3 id="window-correction-factors">Window Correction Factors</h3>
<p>While a window helps reduce leakage (The window reduces the jumps at
the ends of the repeated signal), the window itself distorts the data in
two different ways:</p>
<ul>
<li><p><strong>Amplitude</strong> – The <em>amplitude</em> of the signal
is reduced</p>
<blockquote>
<p>This is due to the fact that the window removes information in the
signal</p>
</blockquote></li>
<li><p><strong>Energy</strong> – The <em>area</em> under the curve, or
energy of the signal, is reduced</p></li>
</ul>
<p><img src="/2022/04/18/ps-psd/rtaImage.png" alt="rtaImage" /></p>
<p><strong>Window correction factors</strong> are used to try and
compensate for the effects of applying a window to data. There are both
amplitude and energy correction factors.</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 43%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="header">
<th>Window Type</th>
<th>Amplitude Correction (<span class="math inline">\(K_a\)</span>)</th>
<th>Energy Correction (<span class="math inline">\(K_e\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rectangluar</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>hann</td>
<td>1.9922</td>
<td>1.6298</td>
</tr>
<tr class="odd">
<td>blackman</td>
<td>2.3903</td>
<td>1.8155</td>
</tr>
<tr class="even">
<td>kaiser</td>
<td>1.0206</td>
<td>1.0204</td>
</tr>
</tbody>
</table>
<p>Only the Uniform window (rectangular window), which is equivalent to
no window, has the same amplitude and energy correction factors.</p>
<p><span class="math display">\[\begin{align}
X(k) &amp;= \frac{X_\omega(k)}{\sum_n w(n)} \\
&amp;= \frac{N}{\sum_n w(n)} \frac{X_\omega(k)}{N} \\
&amp;= K_a \cdot \frac{X_\omega(k)}{N}
\end{align}\]</span> where <span class="math inline">\(K_a =
\frac{N}{\sum_n \omega(n)}\)</span></p>
<blockquote>
<p>In literature, <strong>Coherent power gain</strong> is defined show
below, which is close related to <span
class="math inline">\(K_a\)</span> <span class="math display">\[
\text{Coherent power gain (dB)} = 20 \; log_{10} \left( \frac{\sum_n
w[n]}{N} \right)
\]</span></p>
</blockquote>
<p><img src="/2022/04/18/ps-psd/amplitude-correction.png"
alt="amplitude-correction" /></p>
<blockquote>
<p>With amplitude correction, by multiplying by two, the <em>peak
value</em> of both the original and corrected spectrum match. However
the energy content is not the same.</p>
<p>The amplitude corrected signal (red) appears to have more energy, or
area under the curve, than the original signal (blue).</p>
</blockquote>
<p><span class="math display">\[\begin{align}
\text{PSD} &amp;=\frac{1}{f_{\text{res}}\cdot
N\sum_{n}w^2(n)}\left|X_{\omega}(K)\right|^2 \\
&amp;= \frac{N}{\sum_{n}w^2(n)}
\frac{\left|X_{\omega}(K)\right|^2}{f_{\text{res}}\cdot N^2} \\
&amp;=\left|K_e \cdot \frac{X_{\omega}(K)}{N}\right|^2 \cdot
\frac{1}{f_{\text{res}}}
\end{align}\]</span></p>
<p>wherer <span class="math inline">\(K_e =
\sqrt{\frac{N}{\sum_{n}\omega^2(n)}}\)</span></p>
<p><img src="/2022/04/18/ps-psd/energey-correction.png"
alt="energey-correction" /></p>
<blockquote>
<p>Multiplying the values in the spectrum by 1.63, rather than 2, makes
the <em>area</em> under the curve the same for both the original signal
(blue) and energy corrected signal (red)</p>
</blockquote>
<p><strong>hanning</strong>'s correction factors:</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">256</span>;</span><br><span class="line">w = hanning(N);</span><br><span class="line">Ka = N/sum(w)</span><br><span class="line">Ke = <span class="built_in">sqrt</span>(N/sum(w.^<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Ka =</span><br><span class="line"></span><br><span class="line">    1.9922</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ke =</span><br><span class="line"></span><br><span class="line">    1.6298</span><br></pre></td></tr></table></figure>
<h3 id="amplitudepower-correction-example">Amplitude,Power Correction
Example</h3>
<p><img src="/2022/04/18/ps-psd/image-20220518002927545.png"
alt="image-20220518002927545" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 200 Hz, amplitude 1 and 200/3 Hz amplitude 0.3</span></span><br><span class="line">fosc = <span class="number">200</span>;</span><br><span class="line">Fs = <span class="number">8192</span>;</span><br><span class="line">Nx = Fs*<span class="number">4</span>;</span><br><span class="line">tstop = Nx/Fs;</span><br><span class="line">t  = (<span class="number">0</span>:<span class="number">1</span>/Fs:tstop<span class="number">-1</span>/Fs).&#x27;; </span><br><span class="line">x  = <span class="built_in">sin</span>(<span class="number">2</span>*<span class="built_in">pi</span>*t*fosc) + <span class="number">0.3</span>*<span class="built_in">sin</span>(<span class="number">2</span>*<span class="built_in">pi</span>*t*fosc/<span class="number">3</span>);</span><br><span class="line">Nx = <span class="built_in">length</span>(x);</span><br><span class="line"></span><br><span class="line"><span class="comment">%% direct method, time domain</span></span><br><span class="line">P0 = sum(x.^<span class="number">2</span>)/Nx;</span><br><span class="line">xrms0 = <span class="built_in">sqrt</span>(P0);   <span class="comment">% RMS value caculated by time domain</span></span><br><span class="line">fprintf(<span class="string">&quot;xrms0: %.4f\n&quot;</span>, xrms0);</span><br><span class="line"></span><br><span class="line"><span class="comment">%% Window data</span></span><br><span class="line">w = hamming(Nx);	<span class="comment">% hamming window</span></span><br><span class="line"><span class="comment">%w = ones(Nx, 1);	% rectangular window</span></span><br><span class="line"></span><br><span class="line">S1= sum(w);</span><br><span class="line">S2 = sum(w.^<span class="number">2</span>);</span><br><span class="line">NENBW = Nx*S2/S1^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">xw = x.*w; </span><br><span class="line">nfft = Nx; </span><br><span class="line">X = fft(xw,nfft);   <span class="comment">% windowed signal fft</span></span><br><span class="line">NumUniquePts = nfft/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">Fx1 = (<span class="number">0</span>:NumUniquePts<span class="number">-1</span>)*Fs/nfft;</span><br><span class="line"></span><br><span class="line"><span class="comment">%% fft - ps -&gt; rms</span></span><br><span class="line">Xmag = <span class="built_in">abs</span>(X);</span><br><span class="line">PS1 = Xmag.^<span class="number">2</span>/S1^<span class="number">2</span>;    <span class="comment">%!!! Eq.(12)</span></span><br><span class="line">PS1 = PS1(<span class="number">1</span>:NumUniquePts);</span><br><span class="line">PS1(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>) = PS1(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>)*<span class="number">2</span>;    <span class="comment">% twosided -&gt; onesided</span></span><br><span class="line">Pmax_fft = <span class="built_in">max</span>(PS1);    <span class="comment">% !!! amplitude OK</span></span><br><span class="line">fprintf(<span class="string">&quot;Pmax_fft: %.4f\n&quot;</span>, Pmax_fft);</span><br><span class="line"></span><br><span class="line"><span class="comment">% linear power spectrum</span></span><br><span class="line">PSL_fft = Xmag.^<span class="number">2</span>/nfft/S2;</span><br><span class="line">PSL_fft = PSL_fft(<span class="number">1</span>:NumUniquePts);</span><br><span class="line">PSL_fft = PSL_fft(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>)*<span class="number">2</span>;</span><br><span class="line">Ptot_fft1 = sum(PSL_fft);</span><br><span class="line">xrms_PSL = <span class="built_in">sqrt</span>(Ptot_fft1); <span class="comment">% !!! power OK</span></span><br><span class="line">fprintf(<span class="string">&quot;xrms_PSL: %.4f\n&quot;</span>, xrms_PSL);</span><br><span class="line"></span><br><span class="line"><span class="comment">% use psd*fres to calculate total power</span></span><br><span class="line">Pxx1 = <span class="built_in">abs</span>(X(<span class="number">1</span>:NumUniquePts)).^<span class="number">2</span>/sum(w.^<span class="number">2</span>)/Fs;    <span class="comment">%!!! Eq.(13)</span></span><br><span class="line">Pxx1(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>) = Pxx1(<span class="number">2</span>:<span class="keyword">end</span><span class="number">-1</span>)*<span class="number">2</span>;    <span class="comment">% twosided -&gt; onesided</span></span><br><span class="line">Ptot_fft2 = sum(Pxx1*Fs/nfft);</span><br><span class="line">xrms_psd = <span class="built_in">sqrt</span>(Ptot_fft2);     <span class="comment">% !!! power OK</span></span><br><span class="line">fprintf(<span class="string">&quot;xrms_psd: %.4f\n&quot;</span>, xrms_psd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">%% pwelch</span></span><br><span class="line">[Pxx2,Fx2] = pwelch(x,w,<span class="number">0</span>,nfft,Fs);</span><br><span class="line">fres = Fx2(<span class="number">2</span>)-Fx2(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">PS2 = Pxx2*fres;</span><br><span class="line">Ptot_pwelch = sum(PS2);</span><br><span class="line">xrms_pwelch = <span class="built_in">sqrt</span>(Ptot_pwelch);    <span class="comment">% !!! amplitude OK</span></span><br><span class="line">fprintf(<span class="string">&quot;xrms_pwelch: %.4f\n&quot;</span>, xrms_pwelch);</span><br><span class="line"></span><br><span class="line"><span class="comment">% PS = PSD * ENBW always hold</span></span><br><span class="line">ENBW = fres * NENBW;</span><br><span class="line">PS2_pwelch = Pxx2*ENBW;</span><br><span class="line">Pmax_pwelch = <span class="built_in">max</span>(PS2_pwelch);  <span class="comment">% !!! amplitude OK</span></span><br><span class="line">fprintf(<span class="string">&quot;Pmax_pwelch: %.4f\n&quot;</span>, Pmax_pwelch);</span><br><span class="line"></span><br><span class="line"><span class="comment">%% plot psd of two methods</span></span><br><span class="line"><span class="built_in">plot</span>(Fx1,<span class="number">10</span>*<span class="built_in">log10</span>(Pxx1),Fx2,<span class="number">10</span>*<span class="built_in">log10</span>(Pxx2),<span class="string">&#x27;r--&#x27;</span>);</span><br><span class="line"><span class="built_in">legend</span>(<span class="string">&#x27;PSD via Eq.(13)&#x27;</span>,<span class="string">&#x27;PSD via pwelch&#x27;</span>)</span><br><span class="line">grid on;</span><br><span class="line">xlabel(<span class="string">&#x27;Freq (Hz)&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;dB; V^2/Hz&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xrms0: 0.7383</span><br><span class="line">Pmax_fft: 0.5000</span><br><span class="line">xrms_PSL: 0.7382</span><br><span class="line">xrms_psd: 0.7382</span><br><span class="line">xrms_pwelch: 0.7382</span><br><span class="line">Pmax_pwelch: 0.5000</span><br></pre></td></tr></table></figure>
<h2 id="rms">RMS</h2>
<p>We may also want to know for example the RMS value of the signal, in
order to know how much power the signal generates. This can be done
using Parseval’s theorem.</p>
<p>For a <strong>periodic</strong> signal, which has a discrete
spectrum, we obtain its total RMS value by summing the included signals
using <span class="math display">\[
x_{\text{rms}}=\sqrt{\sum R_{xk}^2}
\]</span> Where <span class="math inline">\(R_{xk}\)</span> is the RMS
value of each sinusoid for <span
class="math inline">\(k=1,2,3,...\)</span> The RMS value of a signal
consisting of a number of sinusoids is consequently equal to <strong>the
square root of the sum of the RMS values</strong>.</p>
<p>This result could also be explained by noting that sinusoids of
different frequencies are <strong>orthogonal</strong>, and can therefore
be summed like vectors (using <em>Pythagoras’ theorem</em>)</p>
<p>For a random signal we cannot interpret the spectrum in the same way.
As we have stated earlier, the PSD of a random signal contains all
frequencies in a particular frequency band, which makes it
<em>impossible to add the frequencies up</em>. Instead, as the PSD is a
density function, the correct interpretation is to sum the area under
the PSD in a specific frequency range, which then is the square of the
RMS, i.e., the mean-square value of the signal <span
class="math display">\[
x_{\text{rms}}=\sqrt{\int G_{xx}(f)df}=\sqrt{\text{area under the
curve}}
\]</span> The <strong>linear spectrum</strong>, or <strong>RMS
spectrum</strong>, defined by <span class="math display">\[\begin{align}
X_L(k) &amp;= \sqrt{\text{PSD(k)} \cdot f_{\text{res}}}\\
&amp;=\sqrt{\frac{\left|X_{\omega}(k)\right|^2}{f_{\text{res}}\cdot
N\sum_{n}\omega^2(n)} \cdot f_{\text{res}}} \\
&amp;= \sqrt{\frac{\left|X_{\omega}(k)\right|^2}{N\sum_{n}\omega^2(n)}}
\\
&amp;= \sqrt{\frac{|X_{\omega}(k)|^2}{N\cdot S_2}}
\end{align}\]</span></p>
<p>The corresponding <strong>linear power spectrum</strong> or
<strong>RMS power spectrum</strong> can be defined by <span
class="math display">\[\begin{align}
\text{PS}_L(k)&amp;=X_L(k)^2=\frac{|X_{\omega}(k)|^2}{S_1^2}\frac{S_1^2}{N\cdot
S_2} \\
&amp;=\text{PS}(k) \cdot \frac{S_1^2}{N\cdot S_2}
\end{align}\]</span></p>
<p>So, RMS can be calculated as below <span
class="math display">\[\begin{align}
P_{\text{tot}} &amp;= \sum \text{PS}_L(k) \\
\text{RMS} &amp;= \sqrt{P_{\text{tot}}}
\end{align}\]</span></p>
<h2 id="dft-averaging">DFT averaging</h2>
<p>we use <span class="math inline">\(N= 8*\text{nfft}\)</span> time
samples of <span class="math inline">\(x\)</span> and set the number of
overlapping samples to <span class="math inline">\(\text{nfft}/2 =
512\)</span>. <code>pwelch</code> takes the DFT of <span
class="math inline">\(\text{Navg} = 15\)</span> overlapping segments of
<span class="math inline">\(x\)</span>, each of length <span
class="math inline">\(\text{nfft}\)</span>, then averages the <span
class="math inline">\(|X(k)|^2\)</span> of the DFT’s.</p>
<p>In general, if there are an integer number of segments that cover all
samples of N, we have <span class="math display">\[
N = (N_{\text{avg}}-1)*D + \text{nfft}
\]</span> where <span
class="math inline">\(D=\text{nfft}-\text{noverlap}\)</span>. For our
case, with <span class="math inline">\(D = \text{nfft}/2\)</span> and
<span class="math inline">\(N/\text{nfft} = 8\)</span>, we have <span
class="math display">\[
N_{\text{avg}}=2*N/\text{nfft}-1=15
\]</span> For a given number of time samples N, using overlapping
segments lets us increase <span class="math inline">\(N_{avg}\)</span>
compared with no overlapping. In this case, overlapping of 50% increases
<span class="math inline">\(N_{avg}\)</span> from 8 to 15. Here is the
Matlab code to compute the spectrum:</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nfft= <span class="number">1024</span>;</span><br><span class="line">N= nfft*<span class="number">8</span>;                                <span class="comment">% number of samples in signal</span></span><br><span class="line">n= <span class="number">0</span>:N<span class="number">-1</span>;</span><br><span class="line">x= A*<span class="built_in">sin</span>(<span class="number">2</span>*<span class="built_in">pi</span>*f0*n*Ts) + <span class="number">.1</span>*<span class="built_in">randn</span>(<span class="number">1</span>,N);   <span class="comment">% 1 W sinewave + noise</span></span><br><span class="line">noverlap= nfft/<span class="number">2</span>;                         <span class="comment">% number of overlapping time samples</span></span><br><span class="line">window= hanning(nfft);</span><br><span class="line">[pxx,f]= pwelch(x,window,noverlap,nfft,fs);  <span class="comment">% W/Hz  PSD</span></span><br><span class="line">PdB_bin= <span class="number">10</span>*<span class="built_in">log10</span>(pxx*fs/nfft);              <span class="comment">% dBW/bin</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/18/ps-psd/figure%203_99153.png"
alt="figure 3_99153" /></p>
<blockquote>
<p><strong>DFT averaging</strong> reduces the variance <span
class="math inline">\(\sigma^2\)</span> of the noise spectrum by a
factor of <span class="math inline">\(N_{avg}\)</span>, as long as
<code>noverlap</code> is not greater than <code>nfft/2</code></p>
</blockquote>
<p><img src="/2022/04/18/ps-psd/image-20220420013255660.png"
alt="image-20220420013255660" /></p>
<p><img src="/2022/04/18/ps-psd/image-20230526011628682.png"
alt="image-20230526011628682" /></p>
<h2 id="fftshift">fftshift</h2>
<p>The result of <code>fft</code> and its index is shown as below</p>
<p><img src="/2022/04/18/ps-psd/complexDFT_Matlab_index.png"
alt="complexDFT_Matlab_index" /></p>
<p>After <code>fftshift</code></p>
<p><img src="/2022/04/18/ps-psd/FFTshift_Matlab_index_resolved.png"
alt="FFTshift_Matlab_index_resolved" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; fftshift([<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line"></span><br><span class="line">     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h2 id="dft-and-psd-function-in-virtuoso"><code>dft</code> and
<code>psd</code> function in virtuoso</h2>
<ul>
<li><p><code>dft</code> always return</p>
<p><img src="/2022/04/18/ps-psd/image-20230525011604685.png"
alt="image-20230525011604685" /></p></li>
</ul>
<p>To compensate windowing effect, <span
class="math inline">\(W(n)\)</span>, the <code>dft</code> output should
be multiplied by <span class="math inline">\(K_a\)</span>, e.g. 1.9922
for hanning window.</p>
<ul>
<li><code>psd</code> function has taken into account <span
class="math inline">\(K_e\)</span>, postprocessing is
<strong>not</strong> needed</li>
</ul>
<h2 id="reference">reference</h2>
<p><a
target="_blank" rel="noopener" href="https://github.com/liangsizhuang/Demonstration-DFT-PS-PSD">Demonstration-DFT-PS-PSD</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.mathworks.com/help/signal/ug/power-spectral-density-estimates-using-fft.html">mathworks,
Power Spectral Density Estimates Using FFT</a></p>
<p>Lyons, Richard, “Widowing Functions Improve FFT Results”, EDN, June
1, 1998. <a
target="_blank" rel="noopener" href="https://www.edn.com/electronics-news/4383713/Windowing-Functions-Improve-FFT-Results-Part-I">https://www.edn.com/electronics-news/4383713/Windowing-Functions-Improve-FFT-Results-Part-I</a></p>
<p>Rapuano, Sergio, and Harris, Fred J., An Introduction to FFT and Time
Domain Windows, IEEE Instrumentation and Measurement Magazine, December,
2007. <a
target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/4428580">https://ieeexplore.ieee.org/document/4428580</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dsprelated.com/showarticle/1004.php">Neil
Robertson, The Power Spectrum</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dsprelated.com/showarticle/1221.php">Neil
Robertson, Use Matlab Function pwelch to Find Power Spectral Density –
or Do It Yourself</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dsprelated.com/showarticle/1211.php">Neil
Robertson, Evaluate Window Functions for the Discrete Fourier
Transform</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.gaussianwaves.com/2015/11/interpreting-fft-results-complex-dft-frequency-bins-and-fftshift/">Mathuranathan
Viswanathan, Interpret FFT, complex DFT, frequency bins &amp;
FFTShift</a></p>
<p><a target="_blank" rel="noopener" href="https://dsp.stackexchange.com/a/47603/59253">robert
bristow-johnson, Does windowing affect Parseval's theorem?</a></p>
<p>Heinzel, Gerhard, A. O. Rüdiger and Roland Schilling. "Spectrum and
spectral density estimation by the Discrete Fourier transform (DFT),
including a comprehensive list of window functions and some new at-top
windows." (2002). URL: <a
target="_blank" rel="noopener" href="https://holometer.fnal.gov/GH_FFT.pdf">https://holometer.fnal.gov/GH_FFT.pdf</a></p>
<p>Window Correction Factors URL: <a
target="_blank" rel="noopener" href="https://community.sw.siemens.com/s/article/window-correction-factors">https://community.sw.siemens.com/s/article/window-correction-factors</a></p>
<p>Brandt, A, 2011. Noise and vibration analysis: signal analysis and
experimental procedures. John Wiley &amp; Sons</p>
<p>What should be the correct scaling for PSD calculation using fft.
URL:<a
target="_blank" rel="noopener" href="https://dsp.stackexchange.com/a/32205">https://dsp.stackexchange.com/a/32205</a></p>
<p>POWER SPECTRAL DENSITY CALCULATION VIA MATLAB Revision C. URL: <a
target="_blank" rel="noopener" href="http://www.vibrationdata.com/tutorials_alt/psd_mat.pdf">http://www.vibrationdata.com/tutorials_alt/psd_mat.pdf</a></p>
<p>Jens Ahrens, Carl Andersson, Patrik Höstmad, Wolfgang Kropp,
“Tutorial on Scaling of the Discrete Fourier Transform and the Implied
Physical Units of the Spectra of Time-Discrete Signals” in 148th
Convention of the AES, e-Brief 56, May 2020 [ <a
target="_blank" rel="noopener" href="http://www.soundfieldsynthesis.org/wp-content/uploads/pubs/Ahrens_etal_AES2020.pdf">pdf</a>,
<a
target="_blank" rel="noopener" href="https://appliedacousticschalmers.github.io/scaling-of-the-dft/AES2020_eBrief/">web</a>
].</p>
<p>Manolakis, D., &amp; Ingle, V. (2011). <em>Applied Digital Signal
Processing: Theory and Practice</em>. Cambridge: Cambridge University
Press. doi:10.1017/CBO9780511835261</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/15/dspf-saveopt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/15/dspf-saveopt/" class="post-title-link" itemprop="url">How to Save Node in DSPF?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-15 18:23:40" itemprop="dateCreated datePublished" datetime="2022-04-15T18:23:40+00:00">2022-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cad/" itemprop="url" rel="index"><span itemprop="name">cad</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="dspf-semantics">DSPF Semantics</h2>
<p><code>*|DIVIDER &lt;divider&gt;</code></p>
<p><code>&lt;divider&gt;</code> represents the hierarchical pathname
divider. The default hierarchical character is forward slash
(<strong>/</strong>).</p>
<p><code>*|DELIMITER &lt;delimiter&gt;</code></p>
<ul>
<li><code>&lt;delimiter&gt;</code> represents the delimiter character
used to concatenate an instance name and pin name to form an instance
pin name.</li>
<li>It is also represents the delimiter character used to concatenate a
net name and subnode number to form a subnode name. The default
character is colon (<strong>:</strong>)</li>
</ul>
<p><code>*|BUSBIT &lt;left_busbit_char&gt;&lt;right_busbit_char&gt;</code></p>
<p><code>&lt;left_busbit_char&gt;</code> and
<code>&lt;right_busbit_char&gt;</code> are used at the end of an
identifier of an array to select a single object of the array.</p>
<p>Objects which may be indexed include <em>nets, primary pins, and
instance pins</em></p>
<p><code>*|NET &lt;netName&gt; &lt;netCap&gt;</code></p>
<ul>
<li><code>&lt;netName&gt;</code> represents the name of a net. It can be
a user-provided net name, the name of the driving pin, or the name of
the driving instance pin.</li>
<li><code>&lt;netCap&gt;</code> represents the <strong>total</strong>
capacitance value in farads associated with the net. This may be
comprised of capacitances to ground and capacitances to nearby
wires.</li>
</ul>
<p><code>*|P &lt;pinName&gt; &lt;pinType&gt; &lt;pinCap&gt; &#123;&lt;coord&gt;&#125;</code></p>
<ul>
<li><code>&lt;pinName&gt;</code> represents the name of the pin.</li>
<li><code>&lt;pinType&gt;</code> represents the type of the pin. It can
be any of the following: <em>I (Input), O (Output), B (Bidirectional), X
(don’t care), S (Switch), and J (Jumper)</em>.</li>
<li><code>&lt;pinCap&gt;</code> represents the capacitance value
associated with the pin.</li>
<li><code>&lt;coord&gt;</code> is optional. It represents the location
of the pin. Multiple pin locations are allowed.</li>
</ul>
<p><code>*|S &lt;subNodeName&gt; &#123;&lt;coord&gt;&#125;</code></p>
<p>subnodes in the net</p>
<ul>
<li><code>&lt;subNodeName&gt;</code> represents the name of the subnode.
A subnode name is obtained by concatenating the net name and a subnode
number using the delimiter specified in the DELIMITER statement. The
default delimiter is colon (:).</li>
<li><code>&lt;coord&gt;</code> represents the location of the
subnode.</li>
</ul>
<p><code>*|I &lt;instPinName&gt; &lt;instName&gt; &lt;pinName&gt; &lt;pinType&gt;&lt;pinCap&gt; &#123;&lt;coord&gt;?&#125;</code></p>
<p>describes instance pins in the net</p>
<ul>
<li><code>&lt;instPinName&gt;</code> represents the name of the instance
pin. An instance pin name is obtained by concatenating the
<code>&lt;instName&gt;</code> and the <code>&lt;pinName&gt;</code> with
a delimiting character which is specified by the DELIMITER
statement</li>
<li><code>&lt;instName&gt;</code> represents the name of the
instance</li>
</ul>
<p><code>*|DeviceFingerDelim "@"</code></p>
<p>MOS finger delimiter</p>
<p>For example, <code>M8</code>'s finger is 4, then split into 4 Devices
in DSPF</p>
<blockquote>
<p><code>MM8</code>, <code>MM8@2</code>, <code>MM8@3</code>,
<code>MM8@4</code></p>
</blockquote>
<p>its drain terminal will be</p>
<blockquote>
<p><code>MM8:d</code>, <code>MM8@2:d</code>, <code>MM8@3:d</code>,
<code>MM8@4:d</code></p>
</blockquote>
<h3 id="dspf-syntax">DSPF Syntax</h3>
<p>DSPF has two sections:</p>
<ul>
<li><p>a <strong>net section</strong></p>
<p>The net section consists of a series of net description blocks. Each
net description block corresponds to a net in the physical design. A net
description block begins with a net statement followed by pins, instance
pins, subnodes, and parasitic resistor/capacitor
(<code>R</code>/<code>C</code>) components that characterize the
electrical behavior of the net.</p></li>
<li><p>an <strong>instance section</strong></p>
<p>The instance section consists of a series of SPICE instance
statements. SPICE instance statements begin with an
<code>X</code>.</p></li>
</ul>
<p>Each file consists of hierarchical cells and interconnects only.</p>
<p>The DSPF format is as generic and as much like SPICE as possible.
While native SPICE statements describe the R/C sections, some non-native
SPICE statements complete the net descriptions. These non-native SPICE
statements start with the notation "*|" to differentiate them from
native SPICE statements. For native SPICE statements, a continuation
line begins with the conventional "+" sign in the first column.</p>
<p>The native SPICE statements used by the DSPF format are listed
below:</p>
<ul>
<li><code>.SUBCKT</code> represents a subcircuit statement.</li>
<li><code>.ENDS</code> represents the end of a subcircuit
statement.</li>
<li><code>R</code> represents a resistor element.</li>
<li><code>C</code> represents a capacitor element.</li>
<li><code>E</code> represents a voltage-controlled voltage sources
element.</li>
<li><code>X</code> represents an instance of a cell;</li>
<li><code>*</code> represents a comment line unless it is
<code>*|</code> or <code>*+</code>.</li>
<li><code>.END</code> is an optional statement that represents the end
of a simulation session</li>
</ul>
<h2 id="spectre-netlist">spectre netlist</h2>
<p><code>hier_delimiter="."</code></p>
<p>Used to set hierarchical delimiter. Length of
<code>hier_delimiter</code> should not be longer than 1, except the
leader escape character</p>
<p><code>spfbusdelim = busdelim_schematic [busdelim_parasitic]</code></p>
<p>This option maps the bus delimiter between schematic netlist and
parasitic file (i.e. DSPF, SPEF, or DPF). The option defines the bus
delimiter in the schematic netlist, and optionally the bus delimiter in
the parasitic file. By default, the bus delimiter of the parasitic file
is taken from the parasitic file header (i.e. <em>|BUSBIT [],
</em>|BUS_BIT [], or *|BUS_DELIMITER []). If the bus delimiter is not
defined in the parasitic file header, you need to specify it by using
the spfbusdelim option in schematic netlist.</p>
<blockquote>
<p>Exampel</p>
<ul>
<li>spfbusdelim=&lt;&gt; - A&lt;1&gt; in the schematic netlist is mapped
to A_1 in the DSPF file, if the bus delimiter header in the DSPF file is
"_".</li>
<li>spfbusdelim=@ [] - A@1 in the schematic netlist is mapped to to A[1]
in the DSPF file (the bus delimiter in DSPF header will be
ignored).</li>
</ul>
</blockquote>
<h2 id="how-to-save-net-voltage-in-dspf">How to Save Net voltage in
DSPF</h2>
<blockquote>
<p>!!! follow the name of net section in DSPF - prepend to top-level
devices in the schematic with <code>X</code></p>
</blockquote>
<p><img src="/2022/04/15/dspf-saveopt/hierbench.drawio.svg"
alt="hierbench.drawio" /></p>
<p>Assume node n1...n4 are named as below in DSPF file (prefix
<code>X</code>)</p>
<blockquote>
<ul>
<li><p>n1</p>
<p>XXosc/zip:1</p></li>
<li><p>n2</p>
<p>XXosc/zip:2</p></li>
<li><p>n3</p>
<p>XXosc/zip:3</p></li>
<li><p>n4</p>
<p>XXosc/zip:4</p></li>
</ul>
</blockquote>
<p>To save these nodes, you can add follow code in <em>Definition
Files</em></p>
<p><em>saveopt.scs</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">save Xwrapper.Xvco.XXosc\/zip\:1</span><br><span class="line">save Xwrapper.Xvco.XXosc\/zip\:2</span><br><span class="line">save Xwrapper.Xvco.XXosc\/zip\:3</span><br><span class="line">save Xwrapper.Xvco.XXosc\/zip\:4</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>Escape character <code>\</code> is used for hierarchical pathname
divider <code>/</code> and subnode <code>:</code></p></li>
<li><p>By the way, <code>.</code> is hierarchical delimiter of
Spectre</p></li>
<li><p>Calibre always prepend one <strong>X</strong> to instance name of
schematic in generated DSPF file</p></li>
<li><p>The DSPF design is <em>flatten</em>, the DIVIDER character
indicate the hierarchy</p></li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save Xwrapper.Xvco.XXosc\/zip</span><br></pre></td></tr></table></figure>
<p>The above save voltage, however I'm NOT sure which node it save.</p>
<p>To avoid this unsure problem, the MOS terminal may be better choice
to save.</p>
<p>But keep in mind</p>
<ul>
<li>OD resistance is lumped in the FEOL model</li>
<li>M0OD and above layer resistances are extracted by RC tool</li>
</ul>
<h2 id="how-to-save-current-in-dspf">How to Save Current in DSPF</h2>
<blockquote>
<p>!!! follow the name of instance section of DSPF - prepend to
top-level devices in the schematic with <code>XX</code></p>
</blockquote>
<p>MOS in schematic: <code>Xsupply.M4</code></p>
<p>MOS related information in DSPF (prefix <code>XX</code> in instance
section):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">// net section</span><br><span class="line">*|I XXsupply/MM4:d XXsupply/MM4 d B 0.0 </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">//instance section</span><br><span class="line">XXXsupply/MM4 XXsupply/MM4:d XXsupply/MM4:g XXsupply/MM4:s XXsupply/MM4:b pch_svt_mac</span><br><span class="line">+ L=... W=... nfin=...</span><br><span class="line">+ ...</span><br></pre></td></tr></table></figure>
<p>To save drain current:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save Xvco.XXXsupply\/MM4:d</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>&lt;instName&gt;</code> in
<code>*|I &lt;instPinName&gt; &lt;instName&gt; &lt;pinName&gt; &lt;pinType&gt;&lt;pinCap&gt; &#123;&lt;coord&gt;?&#125;</code>
which has prefix <code>X</code> corresponding to schematic is
<strong>NOT </strong> the instance name in DSPF. The instance name is in
<strong>instance section</strong> and has prefix <code>XX</code></p>
</blockquote>
<p><img src="/2022/04/15/dspf-saveopt/image-20220417010807592.png"
alt="image-20220417010807592" /></p>
<p><img src="/2022/04/15/dspf-saveopt/image-20220417010919588.png"
alt="image-20220417010919588" /></p>
<blockquote>
<p>!!! Only work for MOS terminal current. Fail to apply to block
pin</p>
</blockquote>
<h2 id="thinking-about-voltage-and-current-save">Thinking about voltage
and current save</h2>
<ul>
<li>MOS device always prepend with <code>M</code></li>
<li>To save <strong>net voltage</strong>, take account of the prefix
<code>X</code> of top-level device</li>
<li>To save <strong>MOS terminal</strong>, take account of the prefix
<code>XX</code> of top-level device</li>
</ul>
<blockquote>
<p>Post-layout netlists are created by layout extraction tools - Mentor
Calibre</p>
</blockquote>
<h2 id="differences-between-dspf-and-schematic-names">Differences
Between DSPF and Schematic Names</h2>
<p><img src="/2022/04/15/dspf-saveopt/image-20220416201019986.png"
alt="image-20220416201019986" /></p>
<blockquote>
<ul>
<li>MOS Terminal Mismatch ( ‘s’ vs ‘1’)
<ul>
<li>Schematic: number '1' ,'2', '3','4'</li>
<li>DSPF: 'd', 'g', 's','b'</li>
</ul></li>
</ul>
</blockquote>
<h2 id="simrc-file">.simrc file</h2>
<p>If DSPF files show such differences, you can set options in the
<strong>.simrc</strong> file to <strong>update the save statement in the
netlist</strong> so that the device names match with those in the DSPF
file</p>
<p>Additionally, <code>dspf_include</code> reads all the DSPF lines
starting with <strong>* (<em>|NET, </em>|I, *|P,*|S)</strong>, while
<code>include</code> considers all related lines as comments.</p>
<p>Only verified to DSPF output of Mentor Calibre</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">; ensure that the netlist is recreated each time</span><br><span class="line">nlReNetlistAll=t</span><br><span class="line"></span><br><span class="line">dspfFileEnvOptions = &#x27;(</span><br><span class="line">        nil</span><br><span class="line">        spfFileNameMappingFormat &quot;cdl“</span><br><span class="line">        spfFileTermDelimiter “:”</span><br><span class="line">        spfFileHierDelimiter “/”</span><br><span class="line">        spfFileFingerDelimiter “@”</span><br><span class="line">        spfFileNetMapping “mixed”</span><br><span class="line">        spfFileTerminalMapping “lower”</span><br><span class="line">        spfFileAddPrefixToDevice t</span><br><span class="line">        spfFileAddContextSensitivePrefix t</span><br><span class="line">        spfFileDeviceDefaultPrefix “X”</span><br><span class="line">        spfFileDevicePrefixForTermCurrent “X”</span><br><span class="line">        spfFileDevicePrefixForOppoints “X“</span><br><span class="line">        </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>spfFileDevicePrefixForTermCurrent</code> and
<code>spfFileDevicePrefixForOppoints</code> are applicable to MOS
devices only.</p>
</blockquote>
<p><img src="/2022/04/15/dspf-saveopt/image-20220418113416484.png"
alt="image-20220418113416484" /></p>
<blockquote>
<p>Both <code>@</code> and <code>__</code> have been observed as Finger
Delimiter in single DSPF . wired...</p>
</blockquote>
<h2 id="signal-name-saved-using-wildcard-operator">signal name saved
using wildcard operator</h2>
<p>How to find the signal name saved using wildcard operator with save
statement in spectre?</p>
<h3 id="method-1">method 1</h3>
<p>From ADE L or ADE XL Test Editor, you can use menu <em>Simulation →
Options → Analog→ Miscellaneous → Addition arguments
field:<code>dump_wildcard_info=yes</code></em></p>
<h3 id="method-2">method 2</h3>
<p>add below in netlist file or <em>Simulation Files → Definition
Files:<code>saveopt.scs</code></em></p>
<p><em>saveopt.scs</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wcOption options dump_wildcard_info=yes</span><br></pre></td></tr></table></figure>
<h3 id="saved-file">saved file</h3>
<p>After running simulation, saved wildcard summary is save into file
<code>&lt;netlist_file_name&gt;.wildcard.out*</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Wildcard match summary:</span><br><span class="line"></span><br><span class="line">save * nodes: 68</span><br><span class="line">    0</span><br><span class="line">    vdd!</span><br><span class="line">    I0.net10</span><br><span class="line">    I0.net15</span><br><span class="line">    I0.I8.net30</span><br></pre></td></tr></table></figure>
<h2
id="save-and-plot-terminal-voltage-in-ade-explorer-and-assembler">Save
and Plot terminal voltage in ADE Explorer and Assembler</h2>
<p><strong>.cdsinit</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">envSetVal(&quot;auCore.selection&quot; &quot;terminalSelectionType&quot; &#x27;cyclic &quot;current&quot;)</span><br></pre></td></tr></table></figure>
<p>Available options are <strong>current</strong>,
<strong>voltage</strong>, <strong>both</strong> or
<strong>prompt</strong> and the default is current which matches the
default behavior in previous releases.</p>
<ul>
<li>The schematic will have an <strong>ellipse</strong> annotation where
a current probe has been saved,</li>
<li>a <strong>V</strong> annotation for a voltage probe,</li>
<li>and both annotations for both.</li>
</ul>
<blockquote>
<p>NOTE: Starting with IC 6.1.8 ISR5, you can now set this from
Options-&gt;Plotting/Printing</p>
</blockquote>
<p><img src="/2022/04/15/dspf-saveopt/image-20220415204157341.png"
alt="image-20220415204157341" /></p>
<h2 id="interpreting-_noxref-entries">Interpreting _noxref Entries</h2>
<blockquote>
<p>You enable gate recognition in the Calibre nmLVS-H tool. Normally,
the <strong>_noxref</strong> names are internal to the gate</p>
</blockquote>
<p><img src="/2022/04/15/dspf-saveopt/image-20220416125348491.png"
alt="image-20220416125348491" /></p>
<p><img src="/2022/04/15/dspf-saveopt/image-20220416125416504.png"
alt="image-20220416125416504" /></p>
<h2
id="saving-net-with-hierarchy-delimiter-and-colon-in-net-name-gives-warning-spectre-8282-during-simulation">Saving
net with hierarchy delimiter and colon (:) in net name gives WARNING
(SPECTRE-8282) during simulation</h2>
<h3 id="problem">Problem</h3>
<p>I am running simulation using an spf/spef file which has a net name
definition as shown in the below example: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// input.scs</span><br><span class="line">simulator lang=spice</span><br><span class="line">.subckt pi_rc a z</span><br><span class="line">r1 a x1a 1k</span><br><span class="line">r2 x1a x1/x1:DRN 1k</span><br><span class="line">cb x1/x1:DRN z 200f</span><br><span class="line">.ends</span><br><span class="line"></span><br><span class="line">xpi1 in 0 pi_rc</span><br><span class="line">vdd in 0 pwl (0 0 1n 0 1.1n 10)</span><br><span class="line"></span><br><span class="line">simulator lang=spectre</span><br><span class="line">myopt options hier_ambiguity=lower</span><br><span class="line">tran tran stop=2u</span><br><span class="line"></span><br><span class="line">save xpi1.x1\/x1:DRN</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>The net name is x1/x1:DRN. During the simulation, the following
warning is reported:</p>
<p>Warning from spectre during initial setup. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING (SPECTRE-8282): `xpi1.x1/x1&#x27; is not a device or subcircuit instance name.</span><br><span class="line">WARNING (SPECTRE-8287): Ignoring invalid item `xpi1.x1/x1:DRN&#x27; in save statement.</span><br></pre></td></tr></table></figure></p>
<p>How can I save this net for plotting and measurements?</p>
<h3 id="solution">Solution</h3>
<p><strong>The colon (:) in the save statement specifies terminal
current</strong>. So, the save statement used above is for terminal
current and, hence, the warning messages are reported.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save xpi1.x1\/x1:DRN</span><br></pre></td></tr></table></figure>
<p>You need to modify the save statement as below: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save xpi1.x1\/x1\:DRN</span><br></pre></td></tr></table></figure></p>
<p>Now, run the simulation and the issue will be resolved.</p>
<h2 id="dspf-r-vs-rcc">DSPF r vs rcc</h2>
<p><strong>rcc</strong></p>
<p><img src="/2022/04/15/dspf-saveopt/image-20220618131626913.png"
alt="image-20220618131626913" /></p>
<p><strong>c</strong></p>
<p><img src="/2022/04/15/dspf-saveopt/image-20220618131649065.png"
alt="image-20220618131649065" /></p>
<p>only <strong>c</strong> dspf give the <strong>lumped
capacitance</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/VD-DRC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/13/VD-DRC/" class="post-title-link" itemprop="url">voltage-dependent DRC checks</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-13 23:16:07" itemprop="dateCreated datePublished" datetime="2022-04-13T23:16:07+00:00">2022-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:51" itemprop="dateModified" datetime="2024-06-02T08:39:51+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/analog/" itemprop="url" rel="index"><span itemprop="name">analog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In T* DRC deck, it is based on the voltage recognition CAD layer and
net connection to calculate the voltage difference between two
neighboring nets by the following formula:</p>
<p><span class="math display">\[
\Delta V = \max(V_H(\text{net1})-V_L(\text{net2}),
V_H(\text{net2})-V_L(\text{net1}))
\]</span></p>
<p>where <span class="math display">\[
V_H(\text{netx}) = \max(V(\text{netx}))
\]</span> and <span class="math display">\[
V_L(\text{netx}) = \min(V(\text{netx}))
\]</span></p>
<blockquote>
<ul>
<li>The <span class="math inline">\(\Delta V\)</span> will be
<strong>0</strong> if two nets are connected as same potential</li>
<li>If <span class="math inline">\(V_L \gt V_H\)</span> <strong>on a
net</strong>, DRC will report warning on this net</li>
</ul>
</blockquote>
<h2 id="voltage-recognition-cad-layer">Voltage recognition CAD
Layer</h2>
<p>Two method</p>
<ol type="1">
<li><p>voltage text layer</p>
<p>You place specific voltage text on specific drawing layer</p></li>
<li><p>voltage marker layer</p>
<p>Each voltage marker layer represent different voltage for specific
drawing layer</p></li>
</ol>
<blockquote>
<p><em>voltage text layer</em> has higher priority than <em>voltage
marker layer</em> and is recommended</p>
</blockquote>
<h3 id="voltage-text-layer">voltage text layer</h3>
<p>For example <strong>M3</strong></p>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 32%" />
<col style="width: 8%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="header">
<th>Process Layer</th>
<th>CAD Layer#</th>
<th>Voltage High</th>
<th>Voltage High Top<br />(highest priority)</th>
<th>Voltage Low</th>
<th>Voltage Low Top<br />(highest priority)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>M3</td>
<td>63</td>
<td>110</td>
<td>112</td>
<td>111</td>
<td>113</td>
</tr>
</tbody>
</table>
<blockquote>
<p>where <strong>63</strong> is <strong>layer number</strong>,
<strong>110 ~ 113</strong> is <strong>datatype</strong></p>
</blockquote>
<h3 id="voltage-marker-layer">voltage marker layer</h3>
<p>Different data type represent different voltage, like</p>
<table>
<thead>
<tr class="header">
<th>DataType</th>
<th>100</th>
<th>101</th>
<th>102</th>
<th>...</th>
<th>109</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Voltage</td>
<td>0.0</td>
<td>0.1</td>
<td>0.2</td>
<td>0.3</td>
<td>0.9</td>
</tr>
</tbody>
</table>
<h2 id="example">Example</h2>
<p><img src="/2022/04/13/VD-DRC/image-20220503171006936.png"
alt="image-20220503171006936" /></p>
<h2 id="reference">reference</h2>
<p><a
target="_blank" rel="noopener" href="https://blogs.sw.siemens.com/calibre/2015/08/18/automate-those-voltage-dependent-drc-checks/">Automate
those voltage-dependent DRC checks! - siemens</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/virtuoso-bindkey/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KNOW-HOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | KNOW-HOW">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/13/virtuoso-bindkey/" class="post-title-link" itemprop="url">Custom Bindkey of Cadence Virtuoso</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-13 17:21:33" itemprop="dateCreated datePublished" datetime="2022-04-13T17:21:33+00:00">2022-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-06-02 08:39:52" itemprop="dateModified" datetime="2024-06-02T08:39:52+00:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cad/" itemprop="url" rel="index"><span itemprop="name">cad</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="schbindkeys.il">schBindKeys.il</h2>
<blockquote>
<p>schematic</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">alias bk hiSetBindKey</span><br><span class="line">when ( isCallable(&#x27;schGetEnv&#x27;)</span><br><span class="line">bk(&quot;Schematics&quot; &quot;Ctrl&lt;Key&gt;x&quot; &quot;schHiCreateInst(\&quot;basic\&quot; \&quot;nonConn\&quot; \&quot;symbol\&quot;)&quot;)</span><br><span class="line">bk(&quot;Schematics&quot; &quot;Ctrl&lt;Key&gt;v&quot; &quot;schHiCreateInst(\&quot;analogLib\&quot; \&quot;vdc\&quot; \&quot;symbol\&quot;)&quot;)</span><br><span class="line">bk(&quot;Schematics&quot; &quot;Ctrl&lt;Key&gt;g&quot; &quot;schHiCreateInst(\&quot;analogLib\&quot; \&quot;gnd\&quot; \&quot;symbol\&quot;)&quot;)</span><br><span class="line">bk(&quot;Schematics&quot; &quot;Shift&lt;Key&gt;9&quot; &quot;geDeleteNetProbe()&quot;)</span><br><span class="line">bk(&quot;Schematics&quot; &quot;&lt;Key&gt;0&quot; &quot;geDeleteAllProbe(getCurrentWindow()t)&quot;)</span><br><span class="line">)</span><br><span class="line">unalias bk</span><br></pre></td></tr></table></figure>
<h2 id="lebindkeys.il">leBindKeys.il</h2>
<blockquote>
<p>layout</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">alias bk hiSetBindKey</span><br><span class="line">when ( isCallable(&#x27;leGetEnv)</span><br><span class="line">    bk(&quot;Layout&quot; &quot;&lt;Key&gt;1&quot; &quot;leSetEntryLayer(\&quot;M0PO\&quot;) leSetAllLayerVisible(nil) leSetEntryLayer(\&quot;M0OD\&quot;) leSetEntryLayer(\&quot;VIA0\&quot;) leSetEntryLayer(list(\&quot;M1\&quot; \&quot;pin\&quot;)) leSetEntryLayer(\&quot;M1\&quot;) hiRedraw()&quot; )</span><br><span class="line">    ; M1-VIA1-M2</span><br><span class="line">    bk(&quot;Layout&quot; &quot;&lt;Key&gt;2&quot; &quot;leSetEntryLayer(\&quot;M1\&quot;) leSetAllLayerVisible(nil) leSetEntryLayer(\&quot;VIA1\&quot;) leSetEntryLayer(list(\&quot;M2\&quot; \&quot;pin\&quot;)) leSetEntryLayer(\&quot;M2\&quot;) hiRedraw()&quot; )</span><br><span class="line">    ; M2-VIA2-M3</span><br><span class="line">    bk(&quot;Layout&quot; &quot;&lt;Key&gt;3&quot; &quot;leSetEntryLayer(\&quot;M2\&quot;) leSetAllLayerVisible(nil) leSetEntryLayer(\&quot;VIA2\&quot;) leSetEntryLayer(list(\&quot;M3\&quot; \&quot;pin\&quot;)) leSetEntryLayer(\&quot;M3\&quot;) hiRedraw()&quot; )</span><br><span class="line">    ; M3-VIA3-M4</span><br><span class="line">    bk(&quot;Layout&quot; &quot;&lt;Key&gt;4&quot; &quot;leSetEntryLayer(\&quot;M3\&quot;) leSetAllLayerVisible(nil) leSetEntryLayer(\&quot;VIA3\&quot;) leSetEntryLayer(list(\&quot;M4\&quot; \&quot;pin\&quot;)) leSetEntryLayer(\&quot;M4\&quot;) hiRedraw()&quot; )</span><br><span class="line">    ; M4-VIA4-M5</span><br><span class="line">	; select M4 layer, turn off other layer visibilty, select VIA4 M5_pin M5 and turn on them</span><br><span class="line">    bk(&quot;Layout&quot; &quot;&lt;Key&gt;5&quot; &quot;leSetEntryLayer(\&quot;M4\&quot;) leSetAllLayerVisible(nil) leSetEntryLayer(\&quot;VIA4\&quot;) leSetEntryLayer(list(\&quot;M5\&quot; \&quot;pin\&quot;)) leSetEntryLayer(\&quot;M5\&quot;) hiRedraw()&quot; )</span><br><span class="line">    ; all visiable</span><br><span class="line">    bk(&quot;Layout&quot; &quot;&lt;Key&gt;0&quot; &quot;leSetAllLayerVisible(t) hiRedraw()&quot; )</span><br><span class="line">)</span><br><span class="line">unalias bk</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Guo</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
